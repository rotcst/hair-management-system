# 公司数据共享设置指南

## 🎯 目标

将系统从"用户隔离"模式改为"公司共享"模式，让所有员工都能看到公司的基础信息。

## 📋 设置步骤

### 1. **更新Firebase安全规则**

1. 登录 [Firebase Console](https://console.firebase.google.com/)
2. 选择项目：**Mesia-EMS**
3. 点击 **Realtime Database** → **规则**
4. 将规则替换为 `updated-firebase-rules.json` 中的内容
5. 点击 **发布**

### 2. **设置管理员权限**

1. 打开 `setup-admin.html` 页面
2. 确认管理员邮箱：`robot8866@gmail.com`
3. 点击 **"设置为管理员"**
4. 验证管理员列表中显示了该邮箱

### 3. **迁移现有数据**

1. 使用管理员账户登录系统
2. 在 `setup-admin.html` 页面点击 **"迁移现有数据到公司级别"**
3. 等待迁移完成提示

### 4. **验证数据共享**

1. 使用管理员账户(`robot8866@gmail.com`)登录
2. 添加一些测试数据（员工、沙龙等）
3. 使用普通员工账户(`wk8866kr@gmail.com`)登录
4. 验证能看到管理员创建的数据

## 🏗️ 新的数据架构

```
Firebase Realtime Database:
├── company/                    # 🏢 公司公共数据（所有员工可见）
│   ├── employees/             # 员工信息（管理员可编辑）
│   ├── salons/                # 沙龙信息（管理员可编辑）
│   ├── products/              # 产品信息（管理员可编辑）
│   └── productCategories/     # 产品分类（管理员可编辑）
├── admins/                    # 👑 管理员列表
│   └── robot8866_gmail_com: true
├── users/                     # 👤 用户私有数据
│   └── [userUID]/
│       └── settings/          # 个人设置（语言等）
└── employees/                 # 📝 自主注册员工（临时）
```

## 🔐 权限说明

### **管理员权限** (`robot8866@gmail.com`)
- ✅ 查看所有公司数据
- ✅ 编辑员工信息
- ✅ 编辑沙龙信息
- ✅ 编辑产品信息
- ✅ 设置其他管理员
- ✅ 数据迁移

### **普通员工权限** (如 `wk8866kr@gmail.com`)
- ✅ 查看所有公司数据
- ❌ 无法编辑公司数据
- ✅ 编辑个人设置

## 🚀 使用流程

### **员工注册流程**
1. 新员工在登录页面自主注册
2. 系统自动将员工信息添加到 `company/employees`
3. 所有用户立即可见新员工信息

### **管理员操作流程**
1. 管理员登录系统
2. 可以编辑所有员工的职位、权限等信息
3. 修改后所有用户立即同步看到更新

### **数据同步**
- **实时同步**：所有用户看到的数据都是实时同步的
- **权限控制**：只有管理员能修改，普通员工只能查看
- **个人设置**：每个用户的语言等个人设置独立存储

## 🛠️ 故障排除

### **员工看不到数据**
1. 检查用户是否正确登录
2. 检查Firebase规则是否正确配置
3. 查看浏览器控制台是否有错误

### **权限错误**
1. 确认管理员邮箱在 `admins` 节点中
2. 检查邮箱格式（点号被替换为下划线）
3. 重新登录系统刷新权限

### **数据不同步**
1. 检查网络连接
2. 查看Firebase控制台是否有连接问题
3. 重新刷新页面

## 🎉 预期结果

设置完成后：
- ✅ 管理员可以管理所有公司数据
- ✅ 新注册员工自动加入公司员工列表
- ✅ 所有员工都能看到公司的基础信息
- ✅ 数据实时同步，无需手动刷新
- ✅ 权限控制确保数据安全

## 📞 技术支持

如果遇到问题，请检查：
1. Firebase规则配置
2. 管理员权限设置
3. 浏览器控制台错误信息 