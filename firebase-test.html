<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Firebaseè¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .success { background: #4CAF50; }
        .error { background: #f44336; }
        .warning { background: #ff9800; }
        .info { background: #2196F3; }
        button {
            background: #D4AF37;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        #log {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firebaseè¿æ¥æµ‹è¯•</h1>
    
    <div id="status" class="status info">æ­£åœ¨åˆå§‹åŒ–Firebase...</div>
    
    <div>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        <button onclick="testEmployeeAdd()">æµ‹è¯•æ·»åŠ å‘˜å·¥</button>
        <button onclick="testEmployeeRead()">æµ‹è¯•è¯»å–å‘˜å·¥</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <h3>æ“ä½œæ—¥å¿—ï¼š</h3>
    <div id="log"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyAcLyCy4FIL34AUd6vKrE_EqHV69qcFDYQ",
            authDomain: "mesiahair.firebaseapp.com",
            projectId: "mesiahair",
            storageBucket: "mesiahair.firebasestorage.app",
            messagingSenderId: "538029419112",
            appId: "1:538029419112:web:e2bb82a5fe0356e8d769dd"
        };

        let db;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        // åˆå§‹åŒ–Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            log('âœ… Firebaseåº”ç”¨åˆå§‹åŒ–æˆåŠŸ');
            updateStatus('Firebaseå·²åˆå§‹åŒ–ï¼Œå‡†å¤‡æµ‹è¯•è¿æ¥...', 'success');
        } catch (error) {
            log(`âŒ Firebaseåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            updateStatus('Firebaseåˆå§‹åŒ–å¤±è´¥', 'error');
        }

        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            log('ğŸ”„ å¼€å§‹æµ‹è¯•Firebaseè¿æ¥...');
            updateStatus('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'warning');
            
            try {
                // å°è¯•å†™å…¥æµ‹è¯•æ•°æ®
                const testDoc = await db.collection('test').add({
                    message: 'Firebaseè¿æ¥æµ‹è¯•',
                    timestamp: new Date(),
                    browser: navigator.userAgent
                });
                
                log(`âœ… è¿æ¥æˆåŠŸï¼æ–‡æ¡£ID: ${testDoc.id}`);
                updateStatus('Firebaseè¿æ¥æ­£å¸¸ï¼', 'success');
                
                // ç«‹å³è¯»å–åˆšå†™å…¥çš„æ•°æ®
                const doc = await db.collection('test').doc(testDoc.id).get();
                if (doc.exists) {
                    log(`âœ… æ•°æ®è¯»å–æˆåŠŸ: ${JSON.stringify(doc.data())}`);
                } else {
                    log('âš ï¸ æ•°æ®å†™å…¥æˆåŠŸä½†è¯»å–å¤±è´¥');
                }
                
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.code} - ${error.message}`);
                updateStatus('Firebaseè¿æ¥å¤±è´¥ï¼', 'error');
                
                if (error.code === 'permission-denied') {
                    log('ğŸ’¡ æç¤ºï¼šè¿™å¯èƒ½æ˜¯Firestoreå®‰å…¨è§„åˆ™é—®é¢˜');
                    log('è¯·æ£€æŸ¥Firebaseæ§åˆ¶å°çš„Firestoreå®‰å…¨è§„åˆ™è®¾ç½®');
                }
            }
        }

        // æµ‹è¯•æ·»åŠ å‘˜å·¥
        async function testEmployeeAdd() {
            log('ğŸ”„ æµ‹è¯•æ·»åŠ å‘˜å·¥æ•°æ®...');
            
            const testEmployee = {
                name: 'æµ‹è¯•å‘˜å·¥',
                position: 'salesperson',
                username: 'test_' + Date.now(),
                password: 'test123',
                mobile: '010-1234-5678',
                createTime: new Date().toLocaleString('zh-CN'),
                id: Date.now().toString()
            };
            
            try {
                await db.collection('employees').doc(testEmployee.id).set(testEmployee);
                log(`âœ… å‘˜å·¥æ·»åŠ æˆåŠŸ: ${testEmployee.name} (ID: ${testEmployee.id})`);
            } catch (error) {
                log(`âŒ å‘˜å·¥æ·»åŠ å¤±è´¥: ${error.code} - ${error.message}`);
            }
        }

        // æµ‹è¯•è¯»å–å‘˜å·¥
        async function testEmployeeRead() {
            log('ğŸ”„ æµ‹è¯•è¯»å–å‘˜å·¥æ•°æ®...');
            
            try {
                const snapshot = await db.collection('employees').limit(5).get();
                
                if (snapshot.empty) {
                    log('ğŸ“ å‘˜å·¥é›†åˆä¸ºç©º');
                } else {
                    log(`ğŸ“‹ æ‰¾åˆ° ${snapshot.size} ä¸ªå‘˜å·¥:`);
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        log(`  - ${data.name} (${data.position}) - ID: ${doc.id}`);
                    });
                }
            } catch (error) {
                log(`âŒ è¯»å–å‘˜å·¥å¤±è´¥: ${error.code} - ${error.message}`);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000);
        });
        
        // ç›‘å¬ç½‘ç»œçŠ¶æ€
        window.addEventListener('online', () => {
            log('ğŸŒ ç½‘ç»œå·²è¿æ¥');
            updateStatus('ç½‘ç»œå·²è¿æ¥ï¼Œå¯ä»¥æµ‹è¯•Firebase', 'success');
        });
        
        window.addEventListener('offline', () => {
            log('ğŸš« ç½‘ç»œå·²æ–­å¼€');
            updateStatus('ç½‘ç»œå·²æ–­å¼€', 'warning');
        });
    </script>
</body>
</html> 