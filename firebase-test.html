<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseè¿æ¥æµ‹è¯• - Mesia EMS</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(24,24,24,0.9);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(212,175,55,0.2);
        }
        
        h1 {
            color: #D4AF37;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #D4AF37;
            padding-bottom: 15px;
        }
        
        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(212,175,55,0.1);
            border-radius: 10px;
            border-left: 4px solid #D4AF37;
        }
        
        .test-title {
            color: #D4AF37;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            margin-right: 10px;
        }
        
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.loading { background: #FF9800; color: white; }
        
        button {
            background: #D4AF37;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover {
            background: #FFD700;
        }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .user-info {
            background: rgba(76,175,80,0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
    
    <div class="container">
        <h1>ğŸ”¥ Firebaseè¿æ¥æµ‹è¯•</h1>
        
        <!-- Firebaseé…ç½®æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">1. Firebaseé…ç½®</div>
            <div id="config-status">
                <span class="status loading">æ£€æµ‹ä¸­...</span>
                <span id="config-msg">æ­£åœ¨éªŒè¯Firebaseé…ç½®...</span>
            </div>
        </div>
        
        <!-- è®¤è¯æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">2. ç”¨æˆ·è®¤è¯</div>
            <div id="auth-status">
                <span class="status loading">æ£€æµ‹ä¸­...</span>
                <span id="auth-msg">æ£€æŸ¥è®¤è¯çŠ¶æ€...</span>
            </div>
            <div id="auth-controls" style="margin-top: 10px;">
                <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
                <button onclick="testLogout()">é€€å‡ºç™»å½•</button>
            </div>
            <div id="user-info"></div>
        </div>
        
        <!-- æ•°æ®åº“è¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">3. å®æ—¶æ•°æ®åº“</div>
            <div id="db-status">
                <span class="status loading">æ£€æµ‹ä¸­...</span>
                <span id="db-msg">è¿æ¥æ•°æ®åº“...</span>
            </div>
            <div style="margin-top: 10px;">
                <button onclick="testWrite()">å†™å…¥æµ‹è¯•æ•°æ®</button>
                <button onclick="testRead()">è¯»å–æµ‹è¯•æ•°æ®</button>
                <button onclick="clearTestData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
            </div>
        </div>
        
        <!-- å®æ—¶åŒæ­¥æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">4. å®æ—¶åŒæ­¥</div>
            <div id="sync-status">
                <span class="status loading">æ£€æµ‹ä¸­...</span>
                <span id="sync-msg">è®¾ç½®ç›‘å¬å™¨...</span>
            </div>
            <div id="sync-data" style="margin-top: 10px;"></div>
        </div>
        
        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="test-section">
            <div class="test-title">5. ç³»ç»Ÿæ—¥å¿—</div>
            <div id="log" class="log"></div>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>

    <script>
        let database, auth;
        let testUser = null;
        
        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDAfHsHn6jyaCDURsi-R2a0vleka36ML6Q",
            authDomain: "mesia-ems.firebaseapp.com",
            projectId: "mesia-ems",
            storageBucket: "mesia-ems.firebasestorage.app",
            messagingSenderId: "718797479793",
            appId: "1:718797479793:web:22a39e902f8ac4324e60d0",
            measurementId: "G-3VHGK0DTQY",
            databaseURL: "https://mesia-ems-default-rtdb.firebaseio.com/"
        };
        
        // åˆå§‹åŒ–æµ‹è¯•
        window.onload = function() {
            log('å¼€å§‹Firebaseè¿æ¥æµ‹è¯•...');
            testFirebaseConfig();
        };
        
        // 1. æµ‹è¯•Firebaseé…ç½®
        function testFirebaseConfig() {
            try {
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                database = firebase.database();
                
                document.getElementById('config-status').innerHTML = 
                    '<span class="status success">æˆåŠŸ</span><span>Firebaseå·²åˆå§‹åŒ–</span>';
                log('âœ… Firebaseé…ç½®æˆåŠŸ');
                
                testAuthentication();
            } catch (error) {
                document.getElementById('config-status').innerHTML = 
                    '<span class="status error">å¤±è´¥</span><span>é…ç½®é”™è¯¯: ' + error.message + '</span>';
                log('âŒ Firebaseé…ç½®å¤±è´¥: ' + error.message);
            }
        }
        
        // 2. æµ‹è¯•è®¤è¯
        function testAuthentication() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    testUser = user;
                    document.getElementById('auth-status').innerHTML = 
                        '<span class="status success">å·²ç™»å½•</span><span>ç”¨æˆ·å·²è®¤è¯</span>';
                    
                    document.getElementById('user-info').innerHTML = `
                        <div class="user-info">
                            <strong>å½“å‰ç”¨æˆ·:</strong><br>
                            Email: ${user.email}<br>
                            UID: ${user.uid}<br>
                            ç™»å½•æ—¶é—´: ${new Date(user.metadata.lastSignInTime).toLocaleString()}
                        </div>`;
                    
                    log('âœ… ç”¨æˆ·å·²ç™»å½•: ' + user.email);
                    testDatabase();
                } else {
                    testUser = null;
                    document.getElementById('auth-status').innerHTML = 
                        '<span class="status error">æœªç™»å½•</span><span>éœ€è¦ç™»å½•æ‰èƒ½æµ‹è¯•æ•°æ®åº“</span>';
                    log('âš ï¸ ç”¨æˆ·æœªç™»å½•');
                }
            });
        }
        
        // æµ‹è¯•ç™»å½•
        function testLogin() {
            const email = prompt('è¯·è¾“å…¥æµ‹è¯•é‚®ç®±:');
            const password = prompt('è¯·è¾“å…¥å¯†ç :');
            
            if (email && password) {
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        log('âœ… ç™»å½•æˆåŠŸ');
                    })
                    .catch(error => {
                        log('âŒ ç™»å½•å¤±è´¥: ' + error.message);
                        alert('ç™»å½•å¤±è´¥: ' + error.message);
                    });
            }
        }
        
        // æµ‹è¯•é€€å‡º
        function testLogout() {
            auth.signOut().then(() => {
                log('âœ… å·²é€€å‡ºç™»å½•');
                document.getElementById('user-info').innerHTML = '';
            });
        }
        
        // 3. æµ‹è¯•æ•°æ®åº“
        function testDatabase() {
            if (!testUser) {
                document.getElementById('db-status').innerHTML = 
                    '<span class="status error">å¤±è´¥</span><span>éœ€è¦å…ˆç™»å½•</span>';
                return;
            }
            
            try {
                // æµ‹è¯•è¿æ¥
                const testRef = database.ref('test-connection');
                testRef.set('connected').then(() => {
                    document.getElementById('db-status').innerHTML = 
                        '<span class="status success">æˆåŠŸ</span><span>æ•°æ®åº“è¿æ¥æ­£å¸¸</span>';
                    log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ');
                    
                    testRealTimeSync();
                }).catch(error => {
                    document.getElementById('db-status').innerHTML = 
                        '<span class="status error">å¤±è´¥</span><span>å†™å…¥å¤±è´¥: ' + error.message + '</span>';
                    log('âŒ æ•°æ®åº“å†™å…¥å¤±è´¥: ' + error.message);
                });
            } catch (error) {
                document.getElementById('db-status').innerHTML = 
                    '<span class="status error">å¤±è´¥</span><span>è¿æ¥é”™è¯¯: ' + error.message + '</span>';
                log('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ' + error.message);
            }
        }
        
        // 4. æµ‹è¯•å®æ—¶åŒæ­¥
        function testRealTimeSync() {
            if (!testUser) return;
            
            const syncRef = database.ref(`users/${testUser.uid}/test-sync`);
            
            syncRef.on('value', (snapshot) => {
                const data = snapshot.val();
                document.getElementById('sync-status').innerHTML = 
                    '<span class="status success">ç›‘å¬ä¸­</span><span>å®æ—¶åŒæ­¥æ­£å¸¸</span>';
                
                document.getElementById('sync-data').innerHTML = 
                    `<strong>å®æ—¶æ•°æ®:</strong> ${JSON.stringify(data, null, 2)}`;
                
                log('ğŸ”„ æ”¶åˆ°å®æ—¶æ•°æ®æ›´æ–°: ' + JSON.stringify(data));
            });
        }
        
        // å†™å…¥æµ‹è¯•æ•°æ®
        function testWrite() {
            if (!testUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            const testData = {
                timestamp: Date.now(),
                message: 'Hello Firebase!',
                random: Math.random()
            };
            
            database.ref(`users/${testUser.uid}/test-sync`).set(testData).then(() => {
                log('âœ… å†™å…¥æµ‹è¯•æ•°æ®æˆåŠŸ');
            }).catch(error => {
                log('âŒ å†™å…¥å¤±è´¥: ' + error.message);
            });
        }
        
        // è¯»å–æµ‹è¯•æ•°æ®
        function testRead() {
            if (!testUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            database.ref(`users/${testUser.uid}/test-sync`).once('value').then((snapshot) => {
                const data = snapshot.val();
                log('ğŸ“– è¯»å–æ•°æ®: ' + JSON.stringify(data));
                alert('æ•°æ®è¯»å–æˆåŠŸ!\n' + JSON.stringify(data, null, 2));
            }).catch(error => {
                log('âŒ è¯»å–å¤±è´¥: ' + error.message);
            });
        }
        
        // æ¸…é™¤æµ‹è¯•æ•°æ®
        function clearTestData() {
            if (!testUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }
            
            database.ref(`users/${testUser.uid}/test-sync`).remove().then(() => {
                log('ğŸ—‘ï¸ æµ‹è¯•æ•°æ®å·²æ¸…é™¤');
                document.getElementById('sync-data').innerHTML = '<em>æ— æ•°æ®</em>';
            }).catch(error => {
                log('âŒ æ¸…é™¤å¤±è´¥: ' + error.message);
            });
        }
    </script>
</body>
</html> 