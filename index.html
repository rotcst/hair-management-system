<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mesia首尔西部地区管理系统</title>
    
    <!-- 字体/粒子/动效CDN -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400|Poppins:400,700|Source+Han+Sans+SC:400,700&display=swap" rel="stylesheet">
    <!-- SheetJS库用于处理Excel文件 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3.3.0/tsparticles.bundle.min.js"></script>
    
    <!-- Firebase认证保护 -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
    
    <!-- Firebase配置和数据管理器 -->
    <script src="firebase-config.js"></script>
    <script src="firebase-data-manager.js"></script>
    
    <script>

        // 认证状态检查和数据初始化
        firebase.auth().onAuthStateChanged(async (user) => {
            if (!user) {
                // 如果用户未登录，重定向到登录页面
                window.location.href = 'login.html';
            } else {
                console.log("用户已登录：", user.email);
                
                try {
                    // 初始化Firebase数据管理器
                    await window.firebaseDataManager.initializeData();
                    
                    // 用户已登录，可以显示页面内容
                    document.body.style.display = 'block';
                    
                    // 更新用户显示信息
                    const userNameElement = document.getElementById('userName');
                    if (userNameElement) {
                        userNameElement.textContent = user.email;
                        userNameElement.removeAttribute('data-i18n');
                    }
                    
                    // 初始化系统
                    initializeSystem();
                    
                } catch (error) {
                    console.error('初始化数据失败:', error);
                    alert('数据初始化失败，请刷新页面重试');
                }
            }
        });

        // ==================== Firebase数据库操作封装 ====================
        
        // 获取当前用户的数据路径前缀
        function getUserDataPath() {
            const user = firebase.auth().currentUser;
            if (!user) return null;
            // 将邮箱中的特殊字符替换为下划线，作为数据库路径
            return user.uid || user.email.replace(/[.@]/g, '_');
        }
        
        // 初始化Firebase数据连接
        function initializeFirebaseData() {
            const userPath = getUserDataPath();
            if (!userPath) return;
            
            // 设置全局变量，用于存储实时数据
            window.firebaseData = {
                employees: [],
                salons: [],
                products: [],
                productCategories: [],
                customDistricts: [],
                userSettings: {}
            };
            
            // 监听各种数据的变化
            setupFirebaseListeners(userPath);
        }
        
        // 设置Firebase数据监听器
        function setupFirebaseListeners(userPath) {
            // 监听员工数据
            database.ref(`users/${userPath}/employees`).on('value', (snapshot) => {
                const data = snapshot.val();
                window.firebaseData.employees = data ? Object.values(data) : [];
                // 如果当前页面显示员工列表，刷新显示
                if (document.getElementById('employee-list').style.display !== 'none') {
                    displayEmployeeList();
                }
            });
            
            // 监听沙龙数据
            database.ref(`users/${userPath}/salons`).on('value', (snapshot) => {
                const data = snapshot.val();
                window.firebaseData.salons = data ? Object.values(data) : [];
                // 如果当前页面显示沙龙信息，刷新显示
                if (document.getElementById('salon-info').style.display !== 'none') {
                    displaySalonList();
                }
            });
            
            // 监听产品数据
            database.ref(`users/${userPath}/products`).on('value', (snapshot) => {
                const data = snapshot.val();
                window.firebaseData.products = data ? Object.values(data) : [];
                // 如果当前页面显示产品列表，刷新显示
                if (document.getElementById('product-list').style.display !== 'none') {
                    displayProductList();
                }
            });
            
            // 监听产品分类数据
            database.ref(`users/${userPath}/productCategories`).on('value', (snapshot) => {
                const data = snapshot.val();
                window.firebaseData.productCategories = data ? Object.values(data) : [];
                // 如果当前页面显示产品分类，刷新显示
                if (document.getElementById('product-category').style.display !== 'none') {
                    displayProductCategories();
                }
            });
            
            // 监听区域数据
            database.ref(`users/${userPath}/customDistricts`).on('value', (snapshot) => {
                const data = snapshot.val();
                window.firebaseData.customDistricts = data ? Object.values(data) : [];
            });
            
            // 监听用户设置
            database.ref(`users/${userPath}/settings`).on('value', (snapshot) => {
                const data = snapshot.val();
                window.firebaseData.userSettings = data || {};
                // 应用语言设置
                if (data && data.language) {
                    switchLanguage(data.language);
                }
            });
        }
        
        // Firebase数据操作函数
        
        // 保存员工数据
        async function saveEmployeesToFirebase(employees) {
            const userPath = getUserDataPath();
            if (!userPath) return false;
            
            try {
                const employeesRef = database.ref(`users/${userPath}/employees`);
                await employeesRef.set(employees.reduce((acc, emp) => {
                    acc[emp.id] = emp;
                    return acc;
                }, {}));
                return true;
            } catch (error) {
                console.error('保存员工数据失败:', error);
                return false;
            }
        }
        
        // 保存沙龙数据
        async function saveSalonsToFirebase(salons) {
            const userPath = getUserDataPath();
            if (!userPath) return false;
            
            try {
                const salonsRef = database.ref(`users/${userPath}/salons`);
                await salonsRef.set(salons.reduce((acc, salon) => {
                    acc[salon.id] = salon;
                    return acc;
                }, {}));
                return true;
            } catch (error) {
                console.error('保存沙龙数据失败:', error);
                return false;
            }
        }
        
        // 保存产品数据
        async function saveProductsToFirebase(products) {
            const userPath = getUserDataPath();
            if (!userPath) return false;
            
            try {
                const productsRef = database.ref(`users/${userPath}/products`);
                await productsRef.set(products.reduce((acc, product) => {
                    acc[product.id] = product;
                    return acc;
                }, {}));
                return true;
            } catch (error) {
                console.error('保存产品数据失败:', error);
                return false;
            }
        }
        
        // 保存产品分类数据
        async function saveProductCategoriesToFirebase(categories) {
            const userPath = getUserDataPath();
            if (!userPath) return false;
            
            try {
                const categoriesRef = database.ref(`users/${userPath}/productCategories`);
                await categoriesRef.set(categories.reduce((acc, category) => {
                    acc[category.id] = category;
                    return acc;
                }, {}));
                return true;
            } catch (error) {
                console.error('保存产品分类数据失败:', error);
                return false;
            }
        }
        
        // 保存区域数据
        async function saveDistrictsToFirebase(districts) {
            const userPath = getUserDataPath();
            if (!userPath) return false;
            
            try {
                const districtsRef = database.ref(`users/${userPath}/customDistricts`);
                await districtsRef.set(districts.reduce((acc, district, index) => {
                    acc[index] = district;
                    return acc;
                }, {}));
                return true;
            } catch (error) {
                console.error('保存区域数据失败:', error);
                return false;
            }
        }
        
        // 保存用户设置
        async function saveUserSettingsToFirebase(settings) {
            const userPath = getUserDataPath();
            if (!userPath) return false;
            
            try {
                const settingsRef = database.ref(`users/${userPath}/settings`);
                await settingsRef.update(settings);
                return true;
            } catch (error) {
                console.error('保存用户设置失败:', error);
                return false;
            }
        }
        
        // 数据操作函数 - 使用FirebaseDataManager
        function getEmployees() {
            return window.firebaseDataManager.getEmployees();
        }
        
        function getSalons() {
            return window.firebaseDataManager.getSalons();
        }
        
        function getProducts() {
            return window.firebaseDataManager.getProducts();
        }
        
        function getProductCategories() {
            return window.firebaseDataManager.getProductCategories();
        }
        
        function getCustomDistricts() {
            return window.firebaseDataManager.getCustomDistricts();
        }
        
        // 保存数据的函数
        async function saveEmployees(employees) {
            try {
                await window.firebaseDataManager.saveEmployees(employees);
                return true;
            } catch (error) {
                console.error('保存员工数据失败:', error);
                return false;
            }
        }
        
        async function saveSalons(salons) {
            try {
                await window.firebaseDataManager.saveSalons(salons);
                return true;
            } catch (error) {
                console.error('保存沙龙数据失败:', error);
                return false;
            }
        }
        
        async function saveProducts(products) {
            try {
                await window.firebaseDataManager.saveProducts(products);
                return true;
            } catch (error) {
                console.error('保存产品数据失败:', error);
                return false;
            }
        }
        
        async function saveProductCategories(categories) {
            try {
                await window.firebaseDataManager.saveProductCategories(categories);
                return true;
            } catch (error) {
                console.error('保存产品分类失败:', error);
                return false;
            }
        }
        
        // ==================== Firebase数据库操作封装结束 ====================
        
        // ==================== 语言设置Firebase化 ====================
        
        // 获取当前语言设置
        function getCurrentLanguage() {
            return window.firebaseDataManager.getCurrentLanguage();
        }
        
        // 设置语言并保存到Firebase
        async function setLanguageToFirebase(language) {
            try {
                await window.firebaseDataManager.setLanguage(language);
                return true;
            } catch (error) {
                console.error('保存语言设置失败:', error);
                return false;
            }
        }
        
        // ==================== 语言设置Firebase化结束 ====================
    </script>
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --black: #000000;
            --dark-gray: #1a1a1a;
            --text-light: #fff;
            --shadow: 0 10px 32px 0 rgba(212,175,55,0.13), 0 2px 4px rgba(0,0,0,0.23);
            --glass: rgba(24,24,24,0.76);
            --glass-blur: blur(20px) saturate(180%);
        }
        
        #tsparticles {
            position: fixed; left:0; top:0; width:100vw; height:100vh;
            pointer-events: none; z-index: 0;
        }
        
        body {
            font-family: 'Montserrat', 'Poppins', 'Source Han Sans SC', 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: #000000; /* 改为纯黑色背景，移除深灰色渐变 */
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            overflow: hidden; /* 防止整体页面滚动 */
            display: none; /* 初始隐藏，等待认证完成后显示 */
        }
        
        /* 新增布局样式 */
        .layout-container {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }
        
        /* 侧边栏样式 */
        .sidebar {
            width: 280px;
            background: rgba(24,24,24,0.95);
            -webkit-backdrop-filter: var(--glass-blur);
            backdrop-filter: var(--glass-blur);
            border-right: 1.5px solid rgba(212,175,55,0.15);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 10;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(212,175,55,0.3);
        }
        
        .sidebar-logo {
            font-size: 2.5em;
            color: var(--gold);
            font-family: 'Montserrat', cursive;
            font-weight: 900;
            user-select: none;
            letter-spacing: 1px;
            text-shadow: 0 0 22px rgba(212,175,55,0.28);
        }
        
        .sidebar-subtitle {
            color: var(--gold-light);
            font-size: 0.9em;
            margin-top: 5px;
            font-style: italic;
        }
        
        .sidebar-title {
            color: var(--gold);
            font-size: 1em;
            margin-top: 10px;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .sidebar-menu {
            padding: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .sidebar-menu-item {
            width: 100%;
        }
        
        .sidebar-menu-header {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            color: var(--gold);
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-menu-header:hover {
            background: rgba(212,175,55,0.15);
            border-left: 3px solid var(--gold);
        }
        
        .sidebar-menu-icon {
            margin-right: 12px;
            font-size: 1.2em;
        }
        
        .sidebar-menu-title {
            flex: 1;
        }
        
        .sidebar-menu-arrow {
            font-size: 0.8em;
            transition: transform 0.3s;
        }
        
        .sidebar-menu-item.active .sidebar-menu-arrow {
            transform: rotate(180deg);
        }
        
        .sidebar-submenu {
            display: none;
            background: rgba(0,0,0,0.3);
        }
        
        .sidebar-submenu.active {
            display: block;
        }
        
        .sidebar-submenu-item {
            padding: 10px 20px 10px 48px;
            cursor: pointer;
            color: #cccccc;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-submenu-item:hover {
            background: rgba(212,175,55,0.1);
            color: var(--gold-light);
            border-left: 3px solid var(--gold-light);
        }
        
        .sidebar-submenu-item.active {
            background: rgba(212,175,55,0.2);
            color: var(--gold-light);
            border-left: 3px solid var(--gold);
        }
        
        /* 主内容区样式 */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden; /* 防止水平滚动 */
        }
        
        .content-container {
            flex: 1;
            padding: 20px 20px 30px 20px; /* 调整底部padding，配合0px间距设置 */
            margin-top: 20px;
            overflow-y: auto; /* 内容区域滚动 */
            height: calc(100vh - 54px); /* 减去顶部导航的高度54px */
        }
        
        /* 移除返回按钮，因为导航现在通过侧边栏完成 */
        .back-button {
            display: none;
        }
        
        /* 移动端菜单按钮 */
        .hamburger-menu {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 100;
            background: var(--glass);
            -webkit-backdrop-filter: var(--glass-blur);
            backdrop-filter: var(--glass-blur);
            border-radius: 5px;
            border: 1px solid var(--gold);
            padding: 5px;
            cursor: pointer;
        }
        
        .hamburger-line {
            width: 25px;
            height: 3px;
            background-color: var(--gold);
            margin: 5px;
            transition: all 0.3s;
        }
        
        /* 响应式调整 */
        @media (max-width: 900px) {
            .sidebar {
                width: 240px;
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .hamburger-menu {
                display: block;
            }
            
            .content-container {
                height: calc(100vh - 54px); /* 移动端保持与桌面端一致的高度计算 */
                padding-bottom: 74px; /* 移动端也为footer预留空间 */
            }
            
            .content-area {
                height: calc(100vh - 170px); /* 移动端保持相同的内容区域高度 */
                max-height: calc(100vh - 170px);
                margin-bottom: 0px; /* 移动端黄色边框与版权文字也紧贴，0px间距 */
            }
            
            .footer {
                left: 0; /* 移动端时覆盖整个宽度 */
                bottom: 5px; /* 移动端距离底部5px */
            }
            
            .top-nav {
                left: 0; /* 移动端时覆盖整个宽度 */
            }
        }
        
        /* 平板设备适配 */
        @media screen and (max-width: 768px) {
            .sidebar {
                width: 220px;
                z-index: 1000;
                box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            }
            
            .sidebar-header {
                padding: 15px;
            }
            
            .sidebar-logo {
                width: 60px;
                height: 60px;
                font-size: 1.8em;
            }
            
            .sidebar-title {
                font-size: 0.9em;
            }
            
            .sidebar-menu-header {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            
            .sidebar-submenu-item {
                padding: 8px 15px 8px 40px;
                font-size: 0.85em;
            }
            
            .content-area {
                padding: 20px;
                margin-top: 15px;
                height: calc(100vh - 160px);
                max-height: calc(100vh - 160px);
            }
            
            .content-area h1 {
                font-size: 2.2em;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .form-row .form-group {
                margin-bottom: 15px;
            }
            
            input, select, textarea {
                padding: 12px;
                font-size: 16px; /* 防止iOS自动缩放 */
                border-radius: 6px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 16px;
                border-radius: 6px;
                margin: 10px 5px;
            }
            
            .top-nav {
                padding: 0 15px;
                height: 50px;
            }
            
            .store-info, .user-info, .language-switcher {
                height: 36px;
                padding: 6px 12px;
                font-size: 0.9em;
            }
            
            .language-btn {
                padding: 4px 8px;
                font-size: 0.8em;
                min-width: 45px;
            }
            
            .hamburger-menu {
                top: 12px;
                left: 12px;
            }
            
            .hamburger-line {
                width: 22px;
                height: 2px;
                margin: 4px;
            }
        }
        
        /* 手机设备适配 */
        @media screen and (max-width: 480px) {
            .sidebar {
                width: 200px;
            }
            
            .sidebar-header {
                padding: 12px;
            }
            
            .sidebar-logo {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
            
            .sidebar-subtitle {
                font-size: 0.8em;
            }
            
            .sidebar-title {
                font-size: 0.8em;
            }
            
            .sidebar-menu-header {
                padding: 8px 12px;
                font-size: 0.85em;
            }
            
            .sidebar-menu-icon {
                font-size: 1em;
                margin-right: 8px;
            }
            
            .sidebar-submenu-item {
                padding: 6px 12px 6px 35px;
                font-size: 0.8em;
            }
            
            .content-area {
                padding: 15px;
                margin-top: 10px;
                height: calc(100vh - 150px);
                max-height: calc(100vh - 150px);
            }
            
            .content-area h1 {
                font-size: 1.8em;
                margin-bottom: 12px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            input, select, textarea {
                padding: 10px;
                font-size: 16px;
            }
            
            button {
                padding: 10px 15px;
                font-size: 15px;
                margin: 8px 3px;
            }
            
            .top-nav {
                padding: 0 10px;
                height: 45px;
            }
            
            .store-info, .user-info, .language-switcher {
                height: 32px;
                padding: 5px 10px;
                font-size: 0.8em;
            }
            
            .language-btn {
                padding: 3px 6px;
                font-size: 0.75em;
                min-width: 40px;
            }
            
            .hamburger-menu {
                top: 10px;
                left: 10px;
                padding: 4px;
            }
            
            .hamburger-line {
                width: 20px;
                height: 2px;
                margin: 3px;
            }
            
            .footer {
                font-size: 0.75em;
                padding: 3px 10px;
            }
            
            /* 表格和列表在移动端的适配 */
            .employee-table, .salon-table, .product-table {
                font-size: 0.85em;
            }
            
            .employee-table th, .employee-table td,
            .salon-table th, .salon-table td,
            .product-table th, .product-table td {
                padding: 8px 4px;
            }
            
            /* 搜索和筛选控件适配 */
            .search-controls, .filter-controls {
                flex-direction: column;
                gap: 8px;
            }
            
            .search-controls input, .filter-controls select {
                width: 100%;
                margin-bottom: 8px;
            }
        }
        
        /* 横屏模式适配 */
        @media screen and (max-height: 600px) and (orientation: landscape) {
            .content-area {
                height: calc(100vh - 120px);
                max-height: calc(100vh - 120px);
                padding: 10px;
            }
            
            .content-area h1 {
                font-size: 1.5em;
                margin-bottom: 8px;
            }
            
            .form-group {
                margin-bottom: 8px;
            }
            
            .sidebar {
                width: 180px;
            }
            
            .sidebar-header {
                padding: 8px;
            }
            
            .sidebar-logo {
                width: 40px;
                height: 40px;
                font-size: 1.2em;
            }
            
            .sidebar-menu-header {
                padding: 6px 10px;
                font-size: 0.8em;
            }
            
            .top-nav {
                height: 40px;
                padding: 0 8px;
            }
            
            .store-info, .user-info, .language-switcher {
                height: 28px;
                padding: 4px 8px;
                font-size: 0.7em;
            }
            
            .language-btn {
                padding: 2px 4px;
                font-size: 0.7em;
                min-width: 35px;
            }
        }
        
        /* 移动端触摸优化 */
        @media (hover: none) and (pointer: coarse) {
            /* 移动设备特定样式 */
            button, .sidebar-menu-header, .sidebar-submenu-item, .language-btn {
                -webkit-tap-highlight-color: rgba(212, 175, 55, 0.3);
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            
            input, select, textarea {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            
            /* 防止移动端页面缩放 */
            html {
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }
            
            /* 优化移动端滚动 */
            body, .content-area, .sidebar-menu {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
            }
            
            /* 移动端输入框样式优化 */
            input[type="email"], input[type="password"], input[type="text"], 
            input[type="tel"], input[type="number"], input[type="date"] {
                -webkit-appearance: none;
                border-radius: 6px;
                box-shadow: none;
            }
            
            /* 移动端按钮触摸反馈 */
            button:active, .sidebar-menu-header:active, .sidebar-submenu-item:active, .language-btn:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            /* 汉堡菜单按钮触摸反馈 */
            .hamburger-menu:active {
                transform: scale(0.9);
                transition: transform 0.1s ease;
            }
            
            /* 优化触摸滚动区域 */
            .content-area, .sidebar-menu {
                touch-action: pan-y;
            }
        }
        
        /* 特定iOS设备优化 */
        @supports (-webkit-appearance: none) {
            .sidebar, .content-area, .top-nav {
                -webkit-backdrop-filter: blur(10px);
                backdrop-filter: blur(10px);
            }
            
            input, select, textarea {
                -webkit-appearance: none;
                border-radius: 6px;
            }
            
            /* iOS Safari地址栏隐藏时的高度适配 */
            @media screen and (max-height: 500px) {
                .content-area {
                    height: calc(100vh - 100px);
                    max-height: calc(100vh - 100px);
                }
            }
        }
        
        /* 保留原有样式 */
        .container, .content-area, .top-nav, .footer {
            background: var(--glass);
            -webkit-backdrop-filter: var(--glass-blur);
            backdrop-filter: var(--glass-blur);
            box-shadow: var(--shadow);
            border: 1.5px solid rgba(212,175,55,0.08);
        }
        
        .content-area {
            display: none;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            margin-top: 20px;
            margin-bottom: 0px; /* 黄色边框与版权文字紧贴，0px间距 */
            height: calc(100vh - 170px); /* 调整高度，配合0px间距 */
            max-height: calc(100vh - 170px); /* 确保高度一致性 */
            overflow: hidden; /* 默认隐藏滚动条 */
        }
        
        /* 需要滚动条的页面 */
        #new-employee.content-area,
        #new-salon.content-area,
        #add-product.content-area,
        #operation-history.content-area,
        #performance-target.content-area,
        #data-comparison.content-area,
        #audit-report.content-area,
        #approval-management.content-area,
        #product-category.content-area,
        #stock-check.content-area,
        #restock-alert.content-area,
        #usage-record.content-area,
        #income-record.content-area,
        #expense-record.content-area,
        #financial-report.content-area {
            overflow-y: auto; /* 允许垂直滚动 */
        }
        
        /* 统一的滚动条样式 */
        ::-webkit-scrollbar {
            width: 12px; 
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(120deg, #d4af37 55%, #1a1a1a 100%);
            border-radius: 7px;
            box-shadow: 0 2px 10px rgba(212,175,55,0.13);
            border: 2px solid #232323;
        }
        
        ::-webkit-scrollbar-corner { 
            background: #191919;
        }
        
        .content-area.active {
            display: block;
        }
        

        

        

        
        .content-area h1 {
            color: var(--gold);
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }
        
        h1, h2, h3 {
            font-family: 'Montserrat', 'Poppins', 'Source Han Sans SC', Arial, sans-serif;
            font-weight: 700;
            letter-spacing: 0.03em;
        }
        
        h1 { 
            color: var(--gold); 
            font-size: 2.6em; 
            margin-bottom: 18px;
        }
        
        h2 { 
            color: var(--gold); 
            margin: 0 0 13px 0; 
            font-size: 1.44em; 
            transition: color .24s;
        }
        
        p { 
            color: var(--text-light); 
            margin: 0 0 12px 0; 
            line-height: 1.7; 
            font-size: 1.08em;
        }
        
        .footer {
            text-align: center;
            margin-top: auto;
            padding: 5px 15px; /* 上下间距设为5px */
            height: auto; /* 让高度自适应内容 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            position: fixed; /* 固定在底部 */
            bottom: 5px; /* 距离底部5px */
            left: 280px; /* 与侧边栏对齐 */
            right: 0;
            background: transparent; /* 移除背景，让文字直接显示在页面背景上 */
            z-index: 999; /* 降低层级，不覆盖内容边框 */
        }
        
        /* 顶部导航栏样式 */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 26px;
            border: none;
            box-shadow: none;
            background: rgba(0,0,0,0.22);
            height: 54px;
            position: fixed; /* 固定顶部导航 */
            top: 0;
            right: 0;
            left: 280px; /* 与左侧菜单对齐 */
            z-index: 5;
            border-radius: 0;
            margin: 0;
        }
        
        /* 代理店名称显示样式 */
        .store-info, .user-info, .language-switcher {
            box-shadow: 0 2px 6px rgba(212,175,55,0.06);
            border: 1px solid rgba(212,175,55,0.12);
            background: rgba(25,25,25,0.70);
        }
        
        .store-info {
            padding: 8px 15px;
            border-radius: 8px;
            height: 40px;
            display: flex;
            align-items: center;
            box-sizing: border-box;
        }
        
        .store-info span, .user-position, .user-name, .language-btn {
            font-family: 'Montserrat', 'Source Han Sans SC', Arial, sans-serif;
        }
        
        .store-info span {
            color: var(--gold);
            font-size: 0.9em;
            font-weight: bold;
        }
        
        /* 右侧导航组 */
        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* 用户信息显示样式 */
        .user-info {
            padding: 8px 15px;
            border-radius: 8px;
            height: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-sizing: border-box;
        }
        
        .user-position {
            background: var(--gold);
            color: var(--black);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .user-name {
            color: var(--text-light);
            font-size: 0.9em;
            transition: all 0.2s ease;
        }
        
        .user-name:hover {
            background-color: rgba(212, 175, 55, 0.2);
            border-radius: 3px;
            padding: 2px 6px;
        }
        
        .user-name::after {
            content: ' ▼';
            font-size: 0.8em;
            opacity: 0.7;
            margin-left: 5px;
        }
        
        /* 语言切换样式 */
        .language-switcher {
            display: flex;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 8px;
            height: 40px;
            align-items: center;
            box-sizing: border-box;
        }
        
        .language-btn {
            background: transparent;
            color: var(--text-light);
            border: 1px solid var(--gold);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            min-width: 50px;
            white-space: nowrap;
        }
        
        .language-btn:hover {
            background: var(--gold);
            color: var(--black);
        }
        
        .language-btn.active {
            background: var(--gold);
            color: var(--black);
            font-weight: bold;
        }
        

        
        /* 保留其他所有原始样式 */
    </style>
</head>
<body>
    <div id="tsparticles"></div>
    
    <!-- 移动端菜单按钮 -->
    <div class="hamburger-menu" onclick="toggleMobileMenu()">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </div>
    
    <!-- 页面整体布局 -->
    <div class="layout-container">
        <!-- 左侧菜单栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">M</div>
                <div class="sidebar-subtitle">Mesia Professional</div>
                <div class="sidebar-title" data-i18n="system-title">Mesia首尔西部地区管理系统</div>
            </div>
            
            <!-- 侧边栏菜单 -->
            <div class="sidebar-menu">
                <!-- 概况总览 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="showContent('dashboard', event)">
                        <span class="sidebar-menu-icon">📊</span>
                        <span class="sidebar-menu-title" data-i18n="dashboard">概况总览</span>
                    </div>
                </div>
                
                <!-- 职员管理 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="toggleSidebarSubmenu('employee')">
                        <span class="sidebar-menu-icon">👤</span>
                        <span class="sidebar-menu-title" data-i18n="employee-management">职员管理</span>
                        <span class="sidebar-menu-arrow">▼</span>
                    </div>
                    <div class="sidebar-submenu" id="sidebar-employee-submenu">
                        <div class="sidebar-submenu-item" onclick="showContent('new-employee', event)" id="new-employee-menu">
                            <span data-i18n="new-employee">新增职员</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('employee-list', event)">
                            <span data-i18n="employee-list">职员列表</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('delete-employee', event)" id="delete-employee-menu">
                            <span data-i18n="delete-employee">删除职员</span>
                        </div>
                    </div>
                </div>
                
                <!-- 沙龙管理 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="toggleSidebarSubmenu('customer')">
                        <span class="sidebar-menu-icon">🏢</span>
                        <span class="sidebar-menu-title" data-i18n="customer-management">沙龙管理</span>
                        <span class="sidebar-menu-arrow">▼</span>
                    </div>
                    <div class="sidebar-submenu" id="sidebar-customer-submenu">
                        <div class="sidebar-submenu-item" onclick="showContent('new-salon', event)">
                            <span data-i18n="new-salon">新增沙龙</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('salon-info', event)">
                            <span data-i18n="salon-info">沙龙信息</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('delete-salon', event)" id="delete-salon-menu">
                            <span data-i18n="delete-salon">删除沙龙</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('district-management', event)" id="district-management-menu">
                            <span data-i18n="district-management">区域管理</span>
                        </div>
                    </div>
                </div>
                
                <!-- 产品管理 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="toggleSidebarSubmenu('product')">
                        <span class="sidebar-menu-icon">📦</span>
                        <span class="sidebar-menu-title" data-i18n="product-management">产品管理</span>
                        <span class="sidebar-menu-arrow">▼</span>
                    </div>
                    <div class="sidebar-submenu" id="sidebar-product-submenu">
                        <div class="sidebar-submenu-item" onclick="showContent('add-product', event)">
                            <span data-i18n="add-product">新增产品</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('product-list', event)">
                            <span data-i18n="product-list">产品列表</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('product-category', event)">
                            <span data-i18n="product-category">产品分类</span>
                        </div>
                    </div>
                </div>
                
                <!-- 库存管理 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="toggleSidebarSubmenu('inventory')">
                        <span class="sidebar-menu-icon">🔄</span>
                        <span class="sidebar-menu-title" data-i18n="inventory-management">库存管理</span>
                        <span class="sidebar-menu-arrow">▼</span>
                    </div>
                    <div class="sidebar-submenu" id="sidebar-inventory-submenu">
                        <div class="sidebar-submenu-item" onclick="showContent('stock-check', event)">
                            <span data-i18n="stock-check">库存盘点</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('restock-alert', event)">
                            <span data-i18n="restock-alert">补货提醒</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('usage-record', event)">
                            <span data-i18n="usage-record">使用记录</span>
                        </div>
                    </div>
                </div>
                
                <!-- 财务管理 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="toggleSidebarSubmenu('finance')">
                        <span class="sidebar-menu-icon">💰</span>
                        <span class="sidebar-menu-title" data-i18n="finance-management">财务管理</span>
                        <span class="sidebar-menu-arrow">▼</span>
                    </div>
                    <div class="sidebar-submenu" id="sidebar-finance-submenu">
                        <div class="sidebar-submenu-item" onclick="showContent('income-record', event)">
                            <span data-i18n="income-record">收入记录</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('expense-record', event)">
                            <span data-i18n="expense-record">支出记录</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('financial-report', event)">
                            <span data-i18n="financial-report">财务报表</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('performance-target', event)">
                            <span data-i18n="performance-target">业绩目标</span>
                        </div>
                    </div>
                </div>
                
                <!-- 操作管理 -->
                <div class="sidebar-menu-item">
                    <div class="sidebar-menu-header" onclick="toggleSidebarSubmenu('audit')">
                        <span class="sidebar-menu-icon">📋</span>
                        <span class="sidebar-menu-title" data-i18n="audit-management">操作管理</span>
                        <span class="sidebar-menu-arrow">▼</span>
                    </div>
                    <div class="sidebar-submenu" id="sidebar-audit-submenu">
                        <div class="sidebar-submenu-item" onclick="showContent('operation-history', event)">
                            <span data-i18n="operation-history">操作历史记录</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('data-comparison', event)">
                            <span data-i18n="data-comparison">数据对比查看</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('audit-report', event)">
                            <span data-i18n="audit-report">审计报告</span>
                        </div>
                        <div class="sidebar-submenu-item" onclick="showContent('approval-management', event)" id="approval-management-menu">
                            <span data-i18n="approval-management">审批管理</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 右侧内容区域 -->
        <div class="main-content">
            <!-- 顶部导航栏 -->
            <div class="top-nav">
                <!-- 左侧空白区域 -->
                <div>
                    <!-- 此处不显示任何内容 -->
                </div>
                
                <!-- 右侧信息组 -->
                <div class="nav-right">
                    <!-- 用户信息显示 -->
                    <div class="user-info" id="userInfo">
                        <span id="userPosition" class="user-position" data-i18n="admin">管理员</span>
                        <div class="user-name-container" style="position: relative;">
                            <span id="userName" class="user-name" onclick="showUserMenu()" style="cursor: pointer;" data-i18n="system-admin">系统管理员</span>
                            <!-- 用户菜单下拉框 -->
                            <div id="userMenuDropdown" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: rgba(24,24,24,0.95); border: 1px solid var(--gold); border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 1000; width: 120px;">
                                <div class="user-menu-item" onclick="logout()" style="padding: 10px 15px; color: var(--text-light); cursor: pointer; transition: all 0.3s; text-align: center;">
                                    <span data-i18n="logout">退出登录</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 语言切换器 -->
                    <div class="language-switcher">
                        <button class="language-btn active" onclick="setUserLanguage('zh')" id="btn-zh">中文</button>
                        <button class="language-btn" onclick="setUserLanguage('ko')" id="btn-ko">한국어</button>
                    </div>
                </div>
            </div>
            
            <!-- 内容区域容器 -->
            <div class="content-container">
                <!-- 概况总览页面 -->
                <div id="dashboard" class="content-area">
                    <h1 data-i18n="dashboard">概况总览</h1>
                    
                    <!-- 主要业绩面板 -->
                    <div style="background: rgba(35,35,35,0.95); border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                            <h2 style="margin: 0; color: var(--text-light); font-size: 1.2em;" data-i18n="main-performance">主要业绩</h2>
                            <div style="color: var(--gold);">
                                <span style="font-size: 1.1em;">&#x1F50D;</span>
                            </div>
                        </div>
                        <div style="padding: 0;">
                            <div style="text-align: right; padding: 10px 20px; color: #aaa; font-size: 0.9em;">
                                <span data-i18n="unit-label">[单位:千元]</span>
                            </div>
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: rgba(240,240,240,0.05);">
                                        <th style="padding: 12px 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1); width: 25%;" data-i18n="category">分类</th>
                                        <th style="padding: 12px 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1); width: 25%;" data-i18n="target">目标</th>
                                        <th style="padding: 12px 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1); width: 25%;" data-i18n="actual">实绩</th>
                                        <th style="padding: 12px 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1); width: 25%;" data-i18n="progress-rate">进度率(%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);" data-i18n="my-performance">我的业绩</td>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);">0</td>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);">0</td>
                                        <td style="padding: 15px; text-align: center; color: #4CAF50; border: 1px solid rgba(212, 175, 55, 0.1); font-weight: bold;">0</td>
                                    </tr>
                                    <tr style="background: rgba(240,240,240,0.05);">
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);" data-i18n="agency-total-performance">代理店总业绩</td>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);">0</td>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);">0</td>
                                        <td style="padding: 15px; text-align: center; color: #FFC107; border: 1px solid rgba(212, 175, 55, 0.1); font-weight: bold;">0</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);" data-i18n="transaction-salon-count">交易沙龙数</td>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);">0</td>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);">0</td>
                                        <td style="padding: 15px; text-align: center; color: #F44336; border: 1px solid rgba(212, 175, 55, 0.1); font-weight: bold;">0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 主要未处理业务面板 -->
                    <div style="background: rgba(35,35,35,0.95); border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                            <h2 style="margin: 0; color: var(--text-light); font-size: 1.2em;" data-i18n="pending-business">主要未处理业务</h2>
                            <div style="color: var(--gold);">
                                <span style="font-size: 1.1em;">&#x1F50D;</span>
                            </div>
                        </div>
                        <div style="padding: 0;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: rgba(240,240,240,0.05);">
                                        <th style="padding: 12px 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1); width: 70%;" data-i18n="category">分类</th>
                                        <th style="padding: 12px 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1); width: 30%;" data-i18n="count">件数</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);" data-i18n="outbound-pending">出库未批准</td>
                                        <td style="padding: 15px; text-align: center; border: 1px solid rgba(212, 175, 55, 0.1);">
                                            <a href="#" style="color: var(--gold); text-decoration: none; font-weight: bold; font-size: 1.1em;">0</a>
                                        </td>
                                    </tr>
                                    <tr style="background: rgba(240,240,240,0.05);">
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);" data-i18n="payment-pending">收款未批准</td>
                                        <td style="padding: 15px; text-align: center; border: 1px solid rgba(212, 175, 55, 0.1);">
                                            <a href="#" style="color: var(--gold); text-decoration: none; font-weight: bold; font-size: 1.1em;">0</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 15px; text-align: center; color: var(--text-light); border: 1px solid rgba(212, 175, 55, 0.1);" data-i18n="delivery-pending">配送未完成</td>
                                        <td style="padding: 15px; text-align: center; border: 1px solid rgba(212, 175, 55, 0.1);">
                                            <a href="#" style="color: var(--gold); text-decoration: none; font-weight: bold; font-size: 1.1em;">0</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 职员管理页面 -->
                <div id="new-employee" class="content-area">
                    <h1 data-i18n="new-employee">新增职员</h1>
                    <form id="newEmployeeForm">
                        <!-- 第一排：基本信息和联系信息 -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                            <!-- 基本信息 -->
                            <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3);">
                                <h3 style="color: var(--gold); margin: 0 0 12px 0; font-size: 1.1em;" data-i18n="basic-info">基本信息</h3>
                                
                                <div style="display: grid; gap: 10px;">
                                    <div>
                                        <label for="employeeName" style="display: block; color: var(--gold); margin-bottom: 4px; font-size: 0.9em;" data-i18n="employee-name">姓名：</label>
                                        <input type="text" id="employeeName" required style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                    </div>
                                    <div>
                                        <label for="employeePosition" style="display: block; color: var(--gold); margin-bottom: 4px; font-size: 0.9em;" data-i18n="employee-position">职位：</label>
                                        <select id="employeePosition" required style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                            <option value="salesperson" data-i18n="salesperson">业务员</option>
                                            <option value="manager" data-i18n="manager">经理</option>
                                            <option value="admin" data-i18n="admin">管理员</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="employeeEmail" style="display: block; color: var(--gold); margin-bottom: 4px; font-size: 0.9em;" data-i18n="work-email">工作邮箱：</label>
                                        <input type="email" id="employeeEmail" style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                        <div style="font-size: 0.8em; color: #999; margin-top: 2px;">员工可使用此邮箱在登录页面自主注册</div>
                                    </div>
                                    <div>
                                        <label for="employeeJoinDate" style="display: block; color: var(--gold); margin-bottom: 4px; font-size: 0.9em;" data-i18n="join-date">入职日期：</label>
                                        <input type="date" id="employeeJoinDate" style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 联系信息 -->
                            <div style="background: rgba(135, 206, 235, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(135, 206, 235, 0.3);">
                                <h3 style="color: #87CEEB; margin: 0 0 12px 0; font-size: 1.1em;" data-i18n="contact-info">联系信息</h3>
                                
                                <div>
                                    <label for="employeeMobile" style="display: block; color: #87CEEB; margin-bottom: 4px; font-size: 0.9em;" data-i18n="mobile-number">手机号：</label>
                                    <input type="tel" id="employeeMobile" oninput="formatPhoneNumber(this)" placeholder="13812345678 或 01029968866" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #87CEEB; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 第二排：银行账户信息 -->
                        <div style="background: rgba(144, 238, 144, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(144, 238, 144, 0.3); margin-bottom: 15px;">
                            <h3 style="color: #90EE90; margin: 0 0 12px 0; font-size: 1.1em;" data-i18n="bank-account-info">银行账户信息</h3>
                            
                            <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 12px; margin-bottom: 10px;">
                                <div>
                                    <label for="bankName" style="display: block; color: #90EE90; margin-bottom: 4px; font-size: 0.9em;" data-i18n="bank-name">银行名称：</label>
                                    <input type="text" id="bankName" placeholder="例：中国银行" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                </div>
                                <div>
                                    <label for="bankAccount" style="display: block; color: #90EE90; margin-bottom: 4px; font-size: 0.9em;" data-i18n="bank-account">银行账号：</label>
                                    <input type="text" id="bankAccount" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                </div>
                                <div>
                                    <label for="accountHolder" style="display: block; color: #90EE90; margin-bottom: 4px; font-size: 0.9em;" data-i18n="account-holder">账户持有人：</label>
                                    <input type="text" id="accountHolder" placeholder="默认使用职员姓名" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                                </div>
                            </div>
                            
                            <div>
                                <label for="bankBranch" style="display: block; color: #90EE90; margin-bottom: 4px; font-size: 0.9em;" data-i18n="bank-branch">备注：</label>
                                <input type="text" id="bankBranch" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.9em;">
                            </div>
                        </div>
                        
                        <button type="submit" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="add">添加</button>
                    </form>
                </div>
                
                <div id="employee-list" class="content-area">
                    <h1 data-i18n="employee-list">职员列表</h1>
                    <p data-i18n="employee-list-desc">这里显示所有职员的详细信息列表。</p>
                    
                    <!-- 主容器：分为左右两部分 -->
                    <div id="employee-list-container" style="display: flex; gap: 20px; margin-top: 20px; height: calc(100vh - 320px); min-height: 400px;">
                        <!-- 左侧：职员列表 -->
                        <div id="employee-list-left" style="flex: 0 0 40%; overflow-y: auto; padding-right: 10px; box-sizing: border-box;">
                            <div id="employee-list-content">
                                <!-- 职员列表将在这里动态生成 -->
                            </div>
                        </div>
                        
                        <!-- 右侧：职员详情 -->
                        <div id="employee-list-right" style="flex: 1; display: none; box-sizing: border-box; padding-bottom: 30px;">
                            <div id="employee-detail-content" style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); margin-bottom: 20px;">
                                <!-- 职员详情将在这里动态显示 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 新增产品页面 -->
                <div id="add-product" class="content-area">
                    <h1 style="margin-bottom: 15px;" data-i18n="add-product">新增产品</h1>
                    
                    <form id="addProductForm">
                        <!-- 产品基本信息 -->
                        <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); margin-bottom: 15px;">
                            <h3 style="color: var(--gold); margin: 0 0 15px 0; font-size: 1.1em;" data-i18n="product-basic-info">产品基本信息</h3>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label for="productName" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="product-name">产品名称：</label>
                                    <input type="text" id="productName" required style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label for="brandName" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="brand-name">品牌名称：</label>
                                    <input type="text" id="brandName" style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label for="productModel" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="product-model">型号：</label>
                                    <input type="text" id="productModel" style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label for="productSku" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="product-sku">货号：</label>
                                    <input type="text" id="productSku" style="width: 100%; padding: 8px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label for="productCategory" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="product-category-select">产品分类：</label>
                                <select id="productCategory" style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                    <option value="" data-i18n="please-select-category">请选择产品分类...</option>
                                    <option value="uncategorized" data-i18n="uncategorized">未分类</option>
                                    <!-- 其他分类选项将通过JavaScript动态添加 -->
                                </select>
                            </div>
                        </div>
                        
                        <!-- 规格信息 -->
                        <div style="background: rgba(135, 206, 235, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(135, 206, 235, 0.3); margin-bottom: 15px;">
                            <h3 style="color: #87CEEB; margin: 0 0 15px 0; font-size: 1.1em;" data-i18n="product-specifications">规格信息</h3>
                            
                            <!-- 单位规格 -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label for="unitType" style="display: block; color: #87CEEB; margin-bottom: 5px;" data-i18n="unit-type">数量单位：</label>
                                    <select id="unitType" onchange="updateUnitExample()" style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid #87CEEB; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                        <option value="个" data-i18n="unit-piece">个</option>
                                        <option value="只" data-i18n="unit-only">只</option>
                                        <option value="支" data-i18n="unit-stick">支</option>
                                        <option value="瓶" data-i18n="unit-bottle">瓶</option>
                                        <option value="盒" data-i18n="unit-box">盒</option>
                                        <option value="袋" data-i18n="unit-bag">袋</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="weightVolume" style="display: block; color: #87CEEB; margin-bottom: 5px;" data-i18n="weight-volume">重量/体积：</label>
                                    <input type="number" id="weightVolume" min="0" step="0.1" onchange="calculateTotalWeight()" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #87CEEB; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label for="weightUnit" style="display: block; color: #87CEEB; margin-bottom: 5px;" data-i18n="weight-unit">重量单位：</label>
                                    <select id="weightUnit" onchange="calculateTotalWeight()" style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid #87CEEB; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                        <option value="g" data-i18n="unit-gram">g（克）</option>
                                        <option value="ml" data-i18n="unit-ml">ml（毫升）</option>
                                        <option value="kg" data-i18n="unit-kg">kg（千克）</option>
                                        <option value="l" data-i18n="unit-liter">L（升）</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- 包装规格 -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label for="perBoxCount" style="display: block; color: #87CEEB; margin-bottom: 5px;" data-i18n="per-box-count">每盒数量：</label>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <span style="color: #87CEEB; font-size: 0.9em;">每盒</span>
                                        <input type="number" id="perBoxCount" min="1" value="1" onchange="calculateTotalWeight()" style="flex: 1; padding: 8px; background: transparent; border: 1px solid #87CEEB; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                        <span id="perBoxUnit" style="color: #87CEEB; font-size: 0.9em;">瓶</span>
                                    </div>
                                </div>
                                <div>
                                    <label for="perCaseCount" style="display: block; color: #87CEEB; margin-bottom: 5px;" data-i18n="per-case-count">箱规：</label>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <span style="color: #87CEEB; font-size: 0.9em;">每箱</span>
                                        <input type="number" id="perCaseCount" min="1" value="1" onchange="calculateTotalWeight()" style="flex: 1; padding: 8px; background: transparent; border: 1px solid #87CEEB; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                        <span style="color: #87CEEB; font-size: 0.9em;">盒</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 规格计算结果 -->
                            <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 5px; border: 1px solid #87CEEB;">
                                <p style="color: #87CEEB; margin: 0; font-size: 0.95em;">
                                    <strong data-i18n="specification-summary">规格汇总：</strong>
                                    <span id="specificationSummary">每瓶 0g，每盒 1瓶，每箱 1盒，每箱总重量 0g</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- 价格信息 -->
                        <div style="background: rgba(144, 238, 144, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(144, 238, 144, 0.3); margin-bottom: 15px;">
                            <h3 style="color: #90EE90; margin: 0 0 15px 0; font-size: 1.1em;" data-i18n="price-info">价格信息</h3>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div>
                                    <label for="purchasePrice" style="display: block; color: #90EE90; margin-bottom: 5px;" data-i18n="purchase-price">进货价（₩）：</label>
                                    <input type="text" id="purchasePrice" oninput="formatKoreanPrice(this)" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label for="wholesalePrice" style="display: block; color: #90EE90; margin-bottom: 5px;" data-i18n="wholesale-price">批发价（₩）：</label>
                                    <input type="text" id="wholesalePrice" oninput="formatKoreanPrice(this)" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                                <div>
                                    <label for="retailPrice" style="display: block; color: #90EE90; margin-bottom: 5px;" data-i18n="retail-price">零售价（₩）：</label>
                                    <input type="text" id="retailPrice" oninput="formatKoreanPrice(this)" style="width: 100%; padding: 8px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: flex; align-items: center; color: #90EE90; cursor: pointer;">
                                    <input type="checkbox" id="isOnSale" checked style="margin-right: 8px;">
                                    <span data-i18n="is-on-sale">在售</span>
                                </label>
                                <label style="display: flex; align-items: center; color: #90EE90; cursor: pointer; margin-top: 8px;">
                                    <input type="checkbox" id="isDiscontinued" style="margin-right: 8px;">
                                    <span data-i18n="is-discontinued">停产</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 备注信息 -->
                        <div style="background: rgba(255, 182, 193, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(255, 182, 193, 0.3); margin-bottom: 20px;">
                            <h3 style="color: #FFB6C1; margin: 0 0 15px 0; font-size: 1.1em;" data-i18n="notes-info">备注信息</h3>
                            
                            <div style="margin-bottom: 15px;">
                                <label for="productNotes" style="display: block; color: #FFB6C1; margin-bottom: 5px;" data-i18n="product-notes">备注：</label>
                                <textarea id="productNotes" data-i18n-placeholder="product-notes-placeholder" placeholder="请输入产品备注信息..." style="width: 100%; padding: 10px; background: transparent; border: 1px solid #FFB6C1; color: var(--text-light); border-radius: 5px; box-sizing: border-box; min-height: 80px; resize: vertical;"></textarea>
                            </div>
                        </div>
                        
                        <!-- 操作按钮 -->
                        <div style="display: flex; gap: 15px; justify-content: flex-end;">
                            <button type="button" onclick="resetProductForm()" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="cancel">取消</button>
                            <button type="submit" style="background: var(--gold); color: var(--black); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="add-product-submit">添加产品</button>
                        </div>
                    </form>
                </div>

                <div id="product-category" class="content-area">
                    <h1 data-i18n="product-category">产品分类</h1>
                    
                    <!-- 添加产品分类按钮 -->
                    <div style="margin: 20px 0; display: flex; justify-content: space-between; align-items: center;">
                        <p data-i18n="product-category-content">管理产品分类信息</p>
                        <button onclick="openCreateCategoryModal()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="create-product-category">创建产品分类</button>
                    </div>
                    
                    <!-- 产品分类列表 -->
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); margin-top: 20px;">
                        <h3 style="color: var(--gold); margin: 0 0 15px 0;" data-i18n="category-list">产品分类列表</h3>
                        <div id="categoryList" style="margin-top: 15px; max-height: calc(100vh - 320px); overflow-y: auto;">
                            <!-- 产品分类列表将在这里动态生成 -->
                            <div style="text-align: center; color: #cccccc; padding: 20px;" data-i18n="no-categories">暂无产品分类，请点击"创建产品分类"添加</div>
                        </div>
                    </div>
                </div>

                <div id="product-list" class="content-area">
                    <h1 style="margin-bottom: 15px;" data-i18n="product-list">产品列表</h1>
                    
                    <!-- 搜索筛选和排序控制 -->
                    <div id="product-count-display" style="margin: 10px 0; padding: 10px; background: rgba(212, 175, 55, 0.1); border-radius: 5px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <!-- 左侧：搜索框和筛选 -->
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="text" id="productSearchInput" data-i18n-placeholder="search-product-placeholder" placeholder="搜索产品名/品牌/货号..." oninput="searchProducts()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; min-width: 200px; font-size: 0.9em;">
                                <select id="productCategoryFilter" onchange="searchProducts()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; font-size: 0.9em;">
                                    <option value="" data-i18n="all-categories">全部分类</option>
                                    <option value="uncategorized" data-i18n="uncategorized">未分类</option>
                                    <!-- 其他分类选项将通过JavaScript动态添加 -->
                                </select>
                                <select id="productStatusFilter" onchange="searchProducts()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; font-size: 0.9em;">
                                    <option value="" data-i18n="all-status">全部状态</option>
                                    <option value="on-sale" data-i18n="on-sale">在售</option>
                                    <option value="discontinued" data-i18n="discontinued">停产</option>
                                </select>
                                <button onclick="clearProductFilters()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="clear-filters">清空筛选</button>
                            </div>
                            
                            <!-- 右侧：排序按钮 -->
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <button id="sort-product-name" onclick="toggleProductSort('name')" style="background: var(--gold); color: var(--black); border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em; opacity: 0.7;" data-i18n="sort-by-name">产品名称</button>
                                <button id="sort-brand" onclick="toggleProductSort('brand')" style="background: var(--gold); color: var(--black); border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em; opacity: 0.7;" data-i18n="sort-by-brand">品牌</button>
                                <button id="sort-category" onclick="toggleProductSort('category')" style="background: var(--gold); color: var(--black); border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em; opacity: 0.7;" data-i18n="sort-by-category">分类</button>
                                <button id="sort-price" onclick="toggleProductSort('price')" style="background: var(--gold); color: var(--black); border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em; opacity: 0.7;" data-i18n="sort-by-price">进货价</button>
                                <button id="sort-default" onclick="toggleProductSort('default')" style="background: var(--gold); color: var(--black); border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.85em; opacity: 1;" data-i18n="sort-default">默认排序</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 统计信息 -->
                    <div style="margin: 10px 0; padding: 10px; background: rgba(135, 206, 235, 0.1); border-radius: 5px; border: 1px solid rgba(135, 206, 235, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; color: #87CEEB;">
                            <span id="product-statistics">筛选结果：显示 0 个产品</span>
                            <div style="display: flex; gap: 15px; font-size: 0.9em;">
                                <span id="total-products">总产品数：0</span>
                                <span id="filtered-products">筛选结果：0</span>
                                <span id="on-sale-products">在售：0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 分页控制面板 -->
                    <div id="product-pagination-controls" style="margin: 10px 0; padding: 10px; background: rgba(144, 238, 144, 0.1); border-radius: 5px; border: 1px solid rgba(144, 238, 144, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px; color: #90EE90;">
                                <span style="font-weight: bold; font-size: 1em;" data-i18n="pagination-info">分页信息：</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 0.9em;" data-i18n="go-to-page">跳转到第</span>
                                    <input type="number" id="product-page-jump-input" min="1" onkeypress="handleProductPageJumpKeypress(event)" style="width: 60px; padding: 6px 8px; background: var(--dark-gray); border: 1px solid #90EE90; color: #90EE90; border-radius: 3px; text-align: center; font-size: 0.9em;">
                                    <span style="font-size: 0.9em;" data-i18n="page-unit">页</span>
                                    <button onclick="jumpToProductPage()" style="background: #90EE90; color: var(--black); border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="jump-btn">跳转</button>
                                </div>
                            </div>
                            <div id="product-pagination" style="display: flex; align-items: center; gap: 8px; color: #90EE90; font-size: 0.9em;">
                                <button id="product-first-page" onclick="goToProductPage(1)" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="first-page">首页</button>
                                <button id="product-prev-page" onclick="goToPrevProductPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="prev-page">上一页</button>
                                <span id="product-page-info" style="background: var(--gold); color: var(--black); padding: 6px 16px; border-radius: 3px; font-weight: bold; font-size: 0.9em;">第 1 页 / 共 1 页 (0 个项目)</span>
                                <button id="product-next-page" onclick="goToNextProductPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="next-page">下一页</button>
                                <button id="product-last-page" onclick="goToLastProductPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="last-page">末页</button>
                                <select id="product-items-per-page" onchange="changeProductItemsPerPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; font-size: 0.9em; margin-left: 10px;">
                                    <option value="10" data-i18n="items-per-page-10">每页显示: 10</option>
                                    <option value="20" selected data-i18n="items-per-page-20">每页显示: 20</option>
                                    <option value="50" data-i18n="items-per-page-50">每页显示: 50</option>
                                </select>
                                <span style="font-size: 0.9em;" data-i18n="items-unit">条</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 左右分栏布局 -->
                    <div style="display: flex; gap: 20px; height: calc(100vh - 500px); min-height: 400px;">
                        <!-- 左侧产品列表 -->
                        <div id="product-list-left" style="width: 40%; background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); display: flex; flex-direction: column; height: 100%;">
                            <div style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); flex-shrink: 0; height: 53px; box-sizing: border-box; display: flex; align-items: center; justify-content: space-between;">
                                <h3 style="color: var(--gold); margin: 0;" data-i18n="product-list">产品列表</h3>
                                <span style="color: var(--gold); font-weight: bold; font-size: 0.9em;" id="product-count-text" data-i18n="total-products-count" data-i18n-params='{"count": "0"}'>总计 0 个产品</span>
                            </div>
                            <div id="product-list-content" style="padding: 15px; flex: 1; overflow-y: auto; box-sizing: border-box;">
                                <!-- 产品列表将在这里动态生成 -->
                                <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-products">暂无产品数据</p>
                            </div>
                        </div>
                        
                        <!-- 右侧产品详情 -->
                        <div id="product-detail-right" style="width: 60%; background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); display: none; flex-direction: column; height: 100%;">
                            <div id="product-detail-header" style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; height: 53px; box-sizing: border-box;">
                                <h3 style="color: var(--gold); margin: 0;" data-i18n="product-detail">产品详情</h3>
                                <div id="product-action-buttons" style="display: flex; gap: 10px;">
                                    <!-- 按钮将在这里动态生成 -->
                                </div>
                            </div>
                            <div id="product-detail-content" style="padding: 20px; flex: 1; overflow-y: visible; line-height: 1.6; box-sizing: border-box;">
                                <!-- 产品详情将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 删除职员页面 -->
                <div id="delete-employee" class="content-area">
                    <h1 data-i18n="delete-employee">删除职员</h1>
                    <div style="margin-top: 20px;">
                        <label for="deleteEmployeeSelect" style="display: block; color: var(--gold); margin-bottom: 10px;" data-i18n="select-employee-to-delete">选择要删除的职员：</label>
                        <select id="deleteEmployeeSelect" style="width: 100%; padding: 10px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                            <option value="" data-i18n="please-select-employee">请选择职员...</option>
                        </select>
                        <button onclick="deleteSelectedEmployee()" style="background: #ff6666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;" data-i18n="confirm-delete">确认删除</button>
                    </div>
                </div>
                
                <!-- 新增沙龙页面 -->
                <div id="new-salon" class="content-area">
                    <h1 data-i18n="new-salon">新增沙龙</h1>
                    
                    <!-- 左右分栏布局 -->
                    <div style="display: flex; gap: 20px; height: calc(100vh - 320px); min-height: 500px;">
                        <!-- 左侧：单个新增页面 -->
                        <div style="flex: 0 0 40%; background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); padding: 20px; height: 100%; overflow-y: auto; box-sizing: border-box;">
                            <h2 style="color: var(--gold); margin: 0 0 15px 0; text-align: center; font-size: 1.1em;" data-i18n="single-add-salon">单个新增沙龙</h2>
                    
                    <form id="newSalonForm">
                            <!-- 沙龙基本信息 -->
                                <div style="background: rgba(212, 175, 55, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); margin-bottom: 12px;">
                                    <h3 style="color: var(--gold); margin: 0 0 10px 0; font-size: 0.95em;" data-i18n="salon-basic-info">沙龙基本信息</h3>
                                
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <label for="salonName" style="display: block; color: var(--gold); margin-bottom: 3px; font-size: 0.85em;" data-i18n="salon-name">沙龙名称：</label>
                                        <input type="text" id="salonName" required style="width: 100%; padding: 6px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="salonAddress" style="display: block; color: var(--gold); margin-bottom: 3px; font-size: 0.85em;" data-i18n="salon-address">沙龙地址：</label>
                                        <input type="text" id="salonAddress" required style="width: 100%; padding: 6px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="businessLicense" style="display: block; color: var(--gold); margin-bottom: 3px; font-size: 0.85em;" data-i18n="business-license">营业执照号码：</label>
                                        <input type="text" id="businessLicense" oninput="formatBusinessLicense(this)" placeholder="000-00-00000" style="width: 100%; padding: 6px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="responsibleEmployee" style="display: block; color: var(--gold); margin-bottom: 3px; font-size: 0.85em;" data-i18n="responsible-employee">负责职员：</label>
                                        <select id="responsibleEmployee" style="width: 100%; padding: 6px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                            <option value="" data-i18n="please-select-employee">请选择职员...</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 院长信息和联系信息 -->
                                <div style="background: rgba(144, 238, 144, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(144, 238, 144, 0.3); margin-bottom: 15px;">
                                    <h3 style="color: #90EE90; margin: 0 0 10px 0; font-size: 0.95em;" data-i18n="director-info">院长信息</h3>
                                
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <label for="directorName" style="display: block; color: #90EE90; margin-bottom: 3px; font-size: 0.85em;" data-i18n="director-name">院长姓名：</label>
                                        <input type="text" id="directorName" style="width: 100%; padding: 6px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="directorMobile" style="display: block; color: #90EE90; margin-bottom: 3px; font-size: 0.85em;" data-i18n="director-mobile">院长手机：</label>
                                        <input type="tel" id="directorMobile" oninput="formatPhoneNumber(this)" placeholder="000-0000-0000" style="width: 100%; padding: 6px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="salonPhone" style="display: block; color: #90EE90; margin-bottom: 3px; font-size: 0.85em;" data-i18n="salon-phone">店铺电话：</label>
                                        <input type="tel" id="salonPhone" style="width: 100%; padding: 6px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="salonEmail" style="display: block; color: #90EE90; margin-bottom: 3px; font-size: 0.85em;" data-i18n="salon-email">电子邮箱：</label>
                                        <input type="email" id="salonEmail" style="width: 100%; padding: 6px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em;">
                                    </div>
                                    <div>
                                        <label for="salonNotes" style="display: block; color: #90EE90; margin-bottom: 3px; font-size: 0.85em;" data-i18n="notes">备注：</label>
                                        <textarea id="salonNotes" data-i18n-placeholder="notes-placeholder" placeholder="在这里添加备注信息..." style="width: 100%; padding: 6px; background: transparent; border: 1px solid #90EE90; color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-size: 0.85em; min-height: 60px; resize: vertical; font-family: inherit;"></textarea>
                                </div>
                            </div>
                        </div>
                        
                                <button type="submit" style="background: var(--gold); color: var(--black); border: none; padding: 6px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em;" data-i18n="add">添加</button>
                    </form>
                        </div>
                        
                        <!-- 右侧：批量新增页面 -->
                        <div style="flex: 1; background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(135, 206, 235, 0.3); padding: 20px; height: 100%; overflow: hidden; display: flex; flex-direction: column; box-sizing: border-box;">
                            <h2 style="color: #87CEEB; margin: 0 0 15px 0; text-align: center; font-size: 1.1em;" data-i18n="batch-add-salon">批量新增沙龙</h2>
                            
                            <!-- 批量上传沙龙 -->
                            <div style="background: rgba(135, 206, 235, 0.1); padding: 12px; border-radius: 8px; border: 1px solid rgba(135, 206, 235, 0.3); margin-bottom: 12px; flex-shrink: 0;">
                                <h3 style="color: #87CEEB; margin: 0 0 10px 0; font-size: 0.95em;" data-i18n="batch-upload-salon">批量上传沙龙</h3>
                                
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; color: #87CEEB; margin-bottom: 6px; font-size: 0.85em;" data-i18n="select-file">选择文件：</label>
                                    
                                    <!-- 文件上传区域 -->
                                    <div id="fileUploadArea" style="border: 2px dashed #87CEEB; border-radius: 5px; padding: 8px; text-align: center; cursor: pointer; position: relative; background: rgba(0,0,0,0.3); min-height: 45px;" onclick="document.getElementById('salonFileInput').click()">
                                        <input type="file" id="salonFileInput" accept=".xlsx,.xls" style="display: none;" onchange="previewSalonFile(this)">
                                        <div id="fileUploadIconArea" style="display: flex; align-items: center; justify-content: center; gap: 8px; height: 45px;">
                                            <span style="font-size: 1.2em; color: #87CEEB;">📁</span>
                                            <span style="color: #87CEEB; font-size: 0.85em;" data-i18n="click-to-upload-file">点击上传文件</span>
                                        </div>
                                        <!-- 文件预览区域 -->
                                        <div id="filePreviewArea" style="display: none;">
                                            <p id="fileName" style="color: var(--text-light); font-size: 0.85em; margin: 4px 0;"></p>
                                            <button type="button" onclick="removeSalonFile(event)" style="background: var(--gold); color: var(--black); border: none; padding: 6px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em;" data-i18n="remove-file">移除文件</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;">
                                    <button type="button" onclick="processSalonFile()" style="background: var(--gold); color: var(--black); border: none; padding: 6px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em;" data-i18n="process-file">处理文件</button>
                                    <button type="button" onclick="downloadTemplate()" style="background: var(--gold); color: var(--black); border: none; padding: 6px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em;" data-i18n="download-template">下载样例模板</button>
                                    <button type="button" id="confirmBatchCreateBtn" onclick="confirmBatchCreate()" style="display: none; background: var(--gold); color: var(--black); border: none; padding: 6px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em;" data-i18n="confirm-batch-create">确认批量创建</button>
                                    <button type="button" id="cancelBatchBtn" onclick="cancelBatch()" style="display: none; background: var(--gold); color: var(--black); border: none; padding: 6px 16px; border-radius: 5px; cursor: pointer; font-size: 0.85em;" data-i18n="cancel">取消</button>
                                </div>
                            </div>
                            
                            <!-- 数据预览区域 -->
                            <div id="dataPreviewArea" style="display: none; flex: 1; flex-direction: column; min-height: 0;">
                                <label style="display: block; color: #87CEEB; margin-bottom: 8px; font-size: 0.9em; flex-shrink: 0;" data-i18n="data-preview">数据预览：</label>
                                <div style="display: flex; align-items: center; margin-bottom: 8px; flex-wrap: wrap; gap: 8px; flex-shrink: 0;">
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" style="margin-right: 3px;">
                                    <label for="selectAll" style="color: var(--text-light); margin-right: 10px; font-size: 0.85em;" data-i18n="select-all">全选</label>
                                    <span style="color: var(--text-light); margin-right: 10px; font-size: 0.85em;" data-i18n="selected-count">已选择 0 个沙龙</span>
                                    <label for="responsibleEmployeeSelect" style="color: #87CEEB; margin-right: 5px; font-size: 0.85em;" data-i18n="assign-responsible">指定负责人：</label>
                                    <select id="responsibleEmployeeSelect" style="padding: 4px 6px; background: var(--dark-gray); border: 1px solid #87CEEB; color: var(--text-light); border-radius: 3px; margin-right: 8px; font-size: 0.8em;">
                                        <option value="" data-i18n="please-select-employee">请选择职员...</option>
                                    </select>
                                    <button type="button" onclick="assignResponsible()" style="background: var(--gold); color: var(--black); border: none; padding: 4px 12px; border-radius: 3px; cursor: pointer; font-size: 0.8em;" data-i18n="assign-responsible-btn">分配负责人</button>
                                </div>
                                
                                <div id="dataPreviewTable" style="flex: 1; overflow-y: auto; border: 1px solid #87CEEB; border-radius: 5px; min-height: 0;">
                                    <!-- 数据预览表格将在这里动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 沙龙信息页面 -->
                <div id="salon-info" class="content-area">
                    <h1 style="margin-bottom: 15px;" data-i18n="salon-info">沙龙信息</h1>
                    
                    <!-- 搜索筛选和排序控制 -->
                    <div id="salon-count-display" style="margin: 10px 0; padding: 10px; background: rgba(212, 175, 55, 0.1); border-radius: 5px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <!-- 左侧：搜索框和筛选 -->
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="text" id="salonSearchInput" data-i18n-placeholder="search-salon-placeholder" placeholder="搜索沙龙名/院长名/手机号..." oninput="searchSalons()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; min-width: 200px; font-size: 0.9em;">
                                <select id="responsibleFilter" onchange="searchSalons()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; font-size: 0.9em;">
                                    <option value="" data-i18n="all-employees">所有职员</option>
                                </select>
                                                        <select id="districtFilter" onchange="searchSalons()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; font-size: 0.9em;">
                            <option value="" data-i18n="all-districts">全部区域</option>
                            <option value="yeongdeungpo" data-i18n="district-yeongdeungpo">永登浦区</option>
                            <option value="guro" data-i18n="district-guro">九老区</option>
                            <option value="geumcheon" data-i18n="district-geumcheon">衿川区</option>
                            <option value="yangcheon" data-i18n="district-yangcheon">阳川区</option>
                            <option value="gangso" data-i18n="district-gangso">江西区</option>
                            <option value="others" data-i18n="district-others">其他地区</option>
                            <option value="overseas" data-i18n="district-overseas">海外区域</option>
                        </select>
                                <button onclick="clearAllFilters()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="clear-filters">清空筛选</button>
                            </div>
                            
                            <!-- 右侧：排序按钮 -->
                            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                <button id="sort-name" onclick="toggleSalonSort('name')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-name">沙龙名称</button>
                                <button id="sort-address" onclick="toggleSalonSort('address')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-address">地址名称</button>
                                <button id="sort-addTime" onclick="toggleSalonSort('addTime')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-add-time">新增时间</button>
                                <button id="sort-lastTransaction" onclick="toggleSalonSort('lastTransaction')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-last-transaction">最后交易</button>
                                <button id="sort-overdueDays" onclick="toggleSalonSort('overdueDays')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-overdue-days">欠款天数</button>
                                <button id="sort-overdueAmount" onclick="toggleSalonSort('overdueAmount')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-overdue-amount">欠款金额</button>
                                <button id="sort-default" onclick="toggleSalonSort('default')" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;" data-i18n="sort-default">默认排序</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 统计信息 -->
                    <div style="margin: 10px 0; padding: 10px; background: rgba(135, 206, 235, 0.1); border-radius: 5px; border: 1px solid rgba(135, 206, 235, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; color: #87CEEB;">
                            <span id="salon-statistics">筛选结果：显示 0 个沙龙</span>
                            <div style="display: flex; gap: 15px; font-size: 0.9em;">
                                <span id="total-salons">总沙龙数：0</span>
                                <span id="filtered-salons">筛选结果：0</span>
                                <span id="current-page-salons">当前页：0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 分页控制面板 -->
                    <div id="salon-pagination-controls" style="margin: 10px 0; padding: 10px; background: rgba(144, 238, 144, 0.1); border-radius: 5px; border: 1px solid rgba(144, 238, 144, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px; color: #90EE90;">
                                <span style="font-weight: bold; font-size: 1em;" data-i18n="pagination-info">分页信息：</span>
                                <!-- 跳转到指定页面 -->
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 0.9em;" data-i18n="go-to-page">跳转到第</span>
                                    <input type="number" id="page-jump-input" min="1" onkeypress="handlePageJumpKeypress(event)" style="width: 60px; padding: 6px 8px; background: var(--dark-gray); border: 1px solid #90EE90; color: #90EE90; border-radius: 3px; text-align: center; font-size: 0.9em;">
                                    <span style="font-size: 0.9em;" data-i18n="page-unit">页</span>
                                    <button onclick="jumpToPage()" style="background: #90EE90; color: var(--black); border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="jump-btn">跳转</button>
                                </div>
                            </div>
                            <!-- 分页控件 -->
                            <div id="salon-pagination" style="display: flex; align-items: center; gap: 8px; color: #90EE90; font-size: 0.9em;">
                                <button id="first-page" onclick="goToSalonPage(1)" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="first-page">首页</button>
                                <button id="prev-page" onclick="goToPrevSalonPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="prev-page">上一页</button>
                                <span id="page-info" style="background: var(--gold); color: var(--black); padding: 6px 16px; border-radius: 3px; font-weight: bold; font-size: 0.9em;">第 1 页 / 共 1 页 (1 个项目)</span>
                                <button id="next-page" onclick="goToNextSalonPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="next-page">下一页</button>
                                <button id="last-page" onclick="goToLastSalonPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="last-page">末页</button>
                                <select id="items-per-page" onchange="changeItemsPerPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; font-size: 0.9em; margin-left: 10px;">
                                    <option value="10" data-i18n="items-per-page-10">每页显示: 10</option>
                                    <option value="20" selected data-i18n="items-per-page-20">每页显示: 20</option>
                                    <option value="50" data-i18n="items-per-page-50">每页显示: 50</option>
                                </select>
                                <span style="font-size: 0.9em;" data-i18n="items-unit">条</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 左右分栏布局 -->
                    <div style="display: flex; gap: 20px; height: calc(100vh - 500px); min-height: 400px;">
                        <!-- 左侧沙龙列表 -->
                        <div id="salon-list-left" style="width: 40%; background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); display: flex; flex-direction: column; height: 100%;">
                            <div style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); flex-shrink: 0; height: 53px; box-sizing: border-box; display: flex; align-items: center; justify-content: space-between;">
                                <h3 style="color: var(--gold); margin: 0;" data-i18n="salon-list">沙龙列表</h3>
                                <span style="color: var(--gold); font-weight: bold; font-size: 0.9em;" id="salon-count-text" data-i18n="total-salons-count" data-i18n-params='{"count": "851"}'>总计 851 家沙龙</span>
                            </div>
                            <div id="salon-list-content" style="padding: 15px; flex: 1; overflow-y: auto; box-sizing: border-box;">
                                <!-- 沙龙列表将在这里动态生成 -->
                                <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-salons">暂无沙龙数据</p>
                            </div>
                        </div>
                        
                        <!-- 右侧沙龙详情 -->
                        <div id="salon-detail-right" style="width: 60%; background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); display: none; flex-direction: column; height: 100%;">
                            <div id="salon-detail-header" style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; height: 53px; box-sizing: border-box;">
                                <h3 style="color: var(--gold); margin: 0;" data-i18n="salon-detail">沙龙详情</h3>
                                <div id="salon-action-buttons" style="display: flex; gap: 10px;">
                                    <!-- 按钮将在这里动态生成 -->
                                </div>
                            </div>
                            <div id="salon-detail-content" style="padding: 20px; flex: 1; overflow-y: auto; line-height: 1.6; box-sizing: border-box;">
                                <!-- 沙龙详情将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 删除沙龙页面 -->
                <div id="delete-salon" class="content-area">
                    <h1 style="margin-bottom: 15px;" data-i18n="delete-salon">删除沙龙</h1>
                    
                    <!-- 筛选控制区域 -->
                    <div id="delete-salon-filters" style="margin: 10px 0; padding: 10px; background: rgba(212, 175, 55, 0.1); border-radius: 5px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <!-- 左侧：筛选条件 -->
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="text" id="deleteSalonSearchInput" data-i18n-placeholder="search-salon-placeholder" placeholder="搜索沙龙名/院长名/手机号..." oninput="filterSalonsForDelete()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; min-width: 200px; font-size: 0.9em;">
                                <select id="deleteResponsibleFilter" onchange="filterSalonsForDelete()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; font-size: 0.9em;">
                                    <option value="" data-i18n="all-employees">所有职员</option>
                                </select>
                                <select id="deleteDistrictFilter" onchange="filterSalonsForDelete()" style="padding: 8px 12px; background: rgba(24,24,24,0.8); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; font-size: 0.9em;">
                                    <option value="" data-i18n="all-districts">全部区域</option>
                                                                <option value="yeongdeungpo" data-i18n="district-yeongdeungpo">永登浦区</option>
                            <option value="guro" data-i18n="district-guro">九老区</option>
                            <option value="geumcheon" data-i18n="district-geumcheon">衿川区</option>
                            <option value="yangcheon" data-i18n="district-yangcheon">阳川区</option>
                            <option value="gangso" data-i18n="district-gangso">江西区</option>
                            <option value="others" data-i18n="district-others">其他地区</option>
                            <option value="overseas" data-i18n="district-overseas">海外区域</option>
                                </select>
                                <button onclick="clearDeleteFilters()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="clear-filters">清空筛选</button>
                            </div>
                            
                            <!-- 右侧：选择和删除操作 -->
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                                <button onclick="selectAllFilteredSalons()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="select-all">全选</button>
                                <button onclick="deselectAllSalonsForDelete()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="deselect-all">取消全选</button>
                                <span id="delete-selected-count" style="color: var(--gold); font-weight: bold; font-size: 0.9em; margin: 0 10px;">已选择：0 个沙龙</span>
                                <button onclick="deleteSelectedSalonsAdvanced()" style="background: #ff4444; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="delete-selected">删除选中项</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 统计信息 -->
                    <div style="margin: 10px 0; padding: 10px; background: rgba(135, 206, 235, 0.1); border-radius: 5px; border: 1px solid rgba(135, 206, 235, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; color: #87CEEB;">
                            <span id="delete-salon-statistics">筛选结果：显示 0 个沙龙</span>
                            <div style="display: flex; gap: 15px; font-size: 0.9em;">
                                <span id="delete-total-salons">总沙龙数：0</span>
                                <span id="delete-filtered-salons">筛选结果：0</span>
                                <span id="delete-selected-salons">已选择：0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 分页控制 -->
                    <div id="delete-salon-pagination-controls" style="margin: 10px 0; padding: 10px; background: rgba(144, 238, 144, 0.1); border-radius: 5px; border: 1px solid rgba(144, 238, 144, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div style="display: flex; align-items: center; gap: 15px; color: #90EE90;">
                                <span style="font-weight: bold; font-size: 1em;" data-i18n="pagination-info">分页信息：</span>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 0.9em;" data-i18n="go-to-page">跳转到第</span>
                                    <input type="number" id="delete-page-jump-input" min="1" onkeypress="handleDeletePageJumpKeypress(event)" style="width: 60px; padding: 6px 8px; background: var(--dark-gray); border: 1px solid #90EE90; color: #90EE90; border-radius: 3px; text-align: center; font-size: 0.9em;">
                                    <span style="font-size: 0.9em;" data-i18n="page-unit">页</span>
                                    <button onclick="jumpToDeletePage()" style="background: #90EE90; color: var(--black); border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="jump-btn">跳转</button>
                                </div>
                            </div>
                            <div id="delete-salon-pagination" style="display: flex; align-items: center; gap: 8px; color: #90EE90; font-size: 0.9em;">
                                <button id="delete-first-page" onclick="goToDeletePage(1)" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="first-page">首页</button>
                                <button id="delete-prev-page" onclick="goToPrevDeletePage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="prev-page">上一页</button>
                                <span id="delete-page-info" style="background: var(--gold); color: var(--black); padding: 6px 16px; border-radius: 3px; font-weight: bold; font-size: 0.9em;">第 1 页 / 共 1 页 (0 个项目)</span>
                                <button id="delete-next-page" onclick="goToNextDeletePage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="next-page">下一页</button>
                                <button id="delete-last-page" onclick="goToLastDeletePage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; cursor: pointer; font-size: 0.9em;" data-i18n="last-page">末页</button>
                                <select id="delete-items-per-page" onchange="changeDeleteItemsPerPage()" style="background: var(--dark-gray); color: #90EE90; border: 1px solid #90EE90; padding: 6px 12px; border-radius: 3px; font-size: 0.9em; margin-left: 10px;">
                                    <option value="10" data-i18n="items-per-page-10">每页显示: 10</option>
                                    <option value="20" selected data-i18n="items-per-page-20">每页显示: 20</option>
                                    <option value="50" data-i18n="items-per-page-50">每页显示: 50</option>
                                </select>
                                <span style="font-size: 0.9em;" data-i18n="items-unit">条</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 沙龙列表区域 -->
                    <div style="background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); height: calc(100vh - 500px); min-height: 300px; display: flex; flex-direction: column;">
                        <div style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); flex-shrink: 0; height: 53px; box-sizing: border-box; display: flex; align-items: center;">
                            <h3 style="color: var(--gold); margin: 0;" data-i18n="salon-delete-list">沙龙删除列表</h3>
                        </div>
                        <div id="delete-salon-list-content" style="padding: 15px; flex: 1; overflow-y: auto; box-sizing: border-box;">
                            <!-- 沙龙列表将在这里动态生成 -->
                            <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-salons-to-delete">没有可删除的沙龙</p>
                        </div>
                    </div>

                </div>
                
                <!-- 区域管理页面 -->
                <div id="district-management" class="content-area">
                    <h1 style="margin-bottom: 15px;" data-i18n="district-management">区域管理</h1>
                    
                    <!-- 区域管理功能区 -->
                    <div style="margin: 10px 0; padding: 15px; background: rgba(212, 175, 55, 0.1); border-radius: 5px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                            <h3 style="color: var(--gold); margin: 0;" data-i18n="district-operations">区域操作</h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="showAddDistrictDialog()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="add-district">添加区域</button>
                                <button onclick="resetToDefaultDistricts()" style="background: #ff6b6b; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="reset-to-default">重置为默认</button>
                                <button onclick="exportDistrictConfig()" style="background: #4dabf7; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="export-config">导出配置</button>
                                <button onclick="importDistrictConfig()" style="background: #51cf66; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="import-config">导入配置</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 区域列表 -->
                    <div style="background: rgba(24,24,24,0.5); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); height: calc(100vh - 320px); min-height: 400px; display: flex; flex-direction: column;">
                        <div style="padding: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); flex-shrink: 0; display: flex; align-items: center; justify-content: space-between;">
                            <h3 style="color: var(--gold); margin: 0;" data-i18n="district-list">区域列表</h3>
                            <span id="district-count" style="color: var(--gold); font-size: 0.9em;" data-i18n="total-districts">共 0 个区域</span>
                        </div>
                        <div id="district-list-content" style="padding: 15px; flex: 1; overflow-y: auto; box-sizing: border-box;">
                            <!-- 区域列表将在这里动态生成 -->
                        </div>
                    </div>
                </div>
                
                <!-- 添加/编辑区域对话框 -->
                <div id="district-dialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
                    <div style="background: var(--dark-gray); border: 2px solid var(--gold); border-radius: 10px; padding: 30px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
                        <h2 id="district-dialog-title" style="color: var(--gold); margin: 0 0 20px 0; text-align: center;" data-i18n="add-district">添加区域</h2>
                        
                        <form id="district-form" onsubmit="saveDistrict(event)">
                            <!-- 区域代码 -->
                            <div style="margin-bottom: 15px;">
                                <label for="districtCode" style="display: block; color: var(--gold); margin-bottom: 5px; font-size: 0.9em;" data-i18n="district-code">区域代码：</label>
                                <input type="text" id="districtCode" required maxlength="20" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                <small style="color: #aaa; font-size: 0.8em;" data-i18n="district-code-hint">英文代码，如: gangnam, seoul-center</small>
                            </div>
                            
                            <!-- 中文名称 -->
                            <div style="margin-bottom: 15px;">
                                <label for="districtNameCn" style="display: block; color: var(--gold); margin-bottom: 5px; font-size: 0.9em;" data-i18n="district-name-cn">中文名称：</label>
                                <input type="text" id="districtNameCn" required maxlength="50" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                            
                            <!-- 韩文名称 -->
                            <div style="margin-bottom: 15px;">
                                <label for="districtNameKr" style="display: block; color: var(--gold); margin-bottom: 5px; font-size: 0.9em;" data-i18n="district-name-kr">韩文名称：</label>
                                <input type="text" id="districtNameKr" required maxlength="50" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                            
                            <!-- 地址识别关键词 -->
                            <div style="margin-bottom: 20px;">
                                <label for="districtKeywords" style="display: block; color: var(--gold); margin-bottom: 5px; font-size: 0.9em;" data-i18n="district-keywords">地址识别关键词：</label>
                                <textarea id="districtKeywords" rows="3" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; font-family: inherit; resize: vertical;"></textarea>
                                <small style="color: #aaa; font-size: 0.8em;" data-i18n="district-keywords-hint">用逗号分隔，如: 강남구,江南区,gangnam</small>
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: center;">
                                <button type="button" onclick="closeDistrictDialog()" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;" data-i18n="cancel">取消</button>
                                <button type="submit" style="background: var(--gold); color: var(--black); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;" data-i18n="save">保存</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- 业绩目标页面 -->
                <div id="performance-target" class="content-area">
                    <h1 data-i18n="performance-target">业绩目标</h1>
                    
                    <!-- 当前月份选择 -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <label style="color: var(--gold); font-weight: bold;" data-i18n="select-month">选择月份：</label>
                            <select id="performance-month" onchange="displayPerformanceTargets()" style="padding: 8px 12px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                                <option value="1">1月</option>
                                <option value="2">2月</option>
                                <option value="3">3月</option>
                                <option value="4">4月</option>
                                <option value="5">5月</option>
                                <option value="6">6月</option>
                                <option value="7">7月</option>
                                <option value="8">8月</option>
                                <option value="9">9月</option>
                                <option value="10">10月</option>
                                <option value="11">11月</option>
                                <option value="12">12月</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="recalculatePerformanceTargets()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="recalculate-targets">重新计算目标</button>
                            <button onclick="resetPerformanceTargets()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="reset-targets">重置目标</button>
                        </div>
                    </div>
                    
                    <!-- 团队总目标 -->
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); margin-bottom: 30px;">
                        <h2 style="color: var(--gold); margin: 0 0 20px 0; text-align: center;" data-i18n="team-target">代理店营业额目标</h2>
                        <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; align-items: center;">
                            <div style="text-align: center;">
                                <div style="color: #cccccc; font-size: 0.9em; margin-bottom: 5px;" data-i18n="target-label">目标</div>
                                <div id="team-target-amount" style="font-size: 1.8em; color: var(--gold); font-weight: bold;">0</div>
                                <div style="color: #aaa; font-size: 0.8em;" data-i18n="thousand-won">千韩元</div>
                            </div>
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="color: #cccccc;" data-i18n="actual-label">实际</span>
                                    <span id="team-progress-text" style="color: var(--gold); font-weight: bold;">0%</span>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); height: 20px; border-radius: 10px; overflow: hidden;">
                                    <div id="team-progress-bar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); width: 0%; transition: width 0.3s ease;"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8em; color: #aaa;">
                                    <span>0</span>
                                    <span id="team-target-display">0</span>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #cccccc; font-size: 0.9em; margin-bottom: 5px;" data-i18n="actual-label">实际</div>
                                <div id="team-actual-amount" style="font-size: 1.8em; color: #4CAF50; font-weight: bold;">0</div>
                                <div style="color: #aaa; font-size: 0.8em;" data-i18n="thousand-won">千韩元</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 个人业绩目标列表 -->
                    <div id="performance-list" style="margin-top: 20px; max-height: calc(100vh - 320px); overflow-y: auto; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 5px; padding: 15px; background: rgba(24,24,24,0.3);">
                        <!-- 个人业绩目标将在这里动态生成 -->
                        <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-performance-data">暂无业绩数据</p>
                    </div>
                </div>
                
                <!-- 操作历史记录页面 -->
                <div id="operation-history" class="content-area">
                    <h1 data-i18n="operation-history">操作历史记录</h1>
                    
                    <!-- 筛选控件 -->
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 5px; margin-bottom: 20px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <!-- 第一行：3个下拉筛选 -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="filter-by-user">按用户筛选：</label>
                                <select id="history-user-filter" onchange="filterOperationHistory()" style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                                    <option value="" data-i18n="all-users">全部用户</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="filter-by-operation">按操作类型：</label>
                                <select id="history-operation-filter" onchange="filterOperationHistory()" style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                                    <option value="" data-i18n="all-operations">全部操作</option>
                                    <option value="create" data-i18n="operation-create">创建</option>
                                    <option value="edit" data-i18n="operation-edit">编辑</option>
                                    <option value="delete" data-i18n="operation-delete">删除</option>
                                    <option value="login" data-i18n="operation-login">登录</option>
                                    <option value="logout" data-i18n="operation-logout">登出</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="filter-by-object">按对象类型：</label>
                                <select id="history-object-filter" onchange="filterOperationHistory()" style="width: 100%; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                                    <option value="" data-i18n="all-objects">全部对象</option>
                                    <option value="salon" data-i18n="object-salon">沙龙</option>
                                    <option value="transaction" data-i18n="object-transaction">交易</option>
                                    <option value="employee" data-i18n="object-employee">职员</option>
                                </select>
                            </div>
                        </div>
                        <!-- 第二行：日期筛选和清空按钮 -->
                        <div style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 300px;">
                                <label style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="filter-by-date">按日期筛选：</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="date" id="history-start-date" lang="zh-CN" onchange="filterOperationHistory()" style="flex: 1; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                    <span style="color: var(--gold); align-self: center; white-space: nowrap;" data-i18n="to">至</span>
                                    <input type="date" id="history-end-date" lang="zh-CN" onchange="filterOperationHistory()" style="flex: 1; padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                </div>
                            </div>
                            <div style="flex-shrink: 0;">
                                <button onclick="clearHistoryFilters()" style="min-width: 120px; background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; white-space: nowrap; font-size: 0.9em;" data-i18n="clear-all-filters">清空筛选</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="operation-history-list" style="margin-top: 20px; max-height: calc(100vh - 320px); overflow-y: auto; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 5px; padding: 15px; background: rgba(24,24,24,0.3);">
                        <!-- 操作历史记录将在这里动态生成 -->
                        <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-operation-history">暂无操作历史记录</p>
                    </div>
                </div>
                
                <!-- 数据对比查看页面 -->
                <div id="data-comparison" class="content-area">
                    <h1 data-i18n="data-comparison">数据对比查看</h1>
                    <div id="comparison-content" style="margin-top: 20px; max-height: calc(100vh - 320px); overflow-y: auto; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 5px; padding: 15px; background: rgba(24,24,24,0.3);">
                        <p style="color: #cccccc; text-align: center; padding: 40px;" data-i18n="select-history-record">请从操作历史记录中选择要对比的记录</p>
                    </div>
                </div>
                
                <!-- 审计报告页面 -->
                <div id="audit-report" class="content-area">
                    <h1 data-i18n="audit-report">审计报告</h1>
                    
                    <!-- 报告统计 -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); text-align: center;">
                            <h3 style="color: var(--gold); margin: 0 0 10px 0;" data-i18n="total-operations">总操作数</h3>
                            <div id="total-operations-count" style="font-size: 2em; color: var(--text-light); font-weight: bold;">0</div>
                        </div>
                        <div style="background: rgba(144, 238, 144, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(144, 238, 144, 0.3); text-align: center;">
                            <h3 style="color: #90EE90; margin: 0 0 10px 0;" data-i18n="today-operations">今日操作</h3>
                            <div id="today-operations-count" style="font-size: 2em; color: var(--text-light); font-weight: bold;">0</div>
                        </div>
                        <div style="background: rgba(135, 206, 235, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(135, 206, 235, 0.3); text-align: center;">
                            <h3 style="color: #87CEEB; margin: 0 0 10px 0;" data-i18n="active-users">活跃用户</h3>
                            <div id="active-users-count" style="font-size: 2em; color: var(--text-light); font-weight: bold;">0</div>
                        </div>
                        <div style="background: rgba(255, 182, 193, 0.1); padding: 20px; border-radius: 8px; border: 1px solid rgba(255, 182, 193, 0.3); text-align: center;">
                            <h3 style="color: #FFB6C1; margin: 0 0 10px 0;" data-i18n="critical-operations">重要操作</h3>
                            <div id="critical-operations-count" style="font-size: 2em; color: var(--text-light); font-weight: bold;">0</div>
                        </div>
                    </div>
                    
                    <div id="audit-report-content" style="margin-top: 20px; max-height: calc(100vh - 320px); overflow-y: auto; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 5px; padding: 15px; background: rgba(24,24,24,0.3);">
                        <!-- 审计报告内容将在这里动态生成 -->
                        <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-audit-data">暂无审计数据</p>
                    </div>
                </div>
                
                <!-- 审批管理页面 -->
                <div id="approval-management" class="content-area">
                    <h1 data-i18n="approval-management">审批管理</h1>
                    
                    <div class="approval-controls" style="margin-bottom: 20px; padding: 20px; background: rgba(212, 175, 55, 0.1); border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3);">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div>
                                <label for="approvalStatusFilter" style="color: var(--gold); margin-right: 10px;" data-i18n="status">状态：</label>
                                <select id="approvalStatusFilter" onchange="displayApprovalList()" style="padding: 8px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                                    <option value="" data-i18n="all-status">全部状态</option>
                                    <option value="pending" data-i18n="pending">待审批</option>
                                    <option value="approved" data-i18n="approved">已批准</option>
                                    <option value="rejected" data-i18n="rejected">已拒绝</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="approval-list" id="approvalList" style="max-height: calc(100vh - 320px); overflow-y: auto; border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 5px; padding: 15px; background: rgba(24,24,24,0.3);">
                        <!-- 审批列表将在这里动态生成 -->
                        <p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-pending-approvals">暂无待审批项目</p>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                © 2025 Mesia Professional. All rights reserved.
            </div>
        </div>
    </div>

    <!-- 保留所有模态框 -->
    
    <!-- 创建产品分类模态框 -->
    <div id="createCategoryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--dark-gray); padding: 30px; border-radius: 10px; border: 1px solid var(--gold); width: 500px; max-width: 95vw; max-height: 95vh; overflow-y: auto;">
            <h2 style="color: var(--gold); margin-top: 0;" data-i18n="create-product-category">创建产品分类</h2>
            <form id="createCategoryForm">
                <div style="margin-bottom: 20px;">
                    <label for="categoryNameCN" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="category-name-cn">分类名称（中文）：</label>
                    <input type="text" id="categoryNameCN" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label for="categoryNameKO" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="category-name-ko">分类名称（韩文）：</label>
                    <input type="text" id="categoryNameKO" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label for="categoryDescription" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="category-description">分类描述：</label>
                    <textarea id="categoryDescription" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; min-height: 80px; resize: vertical;"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeCreateCategoryModal()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="cancel">取消</button>
                    <button type="button" onclick="submitCreateCategory()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="create">创建</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 编辑产品分类模态框 -->
    <div id="editCategoryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: var(--dark-gray); padding: 30px; border-radius: 10px; border: 1px solid var(--gold); width: 500px; max-width: 95vw; max-height: 95vh; overflow-y: auto;">
            <h2 style="color: var(--gold); margin-top: 0;" data-i18n="edit-product-category">编辑产品分类</h2>
            <form id="editCategoryForm">
                <input type="hidden" id="editCategoryId">
                <div style="margin-bottom: 20px;">
                    <label for="editCategoryNameCN" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="category-name-cn">分类名称（中文）：</label>
                    <input type="text" id="editCategoryNameCN" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label for="editCategoryNameKO" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="category-name-ko">分类名称（韩文）：</label>
                    <input type="text" id="editCategoryNameKO" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label for="editCategoryDescription" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="category-description">分类描述：</label>
                    <textarea id="editCategoryDescription" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box; min-height: 80px; resize: vertical;"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeEditCategoryModal()" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="cancel">取消</button>
                    <button type="submit" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="save">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // 沙龙排序相关变量
        let currentSortField = 'default';
        let currentSortOrder = 'asc';
        let currentSalonsData = [];
        let currentFilter = null;
        let currentPage = 1;
        let itemsPerPage = 20;
        
        // 切换沙龙排序
        function toggleSalonSort(field) {
            if (currentSortField === field) {
                // 如果是同一个字段，切换排序方向
                currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                // 如果是不同字段，设置为升序
                currentSortField = field;
                currentSortOrder = 'asc';
            }
            
            // 更新按钮样式
            updateSortButtons();
            
            // 根据当前状态重新显示列表
            if (currentFilter === 'filtered') {
                // 如果当前是筛选状态，重新执行搜索以应用排序
                searchSalons();
            } else {
                // 否则显示正常列表
                displaySalonList(currentFilter, 1);
            }
        }
        
        // 更新排序按钮样式
        function updateSortButtons() {
            const buttons = document.querySelectorAll('[id^="sort-"]');
            buttons.forEach(button => {
                const field = button.id.replace('sort-', '');
                const i18nKey = button.getAttribute('data-i18n');
                let buttonText = getText(i18nKey);
                
                // 使用统一的按钮样式，不添加箭头
                if (field === currentSortField) {
                    button.style.background = 'var(--gold)';
                    button.style.opacity = '1';
                    } else {
                    button.style.background = 'var(--gold)';
                    button.style.opacity = '0.7';
                }
                
                // 直接设置文本内容，不添加任何箭头
                button.textContent = buttonText;
            });
        }
        
        // 更新排序按钮悬停样式
        function updateSortButtonStyle(button) {
            const field = button.id.replace('sort-', '');
            if (field !== currentSortField) {
                button.style.background = 'rgba(135, 206, 235, 0.2)';
            }
        }
        
        // 分页相关函数
        function updatePaginationInfo(currentPage, totalPages, totalItems) {
            const pageInfo = document.getElementById('page-info');
            const firstPageBtn = document.getElementById('first-page');
            const prevPageBtn = document.getElementById('prev-page');
            const nextPageBtn = document.getElementById('next-page');
            const lastPageBtn = document.getElementById('last-page');
            const jumpInput = document.getElementById('page-jump-input');
            
            if (pageInfo) {
                const currentLanguage = localStorage.getItem('language') || 'zh';
                if (currentLanguage === 'ko') {
                    pageInfo.textContent = `${currentPage} 페이지 / 총 ${totalPages} 페이지 (${totalItems} 개 항목)`;
                } else {
                    pageInfo.textContent = `第 ${currentPage} 页 / 共 ${totalPages} 页 (${totalItems} 个项目)`;
                }
            }
            
            // 更新跳转输入框的最大值
            if (jumpInput) {
                jumpInput.max = totalPages;
                jumpInput.placeholder = totalPages > 0 ? `1-${totalPages}` : '1';
            }
            
            // 更新按钮状态
            if (firstPageBtn) firstPageBtn.disabled = currentPage === 1;
            if (prevPageBtn) prevPageBtn.disabled = currentPage === 1;
            if (nextPageBtn) nextPageBtn.disabled = currentPage === totalPages;
            if (lastPageBtn) lastPageBtn.disabled = currentPage === totalPages;
            
            // 更新按钮样式
            const disabledStyle = 'opacity: 0.5; cursor: not-allowed;';
            const normalStyle = 'opacity: 1; cursor: pointer;';
            
            if (firstPageBtn) firstPageBtn.style.cssText += currentPage === 1 ? disabledStyle : normalStyle;
            if (prevPageBtn) prevPageBtn.style.cssText += currentPage === 1 ? disabledStyle : normalStyle;
            if (nextPageBtn) nextPageBtn.style.cssText += currentPage === totalPages ? disabledStyle : normalStyle;
            if (lastPageBtn) lastPageBtn.style.cssText += currentPage === totalPages ? disabledStyle : normalStyle;
        }
        
        function goToSalonPage(page) {
            displaySalonList(currentFilter, page);
        }
        
        function goToPrevSalonPage() {
            if (currentPage > 1) {
                displaySalonList(currentFilter, currentPage - 1);
            }
        }
        
        function goToNextSalonPage() {
            const totalPages = Math.ceil(currentSalonsData.length / itemsPerPage);
            if (currentPage < totalPages) {
                displaySalonList(currentFilter, currentPage + 1);
            }
        }
        
        function goToLastSalonPage() {
            const totalPages = Math.ceil(currentSalonsData.length / itemsPerPage);
            displaySalonList(currentFilter, totalPages);
        }
        
        function changeItemsPerPage() {
            const select = document.getElementById('items-per-page');
            itemsPerPage = parseInt(select.value);
            displaySalonList(currentFilter, 1); // 重置到第一页
        }
        
        function jumpToPage() {
            const input = document.getElementById('page-jump-input');
            const pageNumber = parseInt(input.value);
            
            if (!pageNumber || pageNumber < 1) {
                alert('请输入有效的页码');
                return;
            }
            
            const totalPages = Math.ceil(currentSalonsData.length / itemsPerPage);
            
            if (pageNumber > totalPages) {
                alert(`页码不能超过总页数 ${totalPages}`);
                return;
            }
            
            displaySalonList(currentFilter, pageNumber);
            input.value = ''; // 清空输入框
        }
        
        function handlePageJumpKeypress(event) {
            if (event.key === 'Enter') {
                jumpToPage();
            }
        }
        
        // 添加侧边栏菜单处理逻辑
        function toggleSidebarSubmenu(menuType) {
            // 先找到对应的子菜单元素
            const targetSubmenu = document.getElementById(`sidebar-${menuType}-submenu`);
            const menuItem = targetSubmenu.parentNode;
            
            if (targetSubmenu) {
                // 如果子菜单已经展开，则收起它
                if (targetSubmenu.classList.contains('active')) {
                    targetSubmenu.classList.remove('active');
                    menuItem.classList.remove('active');
                } else {
                    // 先关闭所有其他展开的子菜单
                    document.querySelectorAll('.sidebar-submenu').forEach(submenu => {
                        submenu.classList.remove('active');
                        submenu.parentNode.classList.remove('active');
                    });
                    
                    // 展开当前子菜单
                    targetSubmenu.classList.add('active');
                    menuItem.classList.add('active');
                }
            }
        }
        
        // 移动端菜单切换
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
            
            // 同时切换汉堡菜单图标
            const hamburgerLines = document.querySelectorAll('.hamburger-line');
            hamburgerLines[0].style.transform = sidebar.classList.contains('active') ? 'rotate(45deg) translate(5px, 5px)' : '';
            hamburgerLines[1].style.opacity = sidebar.classList.contains('active') ? '0' : '1';
            hamburgerLines[2].style.transform = sidebar.classList.contains('active') ? 'rotate(-45deg) translate(5px, -5px)' : '';
        }
        
        // 修改内容显示函数，不再需要隐藏主菜单，直接显示内容
        function showContent(contentId, event) {
            if (event) {
                event.stopPropagation(); // 阻止事件冒泡
            }
            
            // 权限检查：删除功能只有管理员可以访问
            if (contentId === 'delete-salon' || contentId === 'delete-employee') {
                if (!hasPermission('admin')) {
                    alert(contentId === 'delete-salon' ? getText('no-permission-delete-salon') : getText('no-permission-delete-employee'));
                    return;
                }
            }
            
            // 取消所有子菜单项的高亮
            document.querySelectorAll('.sidebar-submenu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 高亮被点击的子菜单项
            if (event) {
                event.currentTarget.classList.add('active');
            }
            
            // 隐藏所有内容区域
            const allContent = document.querySelectorAll('.content-area');
            allContent.forEach(content => {
                content.classList.remove('active');
            });
            
            // 显示选择的内容区域
            const targetContent = document.getElementById(contentId);
            if (targetContent) {
                targetContent.classList.add('active');
                
                // 在移动设备上，显示内容后自动关闭侧边栏
                if (window.innerWidth <= 900) {
                    document.querySelector('.sidebar').classList.remove('active');
                }
                
                // 如果是沙龙信息页面，刷新列表和筛选选项
                if (contentId === 'salon-info') {
                    // 重置排序状态为默认
                    currentSortField = 'default';
                    currentSortOrder = '';
                    updateResponsibleFilterOptions();
                    displaySalonList(null, 1); // 初始化时显示第一页
                    
                    // 确保沙龙数量正确显示
                    setTimeout(() => {
                        const salons = getSalons();
                        const salonCountText = document.getElementById('salon-count-text');
                        if (salonCountText) {
                            salonCountText.textContent = getText('total-salons-count').replace('{count}', salons.length);
                        }
                    }, 100);
                }
                
                // 如果是新增沙龙页面，更新负责职员选项
                if (contentId === 'new-salon') {
                    updateResponsibleEmployeeOptions();
                    checkBatchUploadPermission();
                }
                
                // 如果是删除沙龙页面，初始化页面
                if (contentId === 'delete-salon') {
                    initDeleteSalonPage();
                }
                
                // 如果是区域管理页面，初始化页面
                if (contentId === 'district-management') {
                    initDistrictManagementPage();
                }
                
                // 如果是职员列表页面，刷新列表
                if (contentId === 'employee-list') {
                    displayEmployeeList();
                }
                
                // 如果是新增职员页面，根据权限设置职位选项
                if (contentId === 'new-employee') {
                    const positionSelect = document.getElementById('employeePosition');
                    if (currentUser && currentUser.position === 'manager') {
                        // 经理只能创建业务员
                        positionSelect.innerHTML = `<option value="salesperson" data-i18n="salesperson">业务员</option>`;
                    } else {
                        // 管理员可以创建所有级别
                        positionSelect.innerHTML = `
                            <option value="salesperson" data-i18n="salesperson">业务员</option>
                            <option value="manager" data-i18n="manager">经理</option>
                            <option value="admin" data-i18n="admin">管理员</option>
                        `;
                    }
                    updateTexts(); // 更新翻译
                }
                
                // 如果是删除职员页面，更新选项
                if (contentId === 'delete-employee') {
                    updateDeleteEmployeeOptions();
                }
                
                // 如果是操作历史页面，加载历史记录
                if (contentId === 'operation-history') {
                    displayOperationHistory();
                }
                
                // 如果是审计报告页面，生成报告
                if (contentId === 'audit-report') {
                    displayAuditReport();
                }
                
                // 如果是审批管理页面，显示审批列表
                if (contentId === 'approval-management') {
                    displayApprovalList();
                }
                
                // 如果是产品分类页面，显示产品分类列表
                if (contentId === 'product-category') {
                    displayProductCategories();
                }
                
                // 如果是添加产品页面，加载产品分类选项
                if (contentId === 'add-product') {
                    loadProductCategories();
                }
                
                // 如果是产品列表页面，显示产品列表
                if (contentId === 'product-list') {
                    displayProductList();
                }
                
                // 如果是业绩目标页面，显示业绩目标
                if (contentId === 'performance-target') {
                    displayPerformanceTargets();
                }
                
                // 如果是总览页面，更新统计数据
                if (contentId === 'dashboard') {
                    updateDashboardStats();
                }
            }
        }
        
        // 页面加载完成后初始化系统
        window.addEventListener('DOMContentLoaded', function() {
            // 初始化系统
            initializeSystem();
            
            // 添加产品表单提交事件监听器
            const addProductForm = document.getElementById('addProductForm');
            if (addProductForm) {
                addProductForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        id: Date.now(),
                        name: document.getElementById('productName').value,
                        brandName: document.getElementById('brandName').value,
                        model: document.getElementById('productModel').value,
                        sku: document.getElementById('productSku').value,
                        category: document.getElementById('productCategory').value || 'uncategorized',
                        unitType: document.getElementById('unitType').value,
                        weightVolume: parseFloat(document.getElementById('weightVolume').value) || 0,
                        weightUnit: document.getElementById('weightUnit').value,
                        perBoxCount: parseInt(document.getElementById('perBoxCount').value) || 1,
                        perCaseCount: parseInt(document.getElementById('perCaseCount').value) || 1,
                        purchasePrice: document.getElementById('purchasePrice').value.replace(/[^\d]/g, ''),
                        wholesalePrice: document.getElementById('wholesalePrice').value.replace(/[^\d]/g, ''),
                        retailPrice: document.getElementById('retailPrice').value.replace(/[^\d]/g, ''),
                        isOnSale: document.getElementById('isOnSale').checked,
                        isDiscontinued: document.getElementById('isDiscontinued').checked,
                        notes: document.getElementById('productNotes').value,
                        createdAt: new Date().toISOString(),
                        createdBy: currentUser ? currentUser.id : null
                    };
                    
                    // 验证必填字段
                    if (!formData.name) {
                        alert('请输入产品名称');
                        return;
                    }
                    
                    // 添加产品
                    productsData.push(formData);
                    saveProducts();
                    
                    alert('产品添加成功！');
                    resetProductForm();
                    
                    // 记录操作日志
                    if (typeof addOperationLog === 'function') {
                        addOperationLog('create', 'product', formData.id, `创建产品: ${formData.name}`);
                    }
                });
            }
            
            // 添加产品分类表单提交事件监听器
            const createCategoryForm = document.getElementById('createCategoryForm');
            if (createCategoryForm) {
                createCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        id: Date.now(),
                        nameCN: document.getElementById('categoryNameCN').value,
                        nameKO: document.getElementById('categoryNameKO').value,
                        code: document.getElementById('categoryCode').value || generateCategoryCode(),
                        description: document.getElementById('categoryDescription').value,
                        parentId: document.getElementById('parentCategory').value || null,
                        sortOrder: parseInt(document.getElementById('categorySortOrder').value) || 0,
                        active: document.getElementById('categoryActive').checked,
                        createdAt: new Date().toISOString(),
                        createdBy: currentUser ? currentUser.id : null
                    };
                    
                    // 验证必填字段
                    if (!formData.nameCN) {
                        alert('请输入分类名称（中文）');
                        return;
                    }
                    
                    // 检查代码是否重复
                    if (productCategoriesData.some(cat => cat.code === formData.code && cat.id !== formData.id)) {
                        alert('分类代码已存在，请使用其他代码');
                        return;
                    }
                    
                    // 添加分类
                    productCategoriesData.push(formData);
                    saveProductCategories();
                    
                    alert('产品分类创建成功！');
                    resetCategoryForm();
                    displayProductCategories();
                    
                    // 记录操作日志
                    if (typeof addOperationLog === 'function') {
                        addOperationLog('create', 'category', formData.id, `创建产品分类: ${formData.nameCN}`);
                    }
                });
            }
            
            // 生成分类代码函数
            function generateCategoryCode() {
                const timestamp = Date.now();
                return `CAT_${timestamp}`;
            }
            
            // 重置分类表单函数
            function resetCategoryForm() {
                const form = document.getElementById('createCategoryForm');
                if (form) {
                    form.reset();
                    document.getElementById('categorySortOrder').value = '0';
                    document.getElementById('categoryActive').checked = true;
                }
            }
            
            // 检查是否是从登录页面跳转过来的
            const fromLogin = sessionStorage.getItem('fromLogin');
            if (fromLogin === 'true') {
                // 清除标记，防止刷新页面时再次触发
                sessionStorage.removeItem('fromLogin');
                
                // 自动点击概况总览菜单
                showContent('dashboard');
                
                // 延迟更新统计数据，确保页面元素已加载
                setTimeout(updateDashboardStats, 100);
                
                // 标记概况总览菜单为激活状态
                document.querySelectorAll('.sidebar-menu-item').forEach(item => {
                    if (item.querySelector('[data-i18n="dashboard"]')) {
                        const header = item.querySelector('.sidebar-menu-header');
                        if (header) {
                            header.classList.add('active');
                        }
                    }
                });
            }
            
            // 初始化粒子效果
            if (typeof tsParticles !== 'undefined') {
                tsParticles.load("tsparticles", {
                    particles: {
                        number: {
                            value: 30,
                            density: {
                                enable: true,
                                value_area: 800
                            }
                        },
                        color: {
                            value: "#D4AF37"
                        },
                        shape: {
                            type: "circle",
                        },
                        opacity: {
                            value: 0.3,
                            random: true,
                            anim: {
                                enable: true,
                                speed: 1,
                                opacity_min: 0.1,
                                sync: false
                            }
                        },
                        size: {
                            value: 3,
                            random: true,
                            anim: {
                                enable: true,
                                speed: 2,
                                size_min: 0.1,
                                sync: false
                            }
                        },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: "#D4AF37",
                            opacity: 0.2,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 1,
                            direction: "none",
                            random: true,
                            straight: false,
                            out_mode: "out",
                            bounce: false,
                        }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: {
                            onhover: {
                                enable: true,
                                mode: "grab"
                            },
                            onclick: {
                                enable: true,
                                mode: "push"
                            },
                            resize: true
                        },
                        modes: {
                            grab: {
                                distance: 140,
                                line_linked: {
                                    opacity: 0.5
                                }
                            },
                            push: {
                                particles_nb: 3
                            }
                        }
                    },
                    retina_detect: true
                });
            }
        });
        
        // 兼容旧的showSubmenu函数，重定向到新的toggleSidebarSubmenu函数
        function showSubmenu(menuType) {
            toggleSidebarSubmenu(menuType);
        }
        
        // 兼容旧的backToMenu函数，现在不需要任何操作
        function backToMenu() {
            // 不执行任何操作
        }
        
        // 更新总览页面统计数据
        function updateDashboardStats() {
            const salons = getSalons();
            const totalSalons = salons.length;
            
            // 更新沙龙交易数的目标值（设置为当前沙龙总数）
            const transactionSalonRows = document.querySelectorAll('tr');
            transactionSalonRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) {
                    const firstCell = cells[0];
                    if (firstCell && firstCell.getAttribute('data-i18n') === 'transaction-salon-count') {
                        // 更新目标值（第二列）
                        cells[1].textContent = totalSalons;
                        // 可以在这里添加更多逻辑来计算实际值和进度率
                    }
                }
            });
        }

        // 智能语言系统初始化（整合用户建议的方案）
        function initializeLanguageSystem() {
            // 优先级：用户设置 > 系统语言 > 默认语言
            const userLanguage = localStorage.getItem('language');
            
            if (userLanguage) {
                // 用户已手动选择过语言，优先使用用户设置
                console.log('使用用户设置的语言:', userLanguage);
                switchLanguage(userLanguage);
            } else {
                // 用户未设置，自动检测系统语言
                const systemLanguage = navigator.language || navigator.userLanguage;
                console.log('检测到系统语言:', systemLanguage);
                
                // 判断系统语言并设置对应语言
                const languageToUse = systemLanguage.startsWith('ko') ? 'ko' : 'zh';
                console.log('自动选择语言:', languageToUse);
                
                switchLanguage(languageToUse);
            }
        }
        
        // 用户主动切换语言（保持现有功能，增加日志）
        function switchLanguage(lang) {
            console.log('切换语言到:', lang);
            
            // 设置HTML文档语言属性（SEO友好）
            document.documentElement.lang = lang === 'ko' ? 'ko-KR' : 'zh-CN';
            
            // 更新按钮状态
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btn-' + lang).classList.add('active');
            
            // 保存语言设置到Firebase
            setLanguageToFirebase(lang);
            
            // 更新界面文本
            updateTexts();
            
            // 特别处理沙龙数量显示
            const salonCountText = document.getElementById('salon-count-text');
            if (salonCountText) {
                const salons = getSalons();
                const key = salonCountText.getAttribute('data-i18n');
                if (key === 'total-salons-count' || key === 'district-salons-count') {
                    salonCountText.textContent = getText(key).replace('{count}', salons.length);
                }
            }
        }
        
        // 用户主动设置语言偏好（类似您提供的方案）
        async function setUserLanguage(lang) {
            console.log('用户主动设置语言偏好:', lang);
            
            // 保存用户偏好到Firebase
            const success = await setLanguageToFirebase(lang);
            
            // 立即切换语言
            switchLanguage(lang);
            
            // 可选：显示设置成功提示
            // alert(getText('language-changed-success'));
        }
        
        // 获取翻译文本
        function getText(key) {
            const currentLanguage = getCurrentLanguage();
            const translations = {
                zh: {
                    'employee-management': '职员管理',
                    'new-employee': '新增职员',
                    'employee-list': '职员列表',
                    'delete-employee': '删除职员',
                    'customer-management': '沙龙管理',
                    'new-salon': '新增沙龙',
                    'single-add-salon': '单个新增沙龙',
                    'batch-add-salon': '批量新增沙龙',
                    'salon-info': '沙龙信息',
                                    'delete-salon': '删除沙龙',
                'district-management': '区域管理',
                'product-management': '产品管理',
                    'add-product': '新增产品',
                    'product-list': '产品列表',
                    'product-category': '产品分类',
                    'inventory-management': '库存管理',
                    'stock-check': '库存盘点',
                    'restock-alert': '补货提醒',
                    'usage-record': '使用记录',
                    'finance-management': '财务管理',
                    'income-record': '收入记录',
                    'expense-record': '支出记录',
                    'financial-report': '财务报表',
                    'performance-target': '业绩目标',
                    'audit-management': '操作管理',
                    'operation-history': '操作历史记录',
                    'data-comparison': '数据对比查看',
                    'audit-report': '审计报告',
                    'approval-management': '审批管理',
                    'system-title': 'Mesia首尔西部地区管理系统',
                    'logout': '退出登录',
                    'employee-name': '姓名',
                    'employee-position': '职位',
                    'employee-mobile': '手机号',
                    'actions': '操作',
                    'edit-btn': '编辑',
                    'delete': '删除',
                    'admin': '管理员',
                    'manager': '经理',
                    'salesperson': '业务员',
                    'system-admin': '系统管理员',
                    'no-employees': '暂无职员数据',
                    'employee-list-desc': '这里显示所有职员的详细信息列表。',
                    'dashboard': '概况总览',
                    'main-performance': '主要业绩',
                    'pending-business': '主要未处理业务',
                    'category': '分类',
                    'target': '目标',
                    'actual': '实绩',
                    'progress-rate': '进度率(%)',
                    'my-performance': '我的业绩',
                    'agency-total-performance': '代理店总业绩',
                    'transaction-salon-count': '交易沙龙数',
                    'count': '件数',
                    'outbound-pending': '出库未批准',
                    'payment-pending': '收款未批准',
                    'delivery-pending': '配送未完成',
                    'unit-label': '[单位:千元]',
                    'basic-info': '基本信息',
                    'login-account': '登录账号',
                    'password': '密码',
                    'work-email': '工作邮箱',
                    'join-date': '入职日期',
                    'contact-info': '联系信息',
                    'mobile-number': '手机号',
                    'bank-account-info': '银行账户信息',
                    'bank-name': '银行名称',
                    'bank-account': '银行账号',
                    'account-holder': '账户持有人',
                    'bank-branch': '备注',
                    'username-required': '请输入登录账号',
                    'password-required': '请输入密码',
                    'employee-name-required': '请输入职员姓名',
                    'employee-added-success': '职员添加成功',
                    'username-already-exists': '该登录账号已存在',
                    'employee-detail': '职员详情',
                    'edit-employee': '编辑职员',
                    'employee-updated-success': '职员信息更新成功',
                    'cancel': '取消',
                    'save': '保存',
                    'add': '添加',
                    'create': '创建',
                    'confirm-delete': '确认删除',
                    'all-districts': '全部区域',
                                'district-guro': '九老区',
            'district-yeongdeungpo': '永登浦区',
            'district-geumcheon': '衿川区',
            'district-gangso': '江西区',
                    'district-overseas': '海外区域',
                    'sort-by': '排序方式',
            'first-page': '首页',
            'prev-page': '上一页',
            'next-page': '下一页',
            'last-page': '末页',
            'items-per-page-10': '每页显示: 10',
            'items-per-page-20': '每页显示: 20',
            'items-per-page-50': '每页显示: 50',
            'items-unit': '条',
            'pagination-info': '分页信息',
            'go-to-page': '跳转到第',
            'page-unit': '页',
            'jump-btn': '跳转',
            'notes': '备注',
            'notes-placeholder': '在这里添加备注信息...',
            'no-notes': '暂无备注信息',
                    'sort-name': '沙龙名称',
                    'sort-address': '地址名称',
                    'sort-add-time': '新增时间',
                    'sort-last-transaction': '最后交易',
                    'sort-overdue-days': '欠款天数',
                    'sort-overdue-amount': '欠款金额',
                    'sort-default': '默认排序',
                    'batch-upload-salon': '批量上传沙龙',
                    'batch-upload-desc': '上传包含沙龙信息的Excel文件，格式要求：第1行为标题行，第2行开始为沙龙数据（沙龙名称、沙龙地址、院长姓名、手机号码、店铺电话、电子邮箱），系统将自动解析并导入到沙龙数据库。',
                    'select-file': '选择文件',
                    'click-to-upload-file': '点击上传文件',
                    'file-format-hint': '支持Excel格式(.xlsx, .xls)',
                    'process-file': '处理文件',
                    'download-template': '下载模板',
                    'salon-basic-info': '沙龙基本信息',
                    'director-info': '院长信息',
                    'director-name': '院长姓名',
                    'director-mobile': '手机号码',
                    'salon-email': '电子邮箱',
                    'responsible-employee-info': '负责职员',
                    'salon-address-required': '沙龙地址不能为空',
                    'please-select-file': '请选择文件',
                    'remove-file': '移除文件',
                    'data-preview': '数据预览',
                    'select-all': '全选',
                    'selected-count': '已选择 0 个沙龙',
                    'assign-responsible': '指定负责人',
                    'assign-responsible-btn': '分配负责人',
                    'confirm-batch-create': '确认批量创建',
                    'salon-region': '沙龙区域',
                    'director-name-col': '院长姓名',
                    'responsible-person': '负责人',
                    'unassigned': '未指定',
                    'select': '选择',
                    'business-license': '营业执照号码',
                    'salon-name': '沙龙名称',
                    'salon-address': '沙龙地址',
                    'salon-name-required': '请输入沙龙名称',
                    'salon-added-success': '沙龙添加成功',
                    'no-salon-info': '暂无沙龙信息',
                    'add-salon-tip': '点击"新增沙龙"来添加第一个沙龙',
                    'salon-address-label': '地址',
                    'business-license-label': '营业执照',
                    'responsible-employee': '负责职员',
                    'director-name': '院长姓名',
                    'director-mobile': '院长手机',
                    'salon-phone': '店铺电话',
                    'salon-email': '电子邮箱',
                    'add-time': '添加时间',
                    'please-select-employee': '请选择职员',
                    'please-select-to-assign': '请先选择要分配的沙龙',
                    'assign-success': '已为 {count} 个沙龙分配负责人：{name}',
                    'please-select-to-create': '请先选择要创建的沙龙',
                    'batch-create-complete': '批量创建完成！成功：{success} 个，失败：{fail} 个',
                    'view-transactions-not-implemented': '查看交易记录功能尚未实现',
                    'edit-salon-not-implemented': '编辑沙龙功能尚未实现',
                    'salon-list': '沙龙列表',
                    'salon-detail': '沙龙详情',
                    'basic-info': '基本信息',
                    'contact-info': '联系信息',
                    'director-info': '院长信息',
                    'other-info': '其他信息',
                    'not-specified': '未指定',
                    'unspecified': '未指定',
                    'salon-not-found': '沙龙未找到',
                    'salon-updated-success': '沙龙信息更新成功',
                    'total-salons-count': '总计 {count} 家沙龙',
                    'district-salons-count': '共 {count} 家沙龙',
                    'no-salon-info': '暂无沙龙信息',
                    'add-salon-tip': '点击"新增沙龙"来添加第一个沙龙',
                    'no-salesperson-salons': '您暂未分配到任何沙龙',
                    'salesperson-salon-tip': '请联系管理员为您分配沙龙',
                    'salon-name-required': '请输入沙龙名称',
                    'no-matching-salons': '没有找到匹配的沙龙',
                    'please-select-salon': '请选择沙龙',
                    'add-product-tip': '点击',
                    'add-first-product': '来添加第一个产品',
                    'no-products': '暂无产品数据',
                    'add-category-tip': '点击',
                    'add-first-category': '按钮来添加第一个分类',
                    'no-categories': '暂无产品分类',
                    'view': '查看',
                            'salon-deleted-success': '沙龙删除成功',
        'salon-delete-failed': '沙龙删除失败',
        'single-delete': '单个删除',
        'batch-delete': '批量删除',
        'district-delete': '分区域删除',
        'select-all': '全选',
        'deselect-all': '取消全选',
        'selected-count': '已选择：0 个沙龙',
        'delete-selected': '删除选中项',
        'delete-all': '删除全部',
        'please-select-district': '请选择区域...',
        'district-salon-count-info': '该区域沙龙数量：0',
        'delete-district-salons': '删除该区域所有沙龙',
        'responsible-delete': '根据负责人删除',
        'please-select-responsible': '请选择负责人...',
        'responsible-salon-count-info': '该负责人管理的沙龙数量：0',
        'delete-responsible-salons': '删除该负责人的所有沙龙',
        'district-yangcheon': '阳川区',
        'district-others': '其他地区',
        'district-operations': '区域操作',
        'add-district': '添加区域',
        'edit-district': '编辑区域',
        'delete-district': '删除区域',
        'reset-to-default': '重置为默认',
        'export-config': '导出配置',
        'import-config': '导入配置',
        'district-list': '区域列表',
        'total-districts': '共 {count} 个区域',
        'district-code': '区域代码',
        'district-name-cn': '中文名称',
        'district-name-kr': '韩文名称',
        'district-keywords': '地址识别关键词',
        'district-code-hint': '英文代码，如: gangnam, seoul-center',
        'district-keywords-hint': '用逗号分隔，如: 강남구,江南区,gangnam',
        'district-salon-count': '沙龙数量',
        'confirm-delete-district': '确认删除区域',
        'delete-district-warning': '删除区域后，该区域下的所有沙龙将被归类为"其他地区"。',
        'district-added-success': '区域添加成功',
        'district-updated-success': '区域更新成功',
        'district-deleted-success': '区域删除成功',
        'district-code-exists': '区域代码已存在',
        'invalid-district-config': '无效的区域配置文件',
        'config-imported-success': '配置导入成功',
        'no-districts': '暂无区域数据',
                    'clear-filters': '清空筛选',
                    'select': '选择',
                    // 产品管理相关翻译
                    'product-basic-info': '产品基本信息',
                    'product-name': '产品名称',
                    'brand-name': '品牌名称',
                    'product-model': '型号',
                    'product-sku': '货号',
                    'product-category-select': '产品分类',
                    'please-select-category': '请选择产品分类...',
                    'uncategorized': '未分类',
                    'product-specifications': '规格信息',
                    'unit-type': '数量单位',
                    'unit-piece': '个',
                    'unit-only': '只',
                    'unit-stick': '支',
                    'unit-bottle': '瓶',
                    'unit-box': '盒',
                    'unit-bag': '袋',
                    'weight-volume': '重量/体积',
                    'weight-unit': '重量单位',
                    'unit-gram': 'g（克）',
                    'unit-ml': 'ml（毫升）',
                    'unit-kg': 'kg（千克）',
                    'unit-liter': 'L（升）',
                    'per-box-count': '每盒数量',
                    'per-case-count': '箱规',
                    'specification-summary': '规格汇总',
                    'price-info': '价格信息',
                    'purchase-price': '进货价（₩）',
                    'wholesale-price': '批发价（₩）',
                    'retail-price': '零售价（₩）',
                    'is-on-sale': '在售',
                    'is-discontinued': '停产',
                    'notes-info': '备注信息',
                    'product-notes': '备注',
                    'product-name-required': '请输入产品名称',
                    'reset-form': '重置表单',
                    'create-product-category': '创建产品分类',
                    'product-category-content': '管理产品分类信息',
                    'category-name-cn': '分类名称（中文）',
                    'category-name-ko': '분류명（한국어）',
                    'category-code': '分类代码',
                    'category-description': '分类描述',
                    'edit-product-category': '编辑产品分类',
                    'product-list-content': '查看和管理所有产品信息',
                    'search-placeholder': '搜索产品名称、品牌或货号...',
                    'product-detail': '产品详情',
                    'product-brand': '品牌',
                    'product-model-label': '型号',
                    'product-sku-label': '货号',
                    'purchase-price-label': '进货价',
                    'wholesale-price-label': '批发价',
                    'retail-price-label': '零售价',
                    'status': '状态',
                    'on-sale': '在售',
                    'discontinued': '停产',
                    'created-time': '创建时间',
                    'product-notes-placeholder': '请输入产品备注信息...',
                    'search-product-placeholder': '搜索产品名/品牌/货号...',
                    'all-categories': '全部分类',
                    'all-status': '全部状态',
                    'sort-by-name': '产品名称',
                    'sort-by-brand': '品牌',
                    'sort-by-category': '分类',
                    'sort-by-price': '进货价',
                    'no-categories': '暂无产品分类，请点击"创建产品分类"添加',
                    'category-list': '产品分类列表',
                    'total-products-count': '总计 {count} 个产品',
                    'no-products': '暂无产品数据',
                    'add-product-submit': '添加产品',
                    'salon-region': '区域',
                    'responsible-person': '负责人',
                    'all-employees': '所有职员',
                    'unassigned': '未分配',
                    'admin': '管理员',
                    'manager': '经理',
                    'salesperson': '业务员',
                    'no-salons': '暂无沙龙数据',
                    'no-salon-info': '暂无沙龙信息',
                    'add-salon-tip': '点击"新增沙龙"来添加第一个沙龙',
                    'no-salesperson-salons': '您暂未分配到任何沙龙',
                    'salesperson-salon-tip': '请联系管理员为您分配沙龙',
                    'total-salons-count': '总计 {count} 家沙龙',
                    'district-salons-count': '共 {count} 家沙龙',
                    'search-salon-placeholder': '搜索沙龙名/院长名/手机号...',
                    'salon-phone': '店铺电话',
                    'salon-delete-list': '沙龙删除列表',
                    'no-salons-to-delete': '没有可删除的沙龙',
                    'danger-operations': '危险操作',
                    'delete-all-filtered': '删除所有筛选结果',
                    'delete-all-salons': '删除全部沙龙',
                    'danger-warning': '注意：删除操作不可撤销！',
                    'select-all-filtered': '全选筛选结果',
                    'select-all-global': '全选所有沙龙',
                    'select-all': '全选',
                    // 其他翻译...
                },
                ko: {
                    'employee-management': '직원 관리',
                    'new-employee': '직원 추가',
                    'employee-list': '직원 목록',
                    'delete-employee': '직원 삭제',
                    'customer-management': '살롱 관리',
                    'new-salon': '살롱 추가',
                    'single-add-salon': '단일 살롱 추가',
                    'batch-add-salon': '일괄 살롱 추가',
                    'salon-info': '살롱 정보',
                    'delete-salon': '살롱 삭제',
                    'district-management': '지역 관리',
                    'product-management': '제품 관리',
                    'add-product': '제품 추가',
                    'product-list': '제품 목록',
                    'product-category': '제품 카테고리',
                    'inventory-management': '재고 관리',
                    'stock-check': '재고 확인',
                    'restock-alert': '재고 보충 알림',
                    'usage-record': '사용 기록',
                    'finance-management': '재무 관리',
                    'income-record': '수입 기록',
                    'expense-record': '지출 기록',
                    'financial-report': '재무 보고서',
                    'performance-target': '실적 목표',
                    'audit-management': '작업 관리',
                    'operation-history': '작업 기록',
                    'data-comparison': '데이터 비교',
                    'audit-report': '감사 보고서',
                    'approval-management': '승인 관리',
                    'system-title': '메시아서부지점관리시스템',
                    'logout': '로그아웃',
                    'employee-name': '이름',
                    'employee-position': '직위',
                    'employee-mobile': '휴대폰',
                    'actions': '작업',
                    'edit-btn': '편집',
                    'delete': '삭제',
                    'admin': '관리자',
                    'manager': '매니저',
                    'salesperson': '영업사원',
                    'system-admin': '시스템 관리자',
                    'no-employees': '직원 데이터가 없습니다',
                    'employee-list-desc': '모든 직원의 상세 정보 목록이 여기에 표시됩니다.',
                    'dashboard': '개요',
                    'main-performance': '주요 실적',
                    'pending-business': '주요 업무 미처리',
                    'category': '분류',
                    'target': '목표',
                    'actual': '실적',
                    'progress-rate': '진행률(%)',
                    'my-performance': '내 실적',
                    'agency-total-performance': '대리점 총실적',
                    'transaction-salon-count': '거래 살롱 수',
                    'count': '건수',
                    'outbound-pending': '출고 미승인',
                    'payment-pending': '수금 미승인',
                    'delivery-pending': '배송 미완료',
                    'unit-label': '[단위:천원]',
                    'basic-info': '기본 정보',
                    'login-account': '로그인 계정',
                    'password': '비밀번호',
                    'contact-info': '연락처 정보',
                    'mobile-number': '휴대폰 번호',
                    'bank-account-info': '은행 계좌 정보',
                    'bank-name': '은행명',
                    'bank-account': '계좌번호',
                    'account-holder': '예금주',
                    'bank-branch': '비고',
                    'username-required': '로그인 계정을 입력하세요',
                    'password-required': '비밀번호를 입력하세요',
                    'employee-name-required': '직원 이름을 입력하세요',
                    'employee-added-success': '직원 추가 성공',
                    'username-already-exists': '이미 존재하는 로그인 계정입니다',
                    'employee-detail': '직원 상세정보',
                    'edit-employee': '직원 편집',
                    'employee-updated-success': '직원 정보가 성공적으로 업데이트되었습니다',
                    'cancel': '취소',
                    'save': '저장',
                    'add': '추가',
                    'create': '생성',
                    'confirm-delete': '삭제 확인',
                    'all-districts': '전체 지역',
                                'district-guro': '구로구',
            'district-yeongdeungpo': '영등포구',
            'district-geumcheon': '금천구',
            'district-gangso': '강서구',
                    'district-overseas': '해외 지역',
                    'sort-by': '정렬 방식',
            'first-page': '첫 페이지',
            'prev-page': '이전 페이지',
            'next-page': '다음 페이지',
            'last-page': '마지막 페이지',
            'items-per-page-10': '페이지당 표시: 10',
            'items-per-page-20': '페이지당 표시: 20',
            'items-per-page-50': '페이지당 표시: 50',
            'items-unit': '개',
            'pagination-info': '페이지 정보',
            'go-to-page': '다음으로 이동',
            'page-unit': '페이지',
            'jump-btn': '이동',
            'notes': '비고',
            'notes-placeholder': '여기에 비고 정보를 추가하세요...',
            'no-notes': '비고 정보가 없습니다',
                    'sort-name': '살롱 이름',
                    'sort-address': '주소 이름',
                    'sort-add-time': '추가 시간',
                    'sort-last-transaction': '마지막 거래',
                    'sort-overdue-days': '연체 일수',
                    'sort-overdue-amount': '연체 금액',
                    'sort-default': '기본 정렬',
                    'batch-upload-salon': '살롱 일괄 업로드',
                    'batch-upload-desc': '살롱 정보가 포함된 Excel 파일을 업로드하세요. 형식 요구사항: 첫 번째 행은 제목 행, 두 번째 행부터 살롱 데이터(살롱명, 살롱 주소, 원장 이름, 휴대폰 번호, 매장 전화, 이메일)를 입력하면 시스템이 자동으로 분석하여 살롱 데이터베이스에 가져옵니다.',
                    'select-file': '파일 선택',
                    'click-to-upload-file': '파일 업로드 클릭',
                    'file-format-hint': 'Excel 형식 지원(.xlsx, .xls)',
                    'process-file': '파일 처리',
                    'download-template': '템플릿 다운로드',
                    'salon-basic-info': '살롱 기본 정보',
                    'director-info': '원장 정보',
                    'director-name': '원장 성함',
                    'director-mobile': '원장 전화',
                    'salon-email': '이메일',
                    'responsible-employee-info': '담당 직원',
                    'salon-address-required': '살롱 주소는 필수입니다',
                    'please-select-file': '파일을 선택하세요',
                    'remove-file': '파일 제거',
                    'data-preview': '데이터 미리보기',
                    'select-all': '전체 선택',
                    'selected-count': '0개 살롱 선택됨',
                    'assign-responsible': '담당자 지정',
                    'assign-responsible-btn': '담당자 배정',
                    'confirm-batch-create': '일괄 생성 확인',
                    'salon-region': '살롱 지역',
                    'director-name-col': '원장 성함',
                    'responsible-person': '담당자',
                    'unassigned': '미지정',
                    'select': '선택',
                    'business-license': '사업자등록번호',
                    'salon-name': '살롱 이름',
                    'salon-address': '살롱 주소',
                    'salon-name-required': '살롱 이름을 입력하세요',
                    'salon-added-success': '살롱 추가 성공',
                    'no-salon-info': '살롱 정보가 없습니다',
                    'add-salon-tip': '살롱 추가 버튼을 클릭하여 첫 번째 살롱을 추가하세요',
                    'salon-address-label': '주소',
                    'business-license-label': '사업자등록증',
                    'responsible-employee': '담당 직원',
                    'director-name': '원장 성함',
                    'director-mobile': '원장 전화',
                    'salon-email': '이메일',
                    'add-time': '추가 시간',
                    'please-select-employee': '직원을 선택하세요',
                    'please-select-to-assign': '먼저 할당할 살롱을 선택하세요',
                    'assign-success': '{count}개 살롱에 대한 담당자가 {name}으로 설정되었습니다',
                    'please-select-to-create': '먼저 생성할 살롱을 선택하세요',
                    'batch-create-complete': '배치 생성 완료! 성공: {success}개, 실패: {fail}개',
                    'view-transactions-not-implemented': '거래 내역 보기 기능이 아직 구현되지 않았습니다',
                    'edit-salon-not-implemented': '살롱 편집 기능이 아직 구현되지 않았습니다',
                    'salon-list': '살롱 목록',
                    'salon-detail': '살롱 상세정보',
                    'basic-info': '기본 정보',
                    'contact-info': '연락처 정보',
                    'director-info': '원장 정보',
                    'other-info': '기타 정보',
                    'not-specified': '미지정',
                    'unspecified': '미지정',
                    'salon-not-found': '살롱을 찾을 수 없습니다',
                    'salon-updated-success': '살롱 정보가 성공적으로 업데이트되었습니다',
                    'total-salons-count': '총 {count}개 살롱',
                    'district-salons-count': '총 {count}개 살롱',
                    'no-salon-info': '살롱 정보가 없습니다',
                    'add-salon-tip': '살롱 추가 버튼을 클릭하여 첫 번째 살롱을 추가하세요',
                    'no-salesperson-salons': '할당된 살롱이 없습니다',
                    'salesperson-salon-tip': '관리자에게 살롱 할당을 요청하세요',
                    'salon-name-required': '살롱 이름을 입력하세요',
                    'no-matching-salons': '일치하는 살롱을 찾을 수 없습니다',
                    'please-select-salon': '살롱을 선택하세요',
                            'salon-deleted-success': '살롱 삭제 성공',
        'salon-delete-failed': '살롱 삭제 실패',
        'single-delete': '개별 삭제',
        'batch-delete': '일괄 삭제',
        'district-delete': '지역별 삭제',
        'select-all': '전체 선택',
        'deselect-all': '전체 해제',
        'selected-count': '선택됨: 0개 살롱',
        'delete-selected': '선택 항목 삭제',
        'delete-all': '전체 삭제',
        'please-select-responsible': '담당자를 선택하세요...',
        'responsible-salon-count-info': '해당 담당자 관리 살롱 수: 0',
        'delete-responsible-salons': '해당 담당자의 모든 살롱 삭제',
        'district-yangcheon': '양천구',
        'district-others': '기타 지역',
        'district-operations': '지역 작업',
        'add-district': '지역 추가',
        'edit-district': '지역 편집',
        'delete-district': '지역 삭제',
        'reset-to-default': '기본값으로 재설정',
        'export-config': '설정 내보내기',
        'import-config': '설정 가져오기',
        'district-list': '지역 목록',
        'total-districts': '총 {count}개 지역',
        'district-code': '지역 코드',
        'district-name-cn': '중국어 이름',
        'district-name-kr': '한국어 이름',
        'district-keywords': '주소 인식 키워드',
        'district-code-hint': '영문 코드, 예: gangnam, seoul-center',
        'district-keywords-hint': '쉼표로 구분, 예: 강남구,江南区,gangnam',
        'district-salon-count': '살롱 수',
        'confirm-delete-district': '지역 삭제 확인',
        'delete-district-warning': '지역을 삭제하면 해당 지역의 모든 살롱이 "기타 지역"으로 분류됩니다.',
        'district-added-success': '지역 추가 성공',
        'district-updated-success': '지역 업데이트 성공',
        'district-deleted-success': '지역 삭제 성공',
        'district-code-exists': '지역 코드가 이미 존재합니다',
        'invalid-district-config': '유효하지 않은 지역 설정 파일',
        'config-imported-success': '설정 가져오기 성공',
        'no-districts': '지역 데이터가 없습니다',
                    'clear-filters': '필터 지우기',
                    'select': '선택',
                    // 제품 관리 관련 번역
                    'product-basic-info': '제품 기본 정보',
                    'product-name': '제품명',
                    'brand-name': '브랜드명',
                    'product-model': '모델',
                    'product-sku': '상품번호',
                    'product-category-select': '제품 카테고리',
                    'please-select-category': '제품 카테고리를 선택하세요...',
                    'uncategorized': '미분류',
                    'product-specifications': '사양 정보',
                    'unit-type': '수량 단위',
                    'unit-piece': '개',
                    'unit-only': '개',
                    'unit-stick': '개',
                    'unit-bottle': '병',
                    'unit-box': '박스',
                    'unit-bag': '봉지',
                    'weight-volume': '무게/부피',
                    'weight-unit': '무게 단위',
                    'unit-gram': 'g（그램）',
                    'unit-ml': 'ml（밀리리터）',
                    'unit-kg': 'kg（킬로그램）',
                    'unit-liter': 'L（리터）',
                    'per-box-count': '박스당 수량',
                    'per-case-count': '케이스 규격',
                    'specification-summary': '사양 요약',
                    'price-info': '가격 정보',
                    'purchase-price': '매입가（₩）',
                    'wholesale-price': '도매가（₩）',
                    'retail-price': '소매가（₩）',
                    'is-on-sale': '판매중',
                    'is-discontinued': '단종',
                    'notes-info': '비고 정보',
                    'product-notes': '비고',
                    'product-name-required': '제품명을 입력하세요',
                    'reset-form': '폼 초기화',
                    'create-product-category': '제품 카테고리 생성',
                    'product-category-content': '제품 카테고리 정보 관리',
                    'category-name-cn': '카테고리명（중국어）',
                    'category-name-ko': '카테고리명（한국어）',
                    'category-code': '카테고리 코드',
                    'category-description': '카테고리 설명',
                    'edit-product-category': '제품 카테고리 편집',
                    'product-list-content': '모든 제품 정보 보기 및 관리',
                    'search-placeholder': '제품명, 브랜드 또는 상품번호 검색...',
                    'product-detail': '제품 상세정보',
                    'product-brand': '브랜드',
                    'product-model-label': '모델',
                    'product-sku-label': '상품번호',
                    'purchase-price-label': '매입가',
                    'wholesale-price-label': '도매가',
                    'retail-price-label': '소매가',
                    'status': '상태',
                    'on-sale': '판매중',
                    'discontinued': '단종',
                    'created-time': '생성 시간',
                    'product-notes-placeholder': '제품 비고 정보를 입력하세요...',
                    'search-product-placeholder': '제품명/브랜드/상품번호 검색...',
                    'all-categories': '전체 카테고리',
                    'all-status': '전체 상태',
                    'sort-by-name': '제품명',
                    'sort-by-brand': '브랜드',
                    'sort-by-category': '카테고리',
                    'sort-by-price': '매입가',
                    'no-categories': '제품 카테고리가 없습니다. "제품 카테고리 생성"을 클릭하여 추가하세요',
                    'category-list': '제품 카테고리 목록',
                    'total-products-count': '총 {count}개 제품',
                    'no-products': '제품 데이터가 없습니다',
                    'add-product-submit': '제품 추가',
                    'salon-region': '지역',
                    'responsible-person': '담당자',
                    'all-employees': '모든 직원',
                    'unassigned': '미배정',
                    'admin': '관리자',
                    'manager': '매니저',
                    'salesperson': '영업사원',
                    'no-salons': '살롱 데이터 없음',
                    'no-salon-info': '살롱 정보 없음',
                    'add-salon-tip': '"살롱 추가"를 클릭하여 첫 번째 살롱을 추가하세요',
                    'no-salesperson-salons': '할당된 살롱이 없습니다',
                    'salesperson-salon-tip': '관리자에게 살롱 할당을 요청하세요',
                    'total-salons-count': '총 {count}개 살롱',
                    'district-salons-count': '{count}개 살롱',
                    'search-salon-placeholder': '살롱명/원장명/휴대폰 검색...',
                    'salon-phone': '살롱 전화',
                    'salon-delete-list': '살롱 삭제 목록',
                    'no-salons-to-delete': '삭제할 살롱이 없습니다',
                    'danger-operations': '위험한 작업',
                    'delete-all-filtered': '모든 필터 결과 삭제',
                    'delete-all-salons': '모든 살롱 삭제',
                    'danger-warning': '주의: 삭제 작업은 되돌릴 수 없습니다!',
                    'select-all-filtered': '필터 결과 전체 선택',
                    'select-all-global': '모든 살롱 전체 선택',
                    'add-product-tip': '클릭',
                    'add-first-product': '하여 첫 번째 제품을 추가하세요',
                    'no-products': '제품 데이터가 없습니다',
                    'add-category-tip': '클릭',
                    'add-first-category': '버튼을 클릭하여 첫 번째 카테고리를 추가하세요',
                    'no-categories': '제품 카테고리가 없습니다',
                    'view': '보기',
                    // 其他翻译...
                }
            };
            
            return translations[currentLanguage] && translations[currentLanguage][key] 
                ? translations[currentLanguage][key] 
                : key;
        }
        
        // 更新界面文本
        function updateTexts() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                
                // 特殊处理沙龙数量显示
                if (key === 'total-salons-count' || key === 'district-salons-count') {
                    const salons = getSalons();
                    element.textContent = getText(key).replace('{count}', salons.length);
                } else {
                    element.textContent = getText(key);
                }
            });
            
            // 更新占位符文本
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = getText(key);
            });
        }
        
        // 用户菜单功能
        function showUserMenu() {
            const dropdown = document.getElementById('userMenuDropdown');
            if (dropdown) {
                if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                    dropdown.style.display = 'block';
                    
                    // 确保下拉菜单中的文本也更新
                    updateTexts();
                    
                    // 添加点击事件监听器，点击其他地方关闭菜单
                    setTimeout(() => {
                        document.addEventListener('click', closeMenuHandler);
                    }, 100);
                } else {
                    dropdown.style.display = 'none';
                    document.removeEventListener('click', closeMenuHandler);
                }
            }
        }
        
        // 关闭菜单的处理函数
        function closeMenuHandler(e) {
            const dropdown = document.getElementById('userMenuDropdown');
            const userName = document.getElementById('userName');
            
            // 如果点击的不是用户名和下拉菜单，则关闭菜单
            if (!userName.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.style.display = 'none';
                document.removeEventListener('click', closeMenuHandler);
            }
        }
        
        // 退出登录功能
        function logout() {
            // Firebase认证退出
            firebase.auth().signOut().then(() => {
                // 清除登录状态
                sessionStorage.removeItem('user');
                // 跳转到登录页面
                window.location.href = 'login.html';
            }).catch(error => {
                console.error('退出登录失败:', error);
                // 即使Firebase退出失败，也清除本地状态
                sessionStorage.removeItem('user');
                window.location.href = 'login.html';
            });
        }
        
        // 检查权限
        function hasPermission(requiredPosition) {
            // 假设当前用户是管理员，拥有所有权限
            return true;
        }
        
        // 检查登录状态
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            
            // 如果未登录，跳转到登录页面
            if (isLoggedIn !== 'true') {
                window.location.href = 'login.html';
            }
        }
        
        // 初始化系统
        function initializeSystem() {
            // Firebase认证已经处理登录状态检查
            
            // 延迟初始化测试数据，确保Firebase数据完全加载
            setTimeout(() => {
                initializeTestDataSafely();
            }, 3000); // 等待3秒确保数据加载完成
            
            // 初始化产品管理数据
            initializeProductData();
            
            // 获取当前用户信息
            const currentUserStr = localStorage.getItem('currentUser');
            if (currentUserStr) {
                window.currentUser = JSON.parse(currentUserStr);
                
                // 更新用户显示信息
                const userNameElement = document.getElementById('userName');
                const userPositionElement = document.getElementById('userPosition');
                
                if (userNameElement && window.currentUser.name) {
                    userNameElement.textContent = window.currentUser.name;
                    // 移除data-i18n属性，因为这是用户的实际姓名
                    userNameElement.removeAttribute('data-i18n');
                }
                
                if (userPositionElement && window.currentUser.position) {
                    // 设置正确的data-i18n属性
                    userPositionElement.setAttribute('data-i18n', window.currentUser.position);
                }
            }
            
            // 智能初始化语言（整合用户建议的方案）
            initializeLanguageSystem();
            
            // 显示默认内容 - 改为显示概况总览
            showContent('dashboard');
            
            // 初始化新增职员页面的默认值
            setTimeout(() => {
                const joinDateInput = document.getElementById('employeeJoinDate');
                if (joinDateInput) {
                    joinDateInput.valueAsDate = new Date();
                }
            }, 1000);
        }
        
        // 安全的初始化测试数据 - 防止覆盖现有数据（公司数据架构）
        function initializeTestDataSafely() {
            console.log('开始安全检查测试数据初始化（公司数据架构）...');
            
            const currentUser = firebase.auth().currentUser;
            if (!currentUser) {
                console.log('用户未登录，跳过测试数据初始化');
                return;
            }
            
            // 检查公司级别的数据是否存在
            firebase.database().ref('company').once('value')
                .then((snapshot) => {
                    const companyData = snapshot.val();
                    console.log('Firebase公司数据:', companyData);
                    
                    // 只有当公司数据完全为空时才创建测试数据
                    if (!companyData || Object.keys(companyData).length === 0) {
                        console.log('公司数据为空，检查管理员权限后创建测试数据');
                        checkAdminAndCreateTestData();
                    } else {
                        console.log('公司数据已存在，跳过测试数据创建');
                        // 显示数据统计
                        if (companyData.employees) {
                            console.log('已有员工数据:', Object.keys(companyData.employees).length, '条');
                        }
                        if (companyData.salons) {
                            console.log('已有沙龙数据:', Object.keys(companyData.salons).length, '条');
                        }
                        if (companyData.products) {
                            console.log('已有产品数据:', Object.keys(companyData.products).length, '条');
                        }
                    }
                })
                .catch((error) => {
                    console.error('检查Firebase公司数据时出错:', error);
                });
        }

        // 检查管理员权限并创建测试数据
        function checkAdminAndCreateTestData() {
            if (!firebaseDataManager) {
                console.log('数据管理器未初始化，稍后重试');
                setTimeout(checkAdminAndCreateTestData, 2000);
                return;
            }

            if (firebaseDataManager.hasAdminPermission()) {
                console.log('当前用户是管理员，创建测试数据');
                createInitialCompanyTestData();
            } else {
                console.log('当前用户不是管理员，跳过测试数据创建');
            }
        }
        
        // 创建公司级别的初始测试数据（只在完全没有数据时调用）
        function createInitialCompanyTestData() {
            console.log('正在创建公司级别的初始测试数据...');
            
            const testEmployees = [
                { 
                    id: 'emp_' + Date.now() + '_1', 
                    name: '张经理', 
                    position: 'manager', 
                    mobile: '13800138001',
                    email: 'manager@company.com',
                    joinDate: new Date().toISOString().split('T')[0],
                    bio: '经验丰富的管理人员',
                    addTime: new Date().toISOString(),
                    addedBy: 'system',
                    status: 'active'
                },
                { 
                    id: 'emp_' + Date.now() + '_2', 
                    name: '李业务', 
                    position: 'salesperson', 
                    mobile: '13800138002',
                    email: 'sales1@company.com',
                    joinDate: new Date().toISOString().split('T')[0],
                    bio: '优秀的业务代表',
                    addTime: new Date().toISOString(),
                    addedBy: 'system',
                    status: 'active'
                },
                { 
                    id: 'emp_' + Date.now() + '_3', 
                    name: '王业务', 
                    position: 'salesperson', 
                    mobile: '13800138003',
                    email: 'sales2@company.com',
                    joinDate: new Date().toISOString().split('T')[0],
                    bio: '专业的客户服务专员',
                    addTime: new Date().toISOString(),
                    addedBy: 'system',
                    status: 'active'
                }
            ];
            
            const testSalons = [
                { 
                    id: 'salon_' + Date.now() + '_1', 
                    name: '华丽美容室', 
                    address: '서울특별시 구로구 구로중앙로 123', 
                    businessLicense: '123-45-67890',
                    responsibleEmployeeId: testEmployees[1].id,
                    directorName: '김원장',
                    directorMobile: '010-1234-5678',
                    phone: '02-1234-5678',
                    email: 'salon1@example.com',
                    addTime: new Date().toISOString(),
                    addedBy: 'system',
                    status: 'active'
                },
                { 
                    id: 'salon_' + Date.now() + '_2', 
                    name: '지오헤어', 
                    address: '서울특별시 영등포구 영등포로 456', 
                    businessLicense: '234-56-78901',
                    responsibleEmployeeId: testEmployees[2].id,
                    directorName: '이사장',
                    directorMobile: '010-2345-6789',
                    phone: '02-2345-6789',
                    email: 'salon2@example.com',
                    addTime: new Date().toISOString(),
                    addedBy: 'system',
                    status: 'active'
                },
                { 
                    id: 'salon_' + Date.now() + '_3', 
                    name: '드보라', 
                    address: '서울특별시 금천구 금천로 789', 
                    businessLicense: '345-67-89012',
                    responsibleEmployeeId: testEmployees[1].id,
                    directorName: '박원장',
                    directorMobile: '010-3456-7890',
                    phone: '02-3456-7890',
                    email: 'salon3@example.com',
                    addTime: new Date().toISOString(),
                    addedBy: 'system',
                    status: 'active'
                }
            ];
            
            // 使用Firebase数据管理器保存测试数据
            if (firebaseDataManager) {
                firebaseDataManager.saveEmployees(testEmployees)
                    .then(() => {
                        console.log('员工测试数据保存成功');
                        return firebaseDataManager.saveSalons(testSalons);
                    })
                    .then(() => {
                        console.log('沙龙测试数据保存成功');
                        console.log('公司级别测试数据创建完成');
                    })
                    .catch((error) => {
                        console.error('保存测试数据失败:', error);
                    });
            } else {
                console.error('Firebase数据管理器未初始化');
            }
        }

        // 保留原始函数用于兼容性
        function createInitialTestData() {
            console.log('createInitialTestData被调用，转到公司级别测试数据创建');
            createInitialCompanyTestData();
        }
        
        // 原始的初始化测试数据函数（保留用于兼容性，但不再使用）
        function initializeTestData() {
            console.log('initializeTestData被调用，但已被initializeTestDataSafely替代');
        }
        
        // 更新产品分类
        function updateProductCategory() {
            const categoryId = parseInt(document.getElementById('editCategoryId').value);
            const categoryNameCN = document.getElementById('editCategoryNameCN').value.trim();
            const categoryNameKO = document.getElementById('editCategoryNameKO').value.trim();
            const categoryDescription = document.getElementById('editCategoryDescription').value.trim();
            
            // 验证输入
            if (!categoryNameCN || !categoryNameKO) {
                alert(getText('fill-category-names'));
                return false;
            }
            
            // 检查是否已存在相同名称的分类（排除当前分类）
            const exists = productCategories.some(category => 
                category.id !== categoryId && 
                (category.nameCN === categoryNameCN || category.nameKO === categoryNameKO)
            );
            
            if (exists) {
                alert(getText('category-name-exists-edit'));
                return false;
            }
            
            // 找到并更新分类
            const categoryIndex = productCategories.findIndex(cat => cat.id === categoryId);
            if (categoryIndex === -1) {
                alert('未找到该产品分类！');
                return false;
            }
            
            const oldCategory = { ...productCategories[categoryIndex] };
            
            // 更新分类信息
            productCategories[categoryIndex] = {
                ...productCategories[categoryIndex],
                nameCN: categoryNameCN,
                nameKO: categoryNameKO,
                description: categoryDescription,
                updateTime: new Date().toISOString(),
                updatedBy: currentUser?.name || '系统管理员'
            };
            
            // 保存到Firebase数据库
            saveProductCategories(productCategories);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'edit', 
                    'category', 
                    categoryId,
                    `${categoryNameCN}`,
                    `编辑产品分类：${oldCategory.nameCN} (${oldCategory.nameKO}) → ${categoryNameCN} (${categoryNameKO})`,
                    oldCategory,
                    productCategories[categoryIndex]
                );
            }
            
            // 刷新分类列表
            displayProductCategories();
            
            // 关闭模态框
            closeEditCategoryModal();
            
            // 显示成功消息
            alert(getText('category-updated-success'));
            
            return false;
        }
        
        // 删除产品分类
        function deleteProductCategory(categoryId, categoryName) {
            if (!confirm(`确定要删除产品分类"${categoryName}"吗？\n此操作无法撤销！`)) {
                return;
            }
            
            // 保存被删除的分类信息，用于操作记录
            const deletedCategory = productCategories.find(category => category.id === categoryId);
            
            // 从数组中删除
            productCategories = productCategories.filter(category => category.id !== categoryId);
            
            // 更新Firebase数据库
            saveProductCategories(productCategories);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'delete', 
                    'category', 
                    categoryId,
                    categoryName,
                    `删除产品分类：${categoryName}`,
                    deletedCategory,
                    null
                );
            }
            
            // 刷新列表
            displayProductCategories();
            
            alert('产品分类删除成功！');
        }

        // 加载产品分类选项
        function loadProductCategories() {
            const selectElement = document.getElementById('productCategory');
            if (!selectElement) return;
            
            let optionsHtml = `<option value="" data-i18n="please-select-category">${getText('please-select-category')}</option>`;
            
            productCategories.forEach(category => {
                optionsHtml += `<option value="${category.id}">${category.nameCN} / ${category.nameKO}</option>`;
            });
            
            selectElement.innerHTML = optionsHtml;
        }
        
        // 预览产品图片
        function previewProductImage(input) {
            const uploadIconArea = document.getElementById('uploadIconArea');
            const imagePreviewArea = document.getElementById('imagePreviewArea');
            const imagePreview = document.getElementById('productImagePreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    uploadIconArea.style.display = 'none';
                    imagePreviewArea.style.display = 'block';
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // 移除产品图片
        function removeProductImage(event) {
            event.stopPropagation();
            
            const uploadIconArea = document.getElementById('uploadIconArea');
            const imagePreviewArea = document.getElementById('imagePreviewArea');
            const productImageInput = document.getElementById('productImageInput');
            
            uploadIconArea.style.display = 'block';
            imagePreviewArea.style.display = 'none';
            productImageInput.value = '';
        }
        
        // 格式化价格输入
        function formatPriceInput(input) {
            // 只允许输入数字和小数点
            let value = input.value.replace(/[^\d.]/g, '');
            
            // 确保只有一个小数点
            const parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // 格式化显示
            if (value && !isNaN(parseFloat(value))) {
                const numValue = parseFloat(value);
                input.value = formatNumber(numValue);
            } else if (value === '') {
                input.value = '';
            }
        }
        
        // 格式化数字为千分位
        function formatNumber(num) {
            return num.toLocaleString('en-US');
        }
        
        // 格式化货币显示
        function formatCurrency(amount) {
            return '₩ ' + formatNumber(amount);
        }
        
        // 处理创建产品分类表单提交 - 使用DOM加载事件
        document.addEventListener('DOMContentLoaded', function() {
            const createCategoryForm = document.getElementById('createCategoryForm');
            if (createCategoryForm) {
                createCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    submitCreateCategory();
                });
            }
        });
        
        // 处理编辑产品分类表单提交 - 使用DOM加载事件
        document.addEventListener('DOMContentLoaded', function() {
            const editCategoryForm = document.getElementById('editCategoryForm');
            if (editCategoryForm) {
                editCategoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    updateProductCategory();
                });
            }
        });
        
        // ==================== 产品管理功能 ====================
        
        // 获取产品列表
        // 获取产品数据（已在Firebase封装中重新定义）
        // function getProducts() 已在Firebase封装中实现
        
        // 保存产品列表（已在Firebase封装中重新定义）
        // function saveProducts(products) 已在Firebase封装中实现
        
        // 添加产品
        function addProduct(product) {
            const products = getProducts();
            
            // 检查是否已存在相同编码的产品
            if (product.code && products.some(p => p.code === product.code)) {
                return false;
            }
            
            // 添加产品ID和创建时间
            product.id = Date.now();
            product.createTime = new Date().toISOString();
            product.createdBy = currentUser?.name || '系统管理员';
            
            products.push(product);
            saveProducts(products);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'create',
                    'product',
                    product.id,
                    `${product.nameCN}`,
                    `创建产品：${product.nameCN} (${product.nameKO})`,
                    null,
                    product
                );
            }
            
            return true;
        }
        
        // 显示产品列表
        function displayProductList() {
            const products = getProducts();
            const container = document.getElementById('product-list');
            
            if (!container) return;
            
            // 添加产品列表标题和搜索框
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <p data-i18n="product-list-desc">管理所有产品信息</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="productSearchInput" placeholder="${getText('search-products')}" oninput="searchProducts()" style="padding: 8px 12px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                        <select id="productCategoryFilter" onchange="searchProducts()" style="padding: 8px 12px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px;">
                            <option value="" data-i18n="all-categories">所有分类</option>
                        </select>
                    </div>
                </div>
            `;
            
            // 添加产品表格
            html += `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                        <thead>
                            <tr style="background: rgba(212, 175, 55, 0.1); border-bottom: 2px solid var(--gold);">
                                <th style="padding: 12px 15px; text-align: left; color: var(--gold);" data-i18n="product-name">产品名称</th>
                                <th style="padding: 12px 15px; text-align: left; color: var(--gold);" data-i18n="product-category">分类</th>
                                <th style="padding: 12px 15px; text-align: center; color: var(--gold);" data-i18n="product-code">编码</th>
                                <th style="padding: 12px 15px; text-align: right; color: var(--gold);" data-i18n="product-price">单价</th>
                                <th style="padding: 12px 15px; text-align: center; color: var(--gold);" data-i18n="stock">库存</th>
                                <th style="padding: 12px 15px; text-align: center; color: var(--gold);" data-i18n="status">状态</th>
                                <th style="padding: 12px 15px; text-align: center; color: var(--gold);" data-i18n="actions">操作</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
            `;
            
            // 填充产品数据
            if (products.length === 0) {
                html += `
                    <tr>
                        <td colspan="7" style="padding: 20px; text-align: center; color: #cccccc;" data-i18n="no-products">暂无产品数据</td>
                    </tr>
                `;
            } else {
                products.forEach(product => {
                    // 获取产品分类名称
                    let categoryName = '';
                    if (product.categoryId) {
                        const category = productCategories.find(c => c.id === parseInt(product.categoryId));
                        if (category) {
                            categoryName = category.nameCN;
                        }
                    }
                    
                    // 格式化价格
                    const formattedPrice = formatCurrency(parseFloat(product.price) || 0);
                    
                    // 状态标签
                    const statusLabel = product.isActive ? 
                        `<span style="background: #4CAF50; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em;" data-i18n="active">启用</span>` : 
                        `<span style="background: #f44336; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em;" data-i18n="inactive">停用</span>`;
                    
                    // 促销标签
                    const promotionalLabel = product.isPromotional ? 
                        `<span style="background: #FF9800; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 5px;" data-i18n="promotional">促销</span>` : 
                        '';
                    
                    html += `
                        <tr style="border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                            <td style="padding: 12px 15px;">
                                <div style="font-weight: bold; color: var(--text-light);">${product.nameCN}</div>
                                <div style="font-size: 0.9em; color: #aaaaaa;">${product.nameKO}</div>
                            </td>
                            <td style="padding: 12px 15px; color: #cccccc;">${categoryName || '-'}</td>
                            <td style="padding: 12px 15px; text-align: center; color: #cccccc;">${product.code || '-'}</td>
                            <td style="padding: 12px 15px; text-align: right; color: var(--gold);">${formattedPrice}</td>
                            <td style="padding: 12px 15px; text-align: center; color: #cccccc;">${product.stock || '0'}</td>
                            <td style="padding: 12px 15px; text-align: center;">
                                ${statusLabel}
                                ${promotionalLabel}
                            </td>
                            <td style="padding: 12px 15px; text-align: center;">
                                <div style="display: flex; gap: 5px; justify-content: center;">
                                    <button onclick="viewProductDetail(${product.id})" style="background: var(--gold); color: var(--black); border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8em;" data-i18n="view">查看</button>
                                    <button onclick="editProduct(${product.id})" style="background: #4CAF50; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8em;" data-i18n="edit-btn">编辑</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
            
            // 更新产品分类筛选选项
            updateProductCategoryFilterOptions();
            
            // 更新翻译
            updateTexts();
        }
        
        // 更新产品分类筛选选项
        function updateProductCategoryFilterOptions() {
            const selectElement = document.getElementById('productCategoryFilter');
            if (!selectElement) return;
            
            let optionsHtml = `<option value="" data-i18n="all-categories">${getText('all-categories')}</option>`;
            
            productCategories.forEach(category => {
                optionsHtml += `<option value="${category.id}">${category.nameCN}</option>`;
            });
            
            selectElement.innerHTML = optionsHtml;
        }
        
        // 搜索产品
        function searchProducts() {
            const searchInput = document.getElementById('productSearchInput');
            const categoryFilter = document.getElementById('productCategoryFilter');
            
            if (!searchInput || !categoryFilter) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            const categoryId = categoryFilter.value ? parseInt(categoryFilter.value) : null;
            
            const products = getProducts();
            const filteredProducts = products.filter(product => {
                const matchesSearch = 
                    !searchTerm || 
                    product.nameCN.toLowerCase().includes(searchTerm) ||
                    product.nameKO.toLowerCase().includes(searchTerm) ||
                    (product.code && product.code.toLowerCase().includes(searchTerm)) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryId || product.categoryId === categoryId;
                
                return matchesSearch && matchesCategory;
            });
            
            // 更新产品表格
            updateProductTable(filteredProducts);
        }
        
        // 更新产品表格
        function updateProductTable(products) {
            const tableBody = document.getElementById('productTableBody');
            if (!tableBody) return;
            
            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="padding: 20px; text-align: center; color: #cccccc;" data-i18n="no-products-found">未找到匹配的产品</td>
                    </tr>
                `;
                updateTexts();
                return;
            }
            
            let html = '';
            products.forEach(product => {
                // 获取产品分类名称
                let categoryName = '';
                if (product.categoryId) {
                    const category = productCategories.find(c => c.id === parseInt(product.categoryId));
                    if (category) {
                        categoryName = category.nameCN;
                    }
                }
                
                // 格式化价格
                const formattedPrice = formatCurrency(parseFloat(product.price) || 0);
                
                // 状态标签
                const statusLabel = product.isActive ? 
                    `<span style="background: #4CAF50; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em;" data-i18n="active">启用</span>` : 
                    `<span style="background: #f44336; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em;" data-i18n="inactive">停用</span>`;
                
                // 促销标签
                const promotionalLabel = product.isPromotional ? 
                    `<span style="background: #FF9800; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 5px;" data-i18n="promotional">促销</span>` : 
                    '';
                
                html += `
                    <tr style="border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                        <td style="padding: 12px 15px;">
                            <div style="font-weight: bold; color: var(--text-light);">${product.nameCN}</div>
                            <div style="font-size: 0.9em; color: #aaaaaa;">${product.nameKO}</div>
                        </td>
                        <td style="padding: 12px 15px; color: #cccccc;">${categoryName || '-'}</td>
                        <td style="padding: 12px 15px; text-align: center; color: #cccccc;">${product.code || '-'}</td>
                        <td style="padding: 12px 15px; text-align: right; color: var(--gold);">${formattedPrice}</td>
                        <td style="padding: 12px 15px; text-align: center; color: #cccccc;">${product.stock || '0'}</td>
                        <td style="padding: 12px 15px; text-align: center;">
                            ${statusLabel}
                            ${promotionalLabel}
                        </td>
                        <td style="padding: 12px 15px; text-align: center;">
                            <div style="display: flex; gap: 5px; justify-content: center;">
                                <button onclick="viewProductDetail(${product.id})" style="background: var(--gold); color: var(--black); border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8em;" data-i18n="view">查看</button>
                                <button onclick="editProduct(${product.id})" style="background: #4CAF50; color: white; border: none; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8em;" data-i18n="edit-btn">编辑</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            updateTexts();
        }
        
        // 处理添加产品表单提交
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 获取表单数据
            const productNameCN = document.getElementById('productNameCN').value.trim();
            const productNameKO = document.getElementById('productNameKO').value.trim();
            const productCategory = document.getElementById('productCategory').value;
            const productCode = document.getElementById('productCode').value.trim();
            const productPrice = document.getElementById('productPrice').value.replace(/[^\d.]/g, '');
            const productVolumePerUnit = document.getElementById('productVolumePerUnit').value.trim();
            const productBrand = document.getElementById('productBrand').value.trim();
            const productDescription = document.getElementById('productDescription').value.trim();
            
            // 库存信息
            const initialStock = parseInt(document.getElementById('initialStock').value) || 0;
            const minimumStock = parseInt(document.getElementById('minimumStock').value) || 0;
            const stockLocation = document.getElementById('stockLocation').value.trim();
            const enableAutoReorder = document.getElementById('enableAutoReorder').checked;
            
            // 其他设置
            const isActive = document.getElementById('isActive').checked;
            const isPromotional = document.getElementById('isPromotional').checked;
            const productTags = document.getElementById('productTags').value.trim();
            
            // 图片数据
            const productImageInput = document.getElementById('productImageInput');
            let imageData = null;
            if (productImageInput.files && productImageInput.files[0]) {
                const reader = new FileReader();
                reader.readAsDataURL(productImageInput.files[0]);
                reader.onload = function(e) {
                    imageData = e.target.result;
                    
                    // 继续提交产品
                    submitProduct();
                };
            } else {
                // 没有图片，直接提交产品
                submitProduct();
            }
            
            // 提交产品函数
            function submitProduct() {
                // 验证必填字段
                if (!productNameCN || !productNameKO) {
                    alert(getText('product-name-required'));
                    return;
                }
                
                // 创建产品对象
                const product = {
                    nameCN: productNameCN,
                    nameKO: productNameKO,
                    categoryId: productCategory || null,
                    code: productCode,
                    price: parseFloat(productPrice) || 0,
                    volumePerUnit: productVolumePerUnit,
                    brand: productBrand,
                    description: productDescription,
                    stock: initialStock,
                    minimumStock: minimumStock,
                    stockLocation: stockLocation,
                    enableAutoReorder: enableAutoReorder,
                    isActive: isActive,
                    isPromotional: isPromotional,
                    tags: productTags ? productTags.split(',').map(tag => tag.trim()) : [],
                    imageData: imageData
                };
                
                // 添加产品
                if (addProduct(product)) {
                    alert(getText('product-added-success'));
                    
                    // 清空表单
                    document.getElementById('addProductForm').reset();
                    
                    // 重置图片上传区域
                    const uploadIconArea = document.getElementById('uploadIconArea');
                    const imagePreviewArea = document.getElementById('imagePreviewArea');
                    if (uploadIconArea && imagePreviewArea) {
                        uploadIconArea.style.display = 'block';
                        imagePreviewArea.style.display = 'none';
                    }
                    
                    // 跳转到产品列表
                    showContent('product-list');
                } else {
                    alert(getText('product-code-exists'));
                }
            }
        });
        
        // ==================== 职员管理功能 ====================
        
        // 获取职员列表
        // 获取职员数据（已在Firebase封装中重新定义）
        // function getEmployees() 已在Firebase封装中实现
        
        // 保存职员列表（已在Firebase封装中重新定义）
        // function saveEmployees(employees) 已在Firebase封装中实现
        
        // 添加职员
        function addEmployee(employee) {
            const employees = getEmployees();
            
            // 检查是否已存在相同邮箱的职员（如果有邮箱）
            if (employee.email && employees.some(e => e.email === employee.email)) {
                return false;
            }
            
            // 添加职员ID和创建时间
            employee.id = Date.now();
            employee.createTime = new Date().toISOString();
            employee.status = 'active'; // 默认状态为活跃
            
            employees.push(employee);
            saveEmployees(employees);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'create',
                    'employee',
                    employee.id,
                    employee.name,
                    `创建职员：${employee.name}`,
                    null,
                    employee
                );
            }
            
            return true;
        }
        
        // 更新职员
        function updateEmployee(updatedEmployee) {
            const employees = getEmployees();
            const index = employees.findIndex(e => e.id === updatedEmployee.id);
            
            if (index === -1) return false;
            
            // 检查用户名是否已存在（排除当前职员）
            if (updatedEmployee.username && employees.some(e => e.username === updatedEmployee.username && e.id !== updatedEmployee.id)) {
                return false;
            }
            
            const oldEmployee = { ...employees[index] };
            
            // 如果没有提供新密码，保留旧密码
            if (!updatedEmployee.password) {
                updatedEmployee.password = oldEmployee.password;
            }
            
            // 更新职员信息
            employees[index] = {
                ...oldEmployee,
                ...updatedEmployee,
                updateTime: new Date().toISOString()
            };
            
            saveEmployees(employees);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'edit',
                    'employee',
                    updatedEmployee.id,
                    updatedEmployee.name,
                    `编辑职员：${oldEmployee.name} → ${updatedEmployee.name}`,
                    oldEmployee,
                    employees[index]
                );
            }
            
            return true;
        }
        
        // 删除职员
        function deleteEmployee(employeeId) {
            const employees = getEmployees();
            const employeeToDelete = employees.find(e => e.id === employeeId);
            
            if (!employeeToDelete) return false;
            
            // 从数组中删除
            const newEmployees = employees.filter(e => e.id !== employeeId);
            saveEmployees(newEmployees);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'delete',
                    'employee',
                    employeeId,
                    employeeToDelete.name,
                    `删除职员：${employeeToDelete.name}`,
                    employeeToDelete,
                    null
                );
            }
            
            return true;
        }
        
        // 显示职员列表
        function displayEmployeeList() {
            const employees = getEmployees();
            const container = document.getElementById('employee-list-content');
            
            if (!container) return;
            
            if (employees.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-employees">暂无职员数据</p>`;
                updateTexts();
                return;
            }
            
            // 创建职员列表表格
            let html = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(212, 175, 55, 0.1); border-bottom: 2px solid var(--gold);">
                            <th style="padding: 12px 15px; text-align: left; color: var(--gold);" data-i18n="employee-name">姓名</th>
                            <th style="padding: 12px 15px; text-align: center; color: var(--gold);" data-i18n="employee-position">职位</th>
                            <th style="padding: 12px 15px; text-align: center; color: var(--gold);" data-i18n="employee-mobile">手机号</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            employees.forEach(employee => {
                // 获取职位文本
                let positionText = '';
                switch (employee.position) {
                    case 'admin': positionText = getText('admin'); break;
                    case 'manager': positionText = getText('manager'); break;
                    case 'salesperson': positionText = getText('salesperson'); break;
                    default: positionText = employee.position;
                }
                
                html += `
                    <tr style="border-bottom: 1px solid rgba(212, 175, 55, 0.2); cursor: pointer;" onclick="showEmployeeDetail(${employee.id})">
                        <td style="padding: 12px 15px; color: var(--gold); text-decoration: underline;">${employee.name}</td>
                        <td style="padding: 12px 15px; text-align: center; color: #cccccc;">${positionText}</td>
                        <td style="padding: 12px 15px; text-align: center; color: #cccccc;">${employee.mobile || '-'}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            container.innerHTML = html;
            updateTexts();
        }
        
        // 确认删除职员
        function confirmDeleteEmployee(employeeId, employeeName) {
            if (confirm(`确定要删除职员"${employeeName}"吗？此操作无法撤销！`)) {
                if (deleteEmployee(employeeId)) {
                    alert(getText('employee-deleted-success'));
                    displayEmployeeList();
                } else {
                    alert(getText('employee-delete-failed'));
                }
            }
        }
        
        // 更新删除职员选项
        function updateDeleteEmployeeOptions() {
            const selectElement = document.getElementById('deleteEmployeeSelect');
            if (!selectElement) return;
            
            const employees = getEmployees();
            
            let optionsHtml = `<option value="" data-i18n="please-select-employee">${getText('please-select-employee')}</option>`;
            
            employees.forEach(employee => {
                optionsHtml += `<option value="${employee.id}">${employee.name} (${employee.position === 'admin' ? getText('admin') : employee.position === 'manager' ? getText('manager') : getText('salesperson')})</option>`;
            });
            
            selectElement.innerHTML = optionsHtml;
        }
        
        // 删除选定的职员
        function deleteSelectedEmployee() {
            const selectElement = document.getElementById('deleteEmployeeSelect');
            const employeeId = parseInt(selectElement.value);
            
            if (!employeeId) {
                alert(getText('please-select-employee'));
                return;
            }
            
            const employees = getEmployees();
            const employee = employees.find(e => e.id === employeeId);
            
            if (!employee) {
                alert(getText('employee-not-found'));
                return;
            }
            
            if (confirm(`确定要删除职员"${employee.name}"吗？此操作无法撤销！`)) {
                if (deleteEmployee(employeeId)) {
                    alert(getText('employee-deleted-success'));
                    updateDeleteEmployeeOptions();
                } else {
                    alert(getText('employee-delete-failed'));
                }
            }
        }
        
        // 搜索沙龙
        function searchSalons() {
            const searchInput = document.getElementById('salonSearchInput');
            const responsibleFilter = document.getElementById('responsibleFilter');
            
            if (!searchInput || !responsibleFilter) return;
            
            const searchTerm = searchInput.value.trim();
            const responsibleId = responsibleFilter.value ? parseInt(responsibleFilter.value) : null;
            
            // 搜索时重置到第一页
            displaySalonList({
                search: searchTerm,
                responsibleId: responsibleId
            }, 1);
        }
        
        // 更新负责职员选项
        function updateResponsibleEmployeeOptions() {
            const responsibleSelect = document.getElementById('responsibleEmployee');
            const responsibleBatchSelect = document.getElementById('responsibleEmployeeSelect');
            
            const employees = getEmployees();
            let optionsHtml = `<option value="">${getText('please-select-employee')}</option>`;
            
            employees.forEach(employee => {
                optionsHtml += `<option value="${employee.id}">${employee.name}</option>`;
            });
            
            if (responsibleSelect) {
                responsibleSelect.innerHTML = optionsHtml;
            }
            
            if (responsibleBatchSelect) {
                responsibleBatchSelect.innerHTML = optionsHtml;
            }
        }
        
        // 检查批量上传权限
        function checkBatchUploadPermission() {
            // 这里可以实现权限检查逻辑
        }
        
        // 预览沙龙文件
        function previewSalonFile(input) {
            const file = input.files[0];
            if (file) {
                const fileName = document.getElementById('fileName');
                const fileUploadIconArea = document.getElementById('fileUploadIconArea');
                const filePreviewArea = document.getElementById('filePreviewArea');
                
                fileName.textContent = file.name;
                fileUploadIconArea.style.display = 'none';
                filePreviewArea.style.display = 'block';
            }
        }
        
        // 移除沙龙文件
        function removeSalonFile(event) {
            event.stopPropagation();
            
            const fileInput = document.getElementById('salonFileInput');
            const fileUploadIconArea = document.getElementById('fileUploadIconArea');
            const filePreviewArea = document.getElementById('filePreviewArea');
            
            fileInput.value = '';
            fileUploadIconArea.style.display = 'block';
            filePreviewArea.style.display = 'none';
        }
        
        // 处理沙龙文件
        function processSalonFile() {
            // 检查SheetJS库是否已加载
            if (typeof XLSX === 'undefined') {
                alert('Excel处理库尚未加载完成，请稍后再试！');
                return;
            }
            
            const fileInput = document.getElementById('salonFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert(getText('please-select-file'));
                return;
            }
            
            // 检查文件类型
            const fileName = file.name.toLowerCase();
            if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
                alert('不支持的文件类型！请上传Excel文件（.xlsx或.xls格式）');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    
                    // 解析Excel文件
                    batchSalonData = parseExcelFile(workbook);
                    
                    if (batchSalonData.length === 0) {
                        alert('Excel文件中没有找到有效的沙龙数据');
                        return;
                    }
                    
                    // 显示预览
                    displayBatchPreview();
                    alert(`文件处理成功！共解析出 ${batchSalonData.length} 个沙龙信息`);
                    
                } catch (error) {
                    alert('文件解析失败：' + error.message);
                    console.error('Excel解析错误:', error);
                }
            };
            
            reader.onerror = function() {
                alert('文件读取失败');
            };
            
            reader.readAsBinaryString(file);
        }
        
        // 自动识别地址中的区域（使用动态区域数据）
        function autoDetectDistrict(address) {
            if (!address) return 'others'; // 没有地址的默认为其他地区
            
            const addressStr = address.toString().toLowerCase();
            
            // 获取动态区域数据
            let districts = [];
            try {
                districts = getDistricts();
            } catch (e) {
                console.error('获取区域数据失败:', e);
                // 如果获取失败，使用默认的硬编码匹配
                if (addressStr.includes('영등포구') || addressStr.includes('永登浦区')) {
                    return 'yeongdeungpo';
                } else if (addressStr.includes('구로구') || addressStr.includes('九老区')) {
                    return 'guro';
                } else if (addressStr.includes('금천구') || addressStr.includes('衿川区')) {
                    return 'geumcheon';
                } else if (addressStr.includes('양천구') || addressStr.includes('阳川区')) {
                    return 'yangcheon';
                } else if (addressStr.includes('강서구') || addressStr.includes('江西区')) {
                    return 'gangso';
                }
            }
            
            // 使用动态区域数据进行匹配
            for (const district of districts) {
                for (const keyword of district.keywords) {
                    if (addressStr.includes(keyword.toLowerCase())) {
                        return district.code;
                    }
                }
            }
            
            // 海外区域判断
            if (!addressStr.includes('서울') && !addressStr.includes('seoul') && !addressStr.includes('首尔') && 
                !addressStr.includes('대한민국') && !addressStr.includes('한국') && !addressStr.includes('中国') && 
                !addressStr.includes('부산') && !addressStr.includes('대구') && !addressStr.includes('인천')) {
                // 如果地址中不包含韩国主要城市相关字样，可能是海外区域
                return 'overseas';
            }
            
            return 'others'; // 无法识别的区域自动归类为其他地区
        }
        
        // 获取区域显示文本（使用动态区域数据）
        function getDistrictDisplayText(district) {
            if (!district) return getText('district-others');
            
            // 特殊区域处理
            if (district === 'others') return getText('district-others');
            if (district === 'overseas') return getText('district-overseas');
            
            // 尝试从动态区域数据获取
            try {
                const districts = getDistricts();
                const districtData = districts.find(d => d.code === district);
                if (districtData) {
                    const currentLanguage = localStorage.getItem('language') || 'zh';
                    return currentLanguage === 'ko' ? districtData.nameKr : districtData.nameCn;
                }
            } catch (e) {
                console.error('获取区域显示文本失败:', e);
            }
            
            // 回退到多语言文本系统
            const textKey = `district-${district}`;
            const displayText = getText(textKey);
            
            // 如果多语言系统中没有对应的文本，返回默认值
            if (displayText === textKey) {
                return getText('district-others');
            }
            
            return displayText;
        }
        
        // 检查是否为需要排除的业务类型（皮肤管理店、美甲店等）
        function isExcludedBusinessType(name, address) {
            const excludeKeywords = [
                // 皮肤管理相关韩文关键词
                '피부관리', '피부', '스킨케어', '에스테틱', '관리실',
                // 美甲相关韩文关键词
                '네일', '네일아트', '네일샵', '매니큐어', '페디큐어',
                // 其他非美发业务韩文关键词
                '마사지', '왁싱', '문신', '타투', '반영구', '아이라시',
                '속눈썹', '눈썹', '메이크업', '화장', '뷰티샵', '성형',
                // 中文关键词
                '皮肤管理', '美甲', '纹身', '按摩', '美容院', '化妆',
                '眉毛', '睫毛', '半永久', '美睫', '美甲店', '护肤',
                // 英文关键词
                'nail', 'skincare', 'massage', 'tattoo', 'makeup', 'beauty'
            ];
            
            const combinedText = (name + ' ' + address).toLowerCase();
            
            return excludeKeywords.some(keyword => {
                return combinedText.includes(keyword.toLowerCase());
            });
        }
        
        // 解析Excel文件
        function parseExcelFile(workbook) {
            // 检查是否有工作表
            if (!workbook.SheetNames || workbook.SheetNames.length === 0) {
                throw new Error('Excel文件中没有找到工作表');
            }
            
            // 获取第一个工作表
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            
            if (!worksheet) {
                throw new Error(`无法读取工作表：${sheetName}`);
            }
            
            // 转换为JSON格式
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            
            if (jsonData.length === 0) {
                throw new Error('工作表中没有数据');
            }
            
            if (jsonData.length < 3) {
                throw new Error('工作表数据不足，至少需要3行（标题行+列标题行+数据行）');
            }
            
            // 从第二行开始查找列标题（索引为1）
            const headers = jsonData[1] || [];
            
            // 查找沙龙名称列
            const nameIndex = headers.findIndex(h => {
                if (!h) return false;
                const headerStr = h.toString().toLowerCase();
                return headerStr.includes('업소명') || 
                       headerStr.includes('사업자명') || 
                       headerStr.includes('업체명') ||
                       headerStr.includes('상호명') ||
                       headerStr.includes('상호') ||
                       headerStr.includes('미용실') ||
                       headerStr.includes('헤어샵') ||
                       headerStr.includes('살롱') ||
                       headerStr.includes('매장명') ||
                       headerStr.includes('점포명') ||
                       headerStr.includes('리스트') ||
                       (headerStr.includes('이름') && !headerStr.includes('대표')) ||
                       headerStr.includes('name');
            });
            
            // 查找地址列
            const addressIndex = headers.findIndex(h => {
                if (!h) return false;
                const headerStr = h.toString().toLowerCase();
                return (headerStr.includes('영업소') && headerStr.includes('주소')) || 
                       headerStr.includes('주소') ||
                       headerStr.includes('위치') ||
                       headerStr.includes('소재지') ||
                       headerStr.includes('address') ||
                       headerStr.includes('location');
            });
            
            // 查找店铺电话列
            const phoneIndex = headers.findIndex(h => {
                if (!h) return false;
                const headerStr = h.toString().toLowerCase();
                return headerStr.includes('전화번호') ||
                       headerStr.includes('전화') ||
                       headerStr.includes('매장전화') ||
                       headerStr.includes('업소전화') ||
                       headerStr.includes('연락처') ||
                       (headerStr.includes('phone') && !headerStr.includes('mobile')) ||
                       headerStr.includes('tel');
            });
            
            // 查找院长姓名列
            const directorNameIndex = headers.findIndex(h => {
                if (!h) return false;
                const headerStr = h.toString().toLowerCase();
                return headerStr.includes('대표자명') ||
                       headerStr.includes('대표자') ||
                       headerStr.includes('원장명') ||
                       headerStr.includes('원장') ||
                       headerStr.includes('사장') ||
                       headerStr.includes('사장님') ||
                       headerStr.includes('대표') ||
                       (headerStr.includes('이름') && (headerStr.includes('대표') || headerStr.includes('원장'))) ||
                       headerStr.includes('director') ||
                       headerStr.includes('owner');
            });
            
            // 查找院长手机号列
            const directorMobileIndex = headers.findIndex(h => {
                if (!h) return false;
                const headerStr = h.toString().toLowerCase();
                return headerStr.includes('휴대폰') ||
                       headerStr.includes('핸드폰') ||
                       headerStr.includes('모바일') ||
                       headerStr.includes('원장휴대폰') ||
                       headerStr.includes('대표휴대폰') ||
                       headerStr.includes('mobile') ||
                       (headerStr.includes('phone') && headerStr.includes('mobile')) ||
                       headerStr.includes('cell');
            });
            
            // 查找邮箱列
            const emailIndex = headers.findIndex(h => {
                if (!h) return false;
                const headerStr = h.toString().toLowerCase();
                return headerStr.includes('이메일') ||
                       headerStr.includes('메일') ||
                       headerStr.includes('email') ||
                       headerStr.includes('e-mail');
            });
            
            if (nameIndex === -1 || addressIndex === -1) {
                const missingColumns = [];
                const foundColumns = headers.filter(h => h).join('、');
                
                if (nameIndex === -1) missingColumns.push('沙龙名称列（如：업소명、미용실、상호명等）');
                if (addressIndex === -1) missingColumns.push('地址列（如：주소、영업소 주소、위치等）');
                
                throw new Error(`Excel文件格式不符合要求！\n\n缺少必需的列：${missingColumns.join('、')}\n\n当前第2行的列标题：${foundColumns}\n\n期望的Excel格式：\n第1行：表格标题\n第2行：列标题（必须包含沙龙名称和地址列）\n第3行开始：实际数据`);
            }
            
            const salons = [];
            // 从第3行开始读取数据（索引为2）
            for (let i = 2; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (!row || row.length === 0) continue;
                
                const name = row[nameIndex] ? row[nameIndex].toString().trim() : '';
                const address = row[addressIndex] ? row[addressIndex].toString().trim() : '';
                
                if (name && address) {
                    // 检查是否为需要排除的店铺类型（皮肤管理店、美甲店等）
                    if (isExcludedBusinessType(name, address)) {
                        console.log('排除非美发沙龙:', name);
                        continue;
                    }
                    
                    // 自动识别区域
                    const detectedDistrict = autoDetectDistrict(address);
                    
                    // 解析其他字段
                    const phone = phoneIndex !== -1 && row[phoneIndex] ? row[phoneIndex].toString().trim() : '';
                    const directorName = directorNameIndex !== -1 && row[directorNameIndex] ? row[directorNameIndex].toString().trim() : '未指定';
                    const directorMobile = directorMobileIndex !== -1 && row[directorMobileIndex] ? row[directorMobileIndex].toString().trim() : '';
                    const email = emailIndex !== -1 && row[emailIndex] ? row[emailIndex].toString().trim() : '';
                    
                    salons.push({
                        name: name,
                        address: address,
                        district: detectedDistrict, // 添加自动识别的区域
                        businessLicense: '', // 可以后续添加列解析
                        directorName: directorName, // 解析的院长姓名
                        directorMobile: directorMobile, // 解析的院长手机号
                        phone: phone, // 解析的店铺电话
                        email: email, // 解析的邮箱
                        responsibleEmployeeId: null
                    });
                }
            }
            
            return salons;
        }
        
        // 显示批量预览
        function displayBatchPreview() {
            const dataPreviewArea = document.getElementById('dataPreviewArea');
            const dataPreviewTable = document.getElementById('dataPreviewTable');
            const confirmBtn = document.getElementById('confirmBatchCreateBtn');
            const cancelBtn = document.getElementById('cancelBatchBtn');
            
            // 更新负责职员选项
            updateResponsibleEmployeeOptions();
            
            // 构建表格HTML
            let tableHtml = `
                <table style="width: 100%; border-collapse: collapse; background: var(--dark-gray); table-layout: fixed; font-size: 0.75em;">
                    <colgroup>
                        <col style="width: 5%;">  <!-- 选择列 -->
                        <col style="width: 12%;">  <!-- 沙龙名称 -->
                        <col style="width: 28%;">  <!-- 地址 -->
                        <col style="width: 7%;">  <!-- 区域 -->
                        <col style="width: 10%;">  <!-- 院长姓名 -->
                        <col style="width: 12%;">  <!-- 院长手机 -->
                        <col style="width: 12%;">  <!-- 店铺电话 -->
                        <col style="width: 8%;">  <!-- 邮箱 -->
                        <col style="width: 6%;">   <!-- 负责人 -->
                    </colgroup>
                    <thead>
                        <tr style="background: rgba(135, 206, 235, 0.2);">
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; text-align: center; font-size: 0.8em;" data-i18n="select">选择</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="salon-name">沙龙名称</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="salon-address">地址</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="salon-region">区域</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="director-name">院长姓名</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="director-mobile">院长手机</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="salon-phone">店铺电话</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="salon-email">邮箱</th>
                            <th style="padding: 4px; border: 1px solid #87CEEB; color: #87CEEB; font-size: 0.8em;" data-i18n="responsible-person">负责人</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            batchSalonData.forEach((salon, index) => {
                const region = getDistrictDisplayText(salon.district);
                const responsibleText = salon.responsibleEmployeeId ? 
                    getEmployees().find(e => e.id === salon.responsibleEmployeeId)?.name || getText('unassigned') : 
                    getText('unassigned');
                
                tableHtml += `
                    <tr style="border-bottom: 1px solid #444;">
                        <td style="padding: 3px; border: 1px solid #444; text-align: center;">
                            <input type="checkbox" data-index="${index}" onchange="updateSelectedCount()" style="transform: scale(0.9);">
                        </td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--text-light); font-size: 0.75em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${salon.name}">${salon.name}</td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--text-light); font-size: 0.7em; line-height: 1.2; word-wrap: break-word; max-height: 32px; overflow: hidden;" title="${salon.address}">${salon.address}</td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--gold); font-size: 0.7em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${region}">${region}</td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--gold); font-size: 0.7em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${salon.directorName}">${salon.directorName}</td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--text-light); font-size: 0.7em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${salon.directorMobile || '-'}">${salon.directorMobile || '-'}</td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--text-light); font-size: 0.7em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${salon.phone || '-'}">${salon.phone || '-'}</td>
                        <td style="padding: 3px 4px; border: 1px solid #444; color: var(--text-light); font-size: 0.65em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${salon.email || '-'}">${salon.email || '-'}</td>
                        <td class="responsible-cell" style="padding: 3px 4px; border: 1px solid #444; color: #aaa; font-size: 0.65em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${responsibleText}">${responsibleText}</td>
                    </tr>
                `;
            });
            
            tableHtml += `
                    </tbody>
                </table>
            `;
            
            dataPreviewTable.innerHTML = tableHtml;
            dataPreviewArea.style.display = 'flex';
            confirmBtn.style.display = 'inline-block';
            cancelBtn.style.display = 'inline-block';
            
            updateTexts();
            updateSelectedCount();
        }
        
        // 批量数据存储
        let batchSalonData = [];
        
        // 沙龙数据管理函数（已在Firebase封装中重新定义）
        // function getSalons() 已在Firebase封装中实现
        
        // function saveSalons(salons) 已在Firebase封装中实现
        
        function addSalon(salon) {
            const salons = getSalons();
            salon.id = Date.now(); // 简单的ID生成
            salon.addTime = new Date().toLocaleString('zh-CN');
            salon.joinDate = new Date(); // 加入日期，用于计算
            salon.transactions = []; // 初始化交易记录数组
            salon.lastTransactionDate = null; // 最后一次交易日期
            salons.push(salon);
            saveSalons(salons);
            
            // 记录操作历史
            if (typeof recordOperation === 'function') {
                recordOperation(
                    'create', 
                    'salon', 
                    salon.id, 
                    salon.name, 
                    `创建新沙龙：${salon.name}，院长：${salon.directorName}`,
                    null,
                    salon
                );
            }
            
            return true;
        }
        
        function deleteSalon(salonId) {
            const salons = getSalons();
            const salonToDelete = salons.find(salon => salon.id === salonId);
            const filteredSalons = salons.filter(salon => salon.id !== salonId);
            saveSalons(filteredSalons);
            
            // 记录操作历史
            if (salonToDelete && typeof recordOperation === 'function') {
                recordOperation(
                    'delete', 
                    'salon', 
                    salonToDelete.id, 
                    salonToDelete.name, 
                    `删除沙龙：${salonToDelete.name}，院长：${salonToDelete.directorName}`,
                    salonToDelete,
                    null
                );
            }
        }
        
        function updateSalon(updatedSalon) {
            const salons = getSalons();
            const index = salons.findIndex(salon => salon.id === updatedSalon.id);
            
            if (index !== -1) {
                const beforeData = JSON.parse(JSON.stringify(salons[index]));
                
                // 保留原有的创建时间和交易记录
                updatedSalon.addTime = salons[index].addTime;
                updatedSalon.joinDate = salons[index].joinDate;
                updatedSalon.transactions = salons[index].transactions;
                updatedSalon.lastTransactionDate = salons[index].lastTransactionDate;
                
                salons[index] = updatedSalon;
                saveSalons(salons);
                
                // 记录操作历史
                if (typeof recordOperation === 'function') {
                    recordOperation(
                        'edit', 
                        'salon', 
                        updatedSalon.id, 
                        updatedSalon.name, 
                        `编辑沙龙信息：${updatedSalon.name}`,
                        beforeData,
                        updatedSalon
                    );
                }
                
                return true;
            }
            return false;
        }
        
        // 显示沙龙列表 - 支持排序和筛选
        function displaySalonList(filteredByDistrict = null, page = 1) {
            const salonListContainer = document.getElementById('salon-list-content');
            const salonCountText = document.getElementById('salon-count-text');
            let salons = getSalons();
            
            if (!salonListContainer) {
                console.error('salon-list-content element not found');
                return;
            }
            
            // 根据权限筛选沙龙列表
            if (currentUser && currentUser.position === 'salesperson') {
                // 业务员只能看到指定给自己负责的沙龙
                salons = salons.filter(salon => canSalespersonViewSalon(salon, currentUser.id));
            }
            
            // 如果有区域筛选
            if (filteredByDistrict) {
                salons = salons.filter(salon => salon.district === filteredByDistrict);
            }
            
            // 应用排序
            if (currentSortField !== 'default') {
                salons = applySalonSort(salons, currentSortField, currentSortOrder);
            }
            
            // 保存当前数据和筛选条件
            currentSalonsData = salons;
            currentFilter = filteredByDistrict;
            
            // 计算分页
            const totalItems = salons.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            currentPage = Math.min(Math.max(1, page), totalPages || 1);
            
            // 获取当前页的数据
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageSalons = salons.slice(startIndex, endIndex);
            
            // 更新分页信息
            updatePaginationInfo(currentPage, totalPages, totalItems);
            
            // 更新沙龙总数显示
            if (salonCountText) {
                if (filteredByDistrict) {
                    salonCountText.setAttribute('data-i18n', 'district-salons-count');
                    salonCountText.setAttribute('data-i18n-params', `{"count": "${salons.length}"}`);
                    salonCountText.textContent = getText('district-salons-count').replace('{count}', salons.length);
                } else {
                    salonCountText.setAttribute('data-i18n', 'total-salons-count');
                    salonCountText.setAttribute('data-i18n-params', `{"count": "${salons.length}"}`);
                    salonCountText.textContent = getText('total-salons-count').replace('{count}', salons.length);
                }
            }
            
            if (salons.length === 0) {
                let noSalonMessage = getText('no-salon-info');
                let tipMessage = getText('add-salon-tip');
                
                if (currentUser && currentUser.position === 'salesperson') {
                    noSalonMessage = getText('no-salesperson-salons');
                    tipMessage = getText('salesperson-salon-tip');
                }
                
                salonListContainer.innerHTML = `
                    <div style="text-align: center; color: #cccccc; padding: 40px;">
                        <p>${noSalonMessage}</p>
                        <p style="font-size: 0.9em;">${tipMessage}</p>
                    </div>
                `;
                
                // 更新沙龙总数显示
                if (salonCountText) {
                    if (filteredByDistrict) {
                        salonCountText.setAttribute('data-i18n', 'district-salons-count');
                        salonCountText.setAttribute('data-i18n-params', '{"count": "0"}');
                        salonCountText.textContent = getText('district-salons-count').replace('{count}', 0);
                    } else {
                        salonCountText.setAttribute('data-i18n', 'total-salons-count');
                        salonCountText.setAttribute('data-i18n-params', '{"count": "0"}');
                        salonCountText.textContent = getText('total-salons-count').replace('{count}', 0);
                    }
                }
                return;
            }
            
            let html = `<div style="display: flex; flex-direction: column; gap: 6px; padding-bottom: 10px;">`;
            
            currentPageSalons.forEach((salon, index) => {
                const responsibleEmployeeName = getEmployeeName(salon.responsibleEmployeeId);
                
                html += `
                    <div onclick="showSalonDetail(${salon.id})" style="
                        display: flex; 
                        justify-content: space-between; 
                        align-items: center; 
                        padding: 10px 12px; 
                        background: rgba(212, 175, 55, 0.1); 
                        border-radius: 5px; 
                        border: 1px solid rgba(212, 175, 55, 0.3);
                        cursor: pointer;
                        transition: all 0.3s ease;
                        hover: background-color: rgba(212, 175, 55, 0.2);
                    " 
                    onmouseover="this.style.backgroundColor='rgba(212, 175, 55, 0.2)'" 
                    onmouseout="this.style.backgroundColor='rgba(212, 175, 55, 0.1)'">
                        <!-- 左侧：店名 -->
                        <div style="flex: 1; color: var(--gold); font-weight: bold; font-size: 0.9em;">
                            ${salon.name}
                        </div>
                        <!-- 右侧：负责职员 -->
                        <div style="color: #cccccc; font-size: 0.8em;">
                            ${responsibleEmployeeName}
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            salonListContainer.innerHTML = html;
        }
        
        // 应用沙龙排序
        function applySalonSort(salons, sortField, sortOrder) {
            if (sortField === 'default') {
                return salons; // 返回原始顺序
            }
            
            return salons.sort((a, b) => {
                let valueA, valueB;
                
                switch (sortField) {
                    case 'name':
                        valueA = a.name ? a.name.toLowerCase() : '';
                        valueB = b.name ? b.name.toLowerCase() : '';
                        break;
                    case 'address':
                        valueA = a.address ? a.address.toLowerCase() : '';
                        valueB = b.address ? b.address.toLowerCase() : '';
                        break;
                    case 'addTime':
                        // 确保日期字符串可以正确比较，如果没有时间则使用默认值
                        valueA = a.addTime ? new Date(a.addTime).getTime() : 0;
                        valueB = b.addTime ? new Date(b.addTime).getTime() : 0;
                        break;
                    case 'lastTransaction':
                        // 最后交易时间排序
                        valueA = a.lastTransactionDate ? new Date(a.lastTransactionDate).getTime() : 0;
                        valueB = b.lastTransactionDate ? new Date(b.lastTransactionDate).getTime() : 0;
                        break;
                    case 'overdueDays':
                        // 欠款天数排序
                        valueA = calculateOverdueDays(a);
                        valueB = calculateOverdueDays(b);
                        break;
                    case 'overdueAmount':
                        // 欠款金额排序
                        valueA = calculateOverdueAmount(a);
                        valueB = calculateOverdueAmount(b);
                        break;
                    default:
                        return 0;
                }
                
                // 处理字符串比较
                if (typeof valueA === 'string' && typeof valueB === 'string') {
                    const result = valueA.localeCompare(valueB);
                    return sortOrder === 'asc' ? result : -result;
                }
                
                // 处理数字比较
                if (sortOrder === 'asc') {
                    return valueA - valueB;
                } else {
                    return valueB - valueA;
                }
            });
        }
        
        // 计算欠款天数
        function calculateOverdueDays(salon) {
            if (!salon.lastTransactionDate) {
                return 0; // 没有交易记录
            }
            
            const lastDate = new Date(salon.lastTransactionDate);
            const today = new Date();
            const diffTime = today - lastDate;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return Math.max(0, diffDays);
        }
        
        // 计算欠款金额
        function calculateOverdueAmount(salon) {
            if (!salon.transactions || salon.transactions.length === 0) {
                return 0;
            }
            
            let totalAmount = 0;
            salon.transactions.forEach(transaction => {
                if (transaction.status === 'pending' || transaction.status === 'overdue') {
                    totalAmount += parseFloat(transaction.amount) || 0;
                }
            });
            
            return totalAmount;
        }
        
        // 检查业务员是否可以查看沙龙
        function canSalespersonViewSalon(salon, salespersonId) {
            // 业务员可以查看分配给自己的沙龙
            return salon.responsibleEmployeeId == salespersonId;
        }
        
        // 获取职员姓名
        function getEmployeeName(employeeId) {
            if (!employeeId || employeeId === 'unassigned' || employeeId === '') {
                return getText('unassigned');
            }
            const employees = getEmployees();
            const employee = employees.find(emp => emp.id == employeeId);
            return employee ? employee.name : getText('unassigned');
        }
        
        // 获取职位文本
        function getPositionText(position) {
            switch (position) {
                case 'admin': return getText('admin');
                case 'manager': return getText('manager');
                case 'salesperson': return getText('salesperson');
                default: return position;
            }
        }
        
        // 更新负责职员筛选选项
        function updateResponsibleFilterOptions() {
            const selectElement = document.getElementById('responsibleFilter');
            if (!selectElement) return;
            
            const employees = getEmployees();
            let optionsHtml = `<option value="" data-i18n="all-employees">${getText('all-employees')}</option>`;
            
            employees.forEach(employee => {
                const positionText = getPositionText(employee.position);
                optionsHtml += `<option value="${employee.id}">${employee.name} - ${positionText}</option>`;
            });
            
            selectElement.innerHTML = optionsHtml;
            updateTexts(); // 确保翻译更新
        }
        
        // 下载Excel模板
        function downloadTemplate() {
            // 检查SheetJS库是否已加载
            if (typeof XLSX === 'undefined') {
                alert('Excel处理库尚未加载完成，请稍后再试！');
                return;
            }
            
            const sampleData = [
                ['살롱 정보 일괄 업로드 템플릿', '', '', ''],  // 第1行：表格标题
                ['업소명', '영업소 주소', '전화번호', '대표자명'],    // 第2行：列标题
                ['미용실 A', '서울 구로구 구로중앙로 12', '02-1234-5678', '김대표'],
                ['헤어샵 B', '서울 영등포구 영등포로 34', '02-2345-6789', '이사장'],
                ['뷰티샵 C', '서울 금천구 금천로 56', '02-3456-7890', '박원장'],
                ['살롱 D', '부산 해운대구 해운대로 78', '051-4567-8901', '최원장']
            ];
            
            try {
                // 创建新的工作簿
                const workbook = XLSX.utils.book_new();
                
                // 创建工作表
                const worksheet = XLSX.utils.aoa_to_sheet(sampleData);
                
                // 设置列宽
                worksheet['!cols'] = [
                    { width: 25 }, // 업소명/标题
                    { width: 35 }, // 영업소 주소
                    { width: 15 }, // 전화번호
                    { width: 15 }  // 대표자명
                ];
                
                // 合并第一行的单元格作为标题
                worksheet['!merges'] = [
                    { s: { r: 0, c: 0 }, e: { r: 0, c: 3 } }  // 合并第1行的A1到D1单元格
                ];
                
                // 添加工作表到工作簿
                XLSX.utils.book_append_sheet(workbook, worksheet, '沙龙信息');
                
                // 下载Excel文件
                XLSX.writeFile(workbook, 'salon_template_sample.xlsx');
            } catch (error) {
                // 如果Excel生成失败，回退到CSV格式
                console.warn('Excel生成失败，使用CSV格式:', error);
                const csvData = [
                    ['업소명', '영업소 주소', '전화번호', '대표자명'],
                    ['미용실 A', '서울 구로구 구로중앙로 12', '02-1234-5678', '김대표'],
                    ['헤어샵 B', '서울 영등포구 영등포로 34', '02-2345-6789', '이사장'],
                    ['뷰티샵 C', '서울 금천구 금천로 56', '02-3456-7890', '박원장'],
                    ['살롱 D', '부산 해운대구 해운대로 78', '051-4567-8901', '최원장']
                ];
                
                const csvContent = csvData.map(row => row.join(',')).join('\n');
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', 'salon_template_sample.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
        
        // 切换全选
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            // 只选择数据行的复选框，不包括全选复选框本身
            const checkboxes = document.querySelectorAll('#dataPreviewTable tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelectedCount();
        }
        
        // 更新选中计数
        function updateSelectedCount() {
            // 只查询数据行的复选框，不包括全选复选框
            const checkboxes = document.querySelectorAll('#dataPreviewTable tbody input[type="checkbox"]:checked');
            const selectedCountElement = document.querySelector('[data-i18n="selected-count"]');
            
            if (selectedCountElement) {
                const count = checkboxes.length;
                const currentLanguage = localStorage.getItem('language') || 'zh';
                selectedCountElement.textContent = currentLanguage === 'ko' ? 
                    `${count}개 살롱 선택됨` : 
                    `已选择 ${count} 个沙龙`;
            }
        }
        
        // 分配负责人
        function assignResponsible() {
            const responsibleSelect = document.getElementById('responsibleEmployeeSelect');
            const responsibleId = responsibleSelect.value;
            
            if (!responsibleId) {
                alert(getText('please-select-employee'));
                return;
            }
            
            // 只查询数据行的复选框
            const checkboxes = document.querySelectorAll('#dataPreviewTable tbody input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert(getText('please-select-to-assign'));
                return;
            }
            
            const employees = getEmployees();
            const employee = employees.find(e => e.id === parseInt(responsibleId));
            const employeeName = employee ? employee.name : getText('unassigned');
            
            checkboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const index = parseInt(checkbox.dataset.index);
                
                if (batchSalonData[index]) {
                    batchSalonData[index].responsibleEmployeeId = responsibleId;
                    
                    // 更新表格显示
                    const responsibleCell = row.querySelector('.responsible-cell');
                    if (responsibleCell) {
                        responsibleCell.textContent = employeeName;
                        responsibleCell.style.color = '#4CAF50';
                    }
                }
            });
            
            const message = getText('assign-success').replace('{count}', checkboxes.length).replace('{name}', employeeName);
            alert(message);
        }
        
        // 确认批量创建
        function confirmBatchCreate() {
            // 只查询数据行的复选框
            const checkboxes = document.querySelectorAll('#dataPreviewTable tbody input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert(getText('please-select-to-create'));
                return;
            }
            
            let successCount = 0;
            let failCount = 0;
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.dataset.index);
                const salonData = batchSalonData[index];
                
                if (salonData) {
                    if (addSalon(salonData)) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                }
            });
            
            const message = getText('batch-create-complete').replace('{success}', successCount).replace('{fail}', failCount);
            alert(message);
            
            if (successCount > 0) {
                cancelBatch();
                showContent('salon-info');
            }
        }
        
        // 取消批量操作
        function cancelBatch() {
            batchSalonData = [];
            
            const dataPreviewArea = document.getElementById('dataPreviewArea');
            const confirmBtn = document.getElementById('confirmBatchCreateBtn');
            const cancelBtn = document.getElementById('cancelBatchBtn');
            const fileInput = document.getElementById('salonFileInput');
            const fileUploadIconArea = document.getElementById('fileUploadIconArea');
            const filePreviewArea = document.getElementById('filePreviewArea');
            const dataPreviewTable = document.getElementById('dataPreviewTable');
            
            if (dataPreviewArea) dataPreviewArea.style.display = 'none';
            if (confirmBtn) confirmBtn.style.display = 'none';
            if (cancelBtn) cancelBtn.style.display = 'none';
            if (dataPreviewTable) dataPreviewTable.innerHTML = '';
            
            fileInput.value = '';
            fileUploadIconArea.style.display = 'block';
            filePreviewArea.style.display = 'none';
        }
        
        // 查看沙龙交易记录
        function viewTransactions(salonId) {
            // 这里可以实现查看交易记录的逻辑
            alert(getText('view-transactions-not-implemented'));
        }
        
        // 编辑沙龙
        function editSalon(salonId) {
            // 这里可以实现编辑沙龙的逻辑
            alert('编辑沙龙功能尚未实现');
        }
        
        // 处理新增沙龙表单提交
        document.getElementById('newSalonForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const salonName = document.getElementById('salonName').value.trim();
            const salonAddress = document.getElementById('salonAddress').value.trim();
            const businessLicense = document.getElementById('businessLicense').value.trim();
            const responsibleEmployeeId = document.getElementById('responsibleEmployee').value;
            const directorName = document.getElementById('directorName').value.trim();
            const directorMobile = document.getElementById('directorMobile').value.trim();
            const salonPhone = document.getElementById('salonPhone').value.trim();
            const salonEmail = document.getElementById('salonEmail').value.trim();
            const salonNotes = document.getElementById('salonNotes') ? document.getElementById('salonNotes').value.trim() : '';
            
            if (!salonName) {
                alert(getText('salon-name-required'));
                return;
            }
            
            if (!salonAddress) {
                alert(getText('salon-address-required'));
                return;
            }
            
            // 自动识别区域
            const detectedDistrict = autoDetectDistrict(salonAddress);
            
            const salon = {
                name: salonName,
                address: salonAddress,
                district: detectedDistrict, // 添加自动识别的区域
                businessLicense: businessLicense,
                responsibleEmployeeId: responsibleEmployeeId || null,
                directorName: directorName,
                directorMobile: directorMobile,
                phone: salonPhone,
                email: salonEmail,
                notes: salonNotes
            };
            
            if (addSalon(salon)) {
                alert(getText('salon-added-success'));
                this.reset();
                showContent('salon-info');
            }
        });
        
        // 处理新增职员表单提交
        document.getElementById('newEmployeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const employeeName = document.getElementById('employeeName').value.trim();
            const employeePosition = document.getElementById('employeePosition').value;
            const employeeEmail = document.getElementById('employeeEmail').value.trim();
            const employeeJoinDate = document.getElementById('employeeJoinDate').value;
            const employeeMobile = document.getElementById('employeeMobile').value.trim();
            const bankName = document.getElementById('bankName').value.trim();
            const bankAccount = document.getElementById('bankAccount').value.trim();
            const accountHolder = document.getElementById('accountHolder').value.trim() || employeeName;
            const bankBranch = document.getElementById('bankBranch').value.trim();
            
            if (!employeeName) {
                alert(getText('employee-name-required'));
                return;
            }
            
            // 验证邮箱格式（如果填写了邮箱）
            if (employeeEmail && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(employeeEmail)) {
                alert('请输入正确的邮箱格式');
                return;
            }
            
            const employee = {
                name: employeeName,
                position: employeePosition || 'salesperson',
                email: employeeEmail || '',
                joinDate: employeeJoinDate || new Date().toISOString().split('T')[0],
                mobile: employeeMobile,
                addedBy: 'manual-add', // 标记为手动添加
                bankInfo: {
                    bankName: bankName,
                    bankAccount: bankAccount,
                    accountHolder: accountHolder,
                    bankBranch: bankBranch
                }
            };
            
            if (addEmployee(employee)) {
                alert(getText('employee-added-success'));
                this.reset();
                // 设置默认入职日期为今天
                document.getElementById('employeeJoinDate').valueAsDate = new Date();
                showContent('employee-list');
            } else {
                alert('添加员工失败，请重试');
            }
        });
        
        // 记录操作历史
        function recordOperation(operationType, objectType, objectId, objectName, description, beforeData = null, afterData = null) {
            // 这里可以实现记录操作历史的逻辑
            console.log(`记录操作：${operationType} ${objectType} ${objectName} - ${description}`);
        }
        
        // 显示操作历史记录
        function displayOperationHistory() {
            // 这里可以实现显示操作历史记录的逻辑
            console.log('显示操作历史记录');
            
            // 模拟显示空数据
            const container = document.getElementById('operation-history-list');
            if (container) {
                container.innerHTML = `<p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-operation-history">暂无操作历史记录</p>`;
                updateTexts();
            }
        }
        
        // 筛选操作历史记录
        function filterOperationHistory() {
            // 这里可以实现筛选操作历史记录的逻辑
            console.log('筛选操作历史记录');
            displayOperationHistory();
        }
        
        // 清空历史筛选条件
        function clearHistoryFilters() {
            // 这里可以实现清空历史筛选条件的逻辑
            console.log('清空历史筛选条件');
            
            // 重置所有筛选控件
            const userFilter = document.getElementById('history-user-filter');
            const operationFilter = document.getElementById('history-operation-filter');
            const objectFilter = document.getElementById('history-object-filter');
            const startDateInput = document.getElementById('history-start-date');
            const endDateInput = document.getElementById('history-end-date');
            
            if (userFilter) userFilter.value = '';
            if (operationFilter) operationFilter.value = '';
            if (objectFilter) objectFilter.value = '';
            if (startDateInput) startDateInput.value = '';
            if (endDateInput) endDateInput.value = '';
            
            // 重新显示所有历史记录
            displayOperationHistory();
        }
        
        // 显示审计报告
        function displayAuditReport() {
            // 这里可以实现显示审计报告的逻辑
            console.log('显示审计报告');
            
            // 模拟显示统计数据
            document.getElementById('total-operations-count').textContent = '0';
            document.getElementById('today-operations-count').textContent = '0';
            document.getElementById('active-users-count').textContent = '0';
            document.getElementById('critical-operations-count').textContent = '0';
            
            // 模拟显示空数据
            const container = document.getElementById('audit-report-content');
            if (container) {
                container.innerHTML = `<p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-audit-data">暂无审计数据</p>`;
                updateTexts();
            }
        }
        
        // 显示审批列表
        function displayApprovalList() {
            // 这里可以实现显示审批列表的逻辑
            console.log('显示审批列表');
            
            // 模拟显示空数据
            const container = document.getElementById('approvalList');
            if (container) {
                container.innerHTML = `<p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-pending-approvals">暂无待审批项目</p>`;
                updateTexts();
            }
        }
        
        // 显示业绩目标
        function displayPerformanceTargets() {
            // 这里可以实现显示业绩目标的逻辑
            console.log('显示业绩目标');
            
            // 设置当前月份
            const now = new Date();
            const currentMonth = now.getMonth() + 1; // 月份从0开始，所以要+1
            const monthSelect = document.getElementById('performance-month');
            if (monthSelect) {
                monthSelect.value = currentMonth;
            }
            
            // 模拟显示团队目标数据
            document.getElementById('team-target-amount').textContent = '10,000';
            document.getElementById('team-actual-amount').textContent = '0';
            document.getElementById('team-progress-text').textContent = '0%';
            document.getElementById('team-progress-bar').style.width = '0%';
            document.getElementById('team-target-display').textContent = '10,000';
            
            // 模拟显示空数据
            const container = document.getElementById('performance-list');
            if (container) {
                container.innerHTML = `<p style="text-align: center; color: #cccccc; padding: 40px;" data-i18n="no-performance-data">暂无业绩数据</p>`;
                updateTexts();
            }
        }
        
        // 重新计算业绩目标
        function recalculatePerformanceTargets() {
            // 这里可以实现重新计算业绩目标的逻辑
            console.log('重新计算业绩目标');
            alert(getText('recalculate-targets-success'));
            displayPerformanceTargets();
        }
        
        // 重置业绩目标
        function resetPerformanceTargets() {
            // 这里可以实现重置业绩目标的逻辑
            console.log('重置业绩目标');
            if (confirm(getText('confirm-reset-targets'))) {
                alert(getText('reset-targets-success'));
                displayPerformanceTargets();
            }
        }
        
        // 显示职员详情
        function showEmployeeDetail(employeeId) {
            const employees = getEmployees();
            const employee = employees.find(e => e.id === employeeId);
            
            if (!employee) return;
            
            // 显示右侧详情面板并移除滚动条（查看模式不需要滚动条）
            const rightPanel = document.getElementById('employee-list-right');
            rightPanel.style.display = 'block';
            rightPanel.style.overflowY = 'visible';
            
            // 获取职位文本
            let positionText = '';
            switch (employee.position) {
                case 'admin': positionText = getText('admin'); break;
                case 'manager': positionText = getText('manager'); break;
                case 'salesperson': positionText = getText('salesperson'); break;
                default: positionText = employee.position;
            }
            
            // 构建详情HTML
            let detailHtml = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--gold); margin: 0;" data-i18n="employee-detail">职员详情</h2>
                    <button onclick="editEmployee(${employee.id})" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer;" data-i18n="edit-btn">编辑</button>
                </div>
                
                <!-- 基本信息 -->
                <div style="background: rgba(24,24,24,0.5); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 style="color: var(--gold); margin: 0 0 15px 0;" data-i18n="basic-info">基本信息</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="employee-name">姓名</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.name}</p>
                        </div>
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="employee-position">职位</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${positionText}</p>
                        </div>
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="login-account">登录账号</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.username || '-'}</p>
                        </div>
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="mobile-number">手机号</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.mobile || '-'}</p>
                        </div>
                    </div>
                </div>
                
                <!-- 银行账户信息 -->
                <div style="background: rgba(24,24,24,0.5); padding: 20px; border-radius: 8px;">
                    <h3 style="color: var(--gold); margin: 0 0 15px 0;" data-i18n="bank-account-info">银行账户信息</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="bank-name">银行名称</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.bankInfo?.bankName || '-'}</p>
                        </div>
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="bank-account">银行账号</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.bankInfo?.bankAccount || '-'}</p>
                        </div>
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="account-holder">账户持有人</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.bankInfo?.accountHolder || '-'}</p>
                        </div>
                        <div>
                            <label style="color: #aaa; font-size: 0.9em;" data-i18n="bank-branch">备注</label>
                            <p style="color: var(--text-light); font-size: 1.1em; margin: 5px 0;">${employee.bankInfo?.bankBranch || '-'}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('employee-detail-content').innerHTML = detailHtml;
            updateTexts();
        }
        
        // 保存职员编辑
        function saveEmployeeEdit(employeeId) {
            const updatedEmployee = {
                id: employeeId,
                name: document.getElementById('editEmployeeName').value.trim(),
                position: document.getElementById('editEmployeePosition').value,
                username: document.getElementById('editEmployeeUsername').value.trim(),
                password: document.getElementById('editEmployeePassword').value,
                mobile: document.getElementById('editEmployeeMobile').value.trim(),
                bankInfo: {
                    bankName: document.getElementById('editBankName').value.trim(),
                    bankAccount: document.getElementById('editBankAccount').value.trim(),
                    accountHolder: document.getElementById('editAccountHolder').value.trim() || document.getElementById('editEmployeeName').value.trim(),
                    bankBranch: document.getElementById('editBankBranch').value.trim()
                }
            };
            
            if (updateEmployee(updatedEmployee)) {
                alert(getText('employee-updated-success'));
                displayEmployeeList();
                showEmployeeDetail(employeeId);
            } else {
                alert(getText('username-already-exists'));
            }
        }
        
        // 编辑职员
        function editEmployee(employeeId) {
            const employees = getEmployees();
            const employee = employees.find(e => e.id === employeeId);
            
            if (!employee) return;
            
            // 为编辑模式添加滚动条（编辑表单内容较多，需要滚动）
            const rightPanel = document.getElementById('employee-list-right');
            rightPanel.style.overflowY = 'auto';
            
            // 获取当前语言的按钮文本
            const cancelText = getText('cancel');
            const saveText = getText('save');
            
            // 构建编辑表单HTML
            let editHtml = `
                <h2 style="color: var(--gold); margin: 0 0 20px 0;" data-i18n="edit-employee">编辑职员</h2>
                
                <form id="editEmployeeForm" onsubmit="saveEmployeeEdit(${employeeId}); return false;">
                    <!-- 基本信息 -->
                    <div style="background: rgba(24,24,24,0.5); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="color: var(--gold); margin: 0 0 15px 0;" data-i18n="basic-info">基本信息</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label for="editEmployeeName" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="employee-name">姓名：</label>
                                <input type="text" id="editEmployeeName" value="${employee.name}" required style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                            <div>
                                <label for="editEmployeePosition" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="employee-position">职位：</label>
                                <select id="editEmployeePosition" required style="width: 100%; padding: 10px; background: var(--dark-gray); border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                                    <option value="salesperson" ${employee.position === 'salesperson' ? 'selected' : ''} data-i18n="salesperson">业务员</option>
                                    <option value="manager" ${employee.position === 'manager' ? 'selected' : ''} data-i18n="manager">经理</option>
                                    <option value="admin" ${employee.position === 'admin' ? 'selected' : ''} data-i18n="admin">管理员</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label for="editEmployeeUsername" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="login-account">登录账号：</label>
                                <input type="text" id="editEmployeeUsername" value="${employee.username || ''}" required style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                            <div>
                                <label for="editEmployeePassword" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="password">密码（留空则不修改）：</label>
                                <input type="password" id="editEmployeePassword" placeholder="留空则不修改密码" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 联系信息 -->
                    <div style="background: rgba(24,24,24,0.5); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="color: var(--gold); margin: 0 0 15px 0;" data-i18n="contact-info">联系信息</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <label for="editEmployeeMobile" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="mobile-number">手机号：</label>
                            <input type="tel" id="editEmployeeMobile" value="${employee.mobile || ''}" oninput="formatPhoneNumber(this)" placeholder="13812345678 或 01029968866" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                        </div>
                    </div>
                    
                    <!-- 银行账户信息 -->
                    <div style="background: rgba(24,24,24,0.5); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="color: var(--gold); margin: 0 0 15px 0;" data-i18n="bank-account-info">银行账户信息</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label for="editBankName" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="bank-name">银行名称：</label>
                                <input type="text" id="editBankName" value="${employee.bankInfo?.bankName || ''}" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                            <div>
                                <label for="editBankAccount" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="bank-account">银行账号：</label>
                                <input type="text" id="editBankAccount" value="${employee.bankInfo?.bankAccount || ''}" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label for="editAccountHolder" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="account-holder">账户持有人：</label>
                            <input type="text" id="editAccountHolder" value="${employee.bankInfo?.accountHolder || ''}" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                        </div>
                        
                        <div>
                            <label for="editBankBranch" style="display: block; color: var(--gold); margin-bottom: 5px;" data-i18n="bank-branch">备注：</label>
                            <input type="text" id="editBankBranch" value="${employee.bankInfo?.bankBranch || ''}" style="width: 100%; padding: 10px; background: transparent; border: 1px solid var(--gold); color: var(--text-light); border-radius: 5px; box-sizing: border-box;">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="showEmployeeDetail(${employeeId})" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em; margin-right: 10px;">${cancelText}</button>
                        <button type="submit" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;">${saveText}</button>
                    </div>
                </form>
            `;
            
            document.getElementById('employee-detail-content').innerHTML = editHtml;
            updateTexts();
        }
        
        // 手机号码格式化函数（支持中国和韩国格式）
        function formatPhoneNumber(input) {
            // 只保留数字
            let value = input.value.replace(/\D/g, '');
            
            // 限制最大长度为11位
            if (value.length > 11) {
                value = value.slice(0, 11);
            }
            
            // 智能格式化：根据号码开头判断格式
            if (value.startsWith('1') && value.length >= 3) {
                // 中国手机号：1xxxxxxxxxx -> 无分隔符
                input.value = value;
            } else if ((value.startsWith('010') || value.startsWith('011') || value.startsWith('016') || 
                      value.startsWith('017') || value.startsWith('018') || value.startsWith('019')) && value.length >= 3) {
                // 韩国手机号：010-xxxx-xxxx 格式
                if (value.length >= 7) {
                    value = value.replace(/(\d{3})(\d{4})(\d{0,4})/, '$1-$2-$3');
                } else if (value.length >= 3) {
                    value = value.replace(/(\d{3})(\d{0,4})/, '$1-$2');
                }
                input.value = value;
            } else {
                // 其他情况：保持原样或按默认格式
                if (value.length >= 7) {
                    value = value.replace(/(\d{3})(\d{4})(\d{0,4})/, '$1-$2-$3');
                } else if (value.length >= 3) {
                    value = value.replace(/(\d{3})(\d{0,4})/, '$1-$2');
                }
                input.value = value;
            }
        }
        
        // 营业执照号码格式化函数
        function formatBusinessLicense(input) {
            // 只保留数字
            let value = input.value.replace(/\D/g, '');
            
            // 限制最大长度为10位
            if (value.length > 10) {
                value = value.slice(0, 10);
            }
            
            // 格式化为 000-00-00000
            if (value.length >= 8) {
                value = value.replace(/(\d{3})(\d{2})(\d{0,5})/, '$1-$2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{3})(\d{0,2})/, '$1-$2');
            }
            
            input.value = value;
        }
        
        // 检查登录状态
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            
            // 如果未登录，跳转到登录页面
            if (isLoggedIn !== 'true') {
                window.location.href = 'login.html';
            }
        }
        
        // 显示沙龙详情
        function showSalonDetail(salonId) {
            const salons = getSalons();
            const salon = salons.find(s => s.id === salonId);
            
            if (!salon) {
                console.error('Salon not found:', salonId);
                return;
            }
            
            const salonDetailRight = document.getElementById('salon-detail-right');
            const salonDetailContent = document.getElementById('salon-detail-content');
            
            if (!salonDetailRight || !salonDetailContent) {
                console.error('Salon detail elements not found');
                return;
            }
            
            // 显示右侧详情面板
            salonDetailRight.style.display = 'flex';
            
            // 生成详情内容
            const responsibleEmployeeName = getEmployeeName(salon.responsibleEmployeeId);
            
            const detailHtml = `
                <div style="width: 100%; line-height: 1.6;">
                    <!-- 第一排：基本信息和院长信息 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                        <!-- 基本信息 -->
                        <div>
                            <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="basic-info">基本信息</h4>
                            <div style="display: grid; gap: 10px;">
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="salon-name">沙龙名称：</span>
                                    <span style="color: var(--text-light); font-weight: bold; font-size: 1em; line-height: 1.4;">${salon.name}</span>
                                </div>
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="salon-address-label">地址：</span>
                                    <span style="color: var(--text-light); line-height: 1.4;">${salon.address || getText('not-specified')}</span>
                                </div>
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="business-license-label">营业执照：</span>
                                    <span style="color: var(--text-light); line-height: 1.4;">${salon.businessLicense || getText('not-specified')}</span>
                                </div>
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="responsible-employee">负责职员：</span>
                                    <span style="color: var(--gold); line-height: 1.4;">${responsibleEmployeeName}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 院长信息 -->
                        <div>
                            <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="director-info">院长信息</h4>
                            <div style="display: grid; gap: 10px;">
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="director-name">院长姓名：</span>
                                    <span style="color: var(--text-light); line-height: 1.4;">${salon.directorName || getText('not-specified')}</span>
                                </div>
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="director-mobile">院长手机：</span>
                                    <span style="color: var(--text-light); line-height: 1.4;">${salon.directorMobile || getText('not-specified')}</span>
                                </div>
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="salon-phone">店铺电话：</span>
                                    <span style="color: var(--text-light); line-height: 1.4;">${salon.phone || getText('not-specified')}</span>
                                </div>
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="salon-email">电子邮箱：</span>
                                    <span style="color: var(--text-light); line-height: 1.4;">${salon.email || getText('not-specified')}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第二排：其他信息 -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- 其他信息 -->
                        <div>
                            <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="other-info">其他信息</h4>
                            <div style="display: grid; gap: 10px;">
                                <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                    <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="add-time">添加时间：</span>
                                    <span style="color: var(--text-light); font-size: 0.9em; line-height: 1.4;">${salon.addTime || getText('not-specified')}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 备注信息 -->
                        <div>
                            <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="notes">备注</h4>
                            <div style="background: rgba(24,24,24,0.3); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 5px; padding: 12px; min-height: 80px; color: var(--text-light); font-size: 0.9em; line-height: 1.4;">
                                ${salon.notes || getText('no-notes')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            salonDetailContent.innerHTML = detailHtml;
            
            // 在标题行添加编辑按钮
            const actionButtons = document.getElementById('salon-action-buttons');
            if (actionButtons) {
                actionButtons.innerHTML = `
                    <button onclick="editSalonDetail(${salon.id})" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="edit-btn">编辑</button>
                `;
            }
            
            // 更新翻译文本
            updateTexts();
        }
        
        // 编辑沙龙详情
        function editSalonDetail(salonId) {
            const salons = getSalons();
            const salon = salons.find(s => s.id === salonId);
            
            if (!salon) {
                console.error('Salon not found:', salonId);
                return;
            }
            
            const salonDetailContent = document.getElementById('salon-detail-content');
            
            if (!salonDetailContent) {
                console.error('Salon detail content element not found');
                return;
            }
            
            // 生成编辑表单
            const editFormHtml = `
                <div class="edit-form-container" style="width: 100%; padding-bottom: 20px; line-height: 1.6;">
                    <form id="editSalonForm" style="width: 100%; box-sizing: border-box;">
                        <!-- 第一排：基本信息和院长信息 -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <!-- 基本信息 -->
                            <div>
                                <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px;" data-i18n="basic-info">基本信息</h4>
                                <div style="display: grid; gap: 12px;">
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="salon-name">沙龙名称：</label>
                                        <input type="text" id="editSalonName" value="${salon.name}" required style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        ">
                                    </div>
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="salon-address-label">地址：</label>
                                        <input type="text" id="editSalonAddress" value="${salon.address || ''}" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        ">
                                    </div>
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="business-license-label">营业执照：</label>
                                        <input type="text" id="editBusinessLicense" value="${salon.businessLicense || ''}" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        " oninput="formatBusinessLicense(this)">
                                    </div>
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="responsible-employee">负责职员：</label>
                                        <select id="editResponsibleEmployee" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        ">
                                            <option value="" data-i18n="please-select-employee">请选择职员</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 院长信息 -->
                            <div>
                                <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px;" data-i18n="director-info">院长信息</h4>
                                <div style="display: grid; gap: 12px;">
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="director-name">院长姓名：</label>
                                        <input type="text" id="editDirectorName" value="${salon.directorName || ''}" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        ">
                                    </div>
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="director-mobile">院长手机：</label>
                                        <input type="text" id="editDirectorMobile" value="${salon.directorMobile || ''}" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        " oninput="formatPhoneNumber(this)">
                                    </div>
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="salon-phone">店铺电话：</label>
                                        <input type="text" id="editSalonPhone" value="${salon.phone || ''}" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        ">
                                    </div>
                                    <div>
                                        <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="salon-email">电子邮箱：</label>
                                        <input type="email" id="editSalonEmail" value="${salon.email || ''}" style="
                                            width: 100%; 
                                            padding: 8px 10px; 
                                            background: rgba(24,24,24,0.8); 
                                            border: 1px solid rgba(212, 175, 55, 0.5); 
                                            color: var(--text-light); 
                                            border-radius: 5px;
                                            font-size: 0.9em;
                                            box-sizing: border-box;
                                            height: 40px;
                                        ">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 第二排：备注信息 -->
                        <div style="margin-bottom: 25px;">
                            <div>
                                <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px;" data-i18n="notes">备注</h4>
                                <div>
                                    <label style="color: #cccccc; display: block; margin-bottom: 6px; font-size: 0.9em;" data-i18n="notes">备注：</label>
                                    <textarea id="editSalonNotes" data-i18n-placeholder="notes-placeholder" placeholder="在这里添加备注信息..." style="
                                        width: 100%; 
                                        padding: 8px 10px; 
                                        background: rgba(24,24,24,0.8); 
                                        border: 1px solid rgba(212, 175, 55, 0.5); 
                                        color: var(--text-light); 
                                        border-radius: 5px;
                                        font-size: 0.9em;
                                        box-sizing: border-box;
                                        min-height: 80px;
                                        resize: vertical;
                                        font-family: inherit;
                                    ">${salon.notes || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            `;
            
            salonDetailContent.innerHTML = editFormHtml;
            
            // 在标题行添加取消和保存按钮
            const actionButtons = document.getElementById('salon-action-buttons');
            if (actionButtons) {
                actionButtons.innerHTML = `
                    <button onclick="cancelSalonEdit(${salon.id})" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em; margin-right: 10px;" data-i18n="cancel">取消</button>
                    <button onclick="saveSalonEdit(${salon.id})" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="save">保存</button>
                `;
            }
            
            // 填充职员下拉选项
            const employees = getEmployees();
            const responsibleSelect = document.getElementById('editResponsibleEmployee');
            if (responsibleSelect) {
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    if (employee.id == salon.responsibleEmployeeId) {
                        option.selected = true;
                    }
                    responsibleSelect.appendChild(option);
                });
            }
            
            // 更新翻译文本
            updateTexts();
        }
        
        // 取消沙龙编辑
        function cancelSalonEdit(salonId) {
            showSalonDetail(salonId);
        }
        
        // 保存沙龙编辑
        function saveSalonEdit(salonId) {
            const form = document.getElementById('editSalonForm');
            if (!form) return;
            
            const salonName = document.getElementById('editSalonName').value.trim();
            const salonAddress = document.getElementById('editSalonAddress').value.trim();
            const businessLicense = document.getElementById('editBusinessLicense').value.trim();
            const responsibleEmployeeId = document.getElementById('editResponsibleEmployee').value;
            const salonPhone = document.getElementById('editSalonPhone').value.trim();
            const salonEmail = document.getElementById('editSalonEmail').value.trim();
            const directorName = document.getElementById('editDirectorName').value.trim();
            const directorMobile = document.getElementById('editDirectorMobile').value.trim();
            const salonNotes = document.getElementById('editSalonNotes').value.trim();
            
            if (!salonName) {
                alert(getText('salon-name-required'));
                return;
            }
            
            const salons = getSalons();
            const salonIndex = salons.findIndex(s => s.id === salonId);
            
            if (salonIndex === -1) {
                alert(getText('salon-not-found'));
                return;
            }
            
            // 更新沙龙数据
            salons[salonIndex] = {
                ...salons[salonIndex],
                name: salonName,
                address: salonAddress,
                businessLicense: businessLicense,
                responsibleEmployeeId: responsibleEmployeeId || null,
                phone: salonPhone,
                email: salonEmail,
                directorName: directorName,
                directorMobile: directorMobile,
                notes: salonNotes
            };
            
            // 保存到localStorage
            saveSalons(salons);
            
            // 显示成功消息
            alert(getText('salon-updated-success'));
            
            // 刷新列表和详情
            displaySalonList();
            showSalonDetail(salonId);
        }
        
        // 清空所有筛选条件
        function clearAllFilters() {
            document.getElementById('salonSearchInput').value = '';
            document.getElementById('responsibleFilter').value = '';
            document.getElementById('districtFilter').value = '';
            
            // 重新显示所有沙龙，重置到第一页
            displaySalonList(null, 1);
        }
        
        // 增强的搜索沙龙函数
        function searchSalons() {
            const searchInput = document.getElementById('salonSearchInput').value.toLowerCase();
            const responsibleFilter = document.getElementById('responsibleFilter').value;
            const districtFilter = document.getElementById('districtFilter').value;
            
            const salons = getSalons();
            let filteredSalons = salons;
            
            // 文本搜索：支持沙龙名、院长名、手机号
            if (searchInput) {
                filteredSalons = filteredSalons.filter(salon => {
                    return (salon.name && salon.name.toLowerCase().includes(searchInput)) ||
                           (salon.directorName && salon.directorName.toLowerCase().includes(searchInput)) ||
                           (salon.directorMobile && salon.directorMobile.includes(searchInput)) ||
                           (salon.phone && salon.phone.includes(searchInput));
                });
            }
            
            // 负责人筛选
            if (responsibleFilter) {
                filteredSalons = filteredSalons.filter(salon => {
                    return salon.responsibleEmployeeId == responsibleFilter;
                });
            }
            
            // 区域筛选
            if (districtFilter) {
                filteredSalons = filteredSalons.filter(salon => {
                    // 使用沙龙的district字段进行筛选，更准确
                    if (salon.district) {
                        return salon.district === districtFilter;
                    } else {
                        // 如果没有district字段，回退到地址匹配
                        if (!salon.address) return districtFilter === 'others';
                        
                        // 使用动态区域数据匹配
                        try {
                            const districts = getDistricts();
                            const districtData = districts.find(d => d.code === districtFilter);
                            if (districtData) {
                                for (const keyword of districtData.keywords) {
                                    if (salon.address.toLowerCase().includes(keyword.toLowerCase())) {
                                        return true;
                                    }
                                }
                            }
                        } catch (e) {
                            console.error('获取区域数据失败:', e);
                            // 回退到硬编码匹配
                            switch (districtFilter) {
                                case 'yeongdeungpo':
                                    return salon.address.includes('영등포구') || salon.address.includes('永登浦区');
                                case 'guro':
                                    return salon.address.includes('구로구') || salon.address.includes('九老区');
                                case 'geumcheon':
                                    return salon.address.includes('금천구') || salon.address.includes('衿川구') || 
                                           salon.address.includes('衿川区') || salon.address.includes('금천') || 
                                           salon.address.includes('衿川') || salon.address.includes('Geumcheon') ||
                                           salon.address.toLowerCase().includes('geumcheon');
                                case 'yangcheon':
                                    return salon.address.includes('양천구') || salon.address.includes('阳川区');
                                case 'gangso':
                                    return salon.address.includes('강서구') || salon.address.includes('江西区');
                                case 'others':
                                    return !salon.address.includes('구로구') && !salon.address.includes('영등포구') && 
                                           !salon.address.includes('금천구') && !salon.address.includes('양천구') && !salon.address.includes('강서구') &&
                                           !salon.address.includes('九老区') && !salon.address.includes('永登浦区') && 
                                           !salon.address.includes('衿川区') && !salon.address.includes('阳川区') && !salon.address.includes('江西区') &&
                                           (salon.address.includes('서울') || salon.address.includes('seoul') || salon.address.includes('首尔') ||
                                            salon.address.includes('대한민국') || salon.address.includes('한국') || 
                                            salon.address.includes('부산') || salon.address.includes('대구') || salon.address.includes('인천'));
                                case 'overseas':
                                    return !salon.address.includes('서울') && !salon.address.includes('seoul') && !salon.address.includes('首尔') && 
                                           !salon.address.includes('대한민국') && !salon.address.includes('한국') && 
                                           !salon.address.includes('부산') && !salon.address.includes('대구') && !salon.address.includes('인천');
                                default:
                                    return true;
                            }
                        }
                    }
                });
            }
            
            // 更新显示
            displayFilteredSalonList(filteredSalons);
        }
        
        // 显示筛选后的沙龙列表
        function displayFilteredSalonList(salons, page = 1) {
            const salonListContainer = document.getElementById('salon-list-content');
            const salonCountText = document.getElementById('salon-count-text');
            
            if (!salonListContainer) return;
            
            // 应用排序
            if (currentSortField !== 'default') {
                salons = applySalonSort(salons, currentSortField, currentSortOrder);
            }
            
            // 保存当前数据和筛选状态
            currentSalonsData = salons;
            currentFilter = 'filtered'; // 标记为筛选状态
            
            // 计算分页
            const totalItems = salons.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            currentPage = Math.min(Math.max(1, page), totalPages || 1);
            
            // 获取当前页的数据
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageSalons = salons.slice(startIndex, endIndex);
            
            // 更新分页信息
            updatePaginationInfo(currentPage, totalPages, totalItems);
            
            // 更新统计数字
            if (salonCountText) {
                salonCountText.textContent = getText('total-salons-count').replace('{count}', salons.length);
            }
            
            if (salons.length === 0) {
                salonListContainer.innerHTML = `
                    <div style="text-align: center; color: #cccccc; padding: 40px;">
                        <p>${getText('no-matching-salons')}</p>
                    </div>
                `;
                return;
            }
            
            // 生成列表HTML - 使用与正常列表相同的格式
            let html = `<div style="display: flex; flex-direction: column; gap: 6px; padding-bottom: 10px;">`;
            
            currentPageSalons.forEach(salon => {
                const responsibleEmployeeName = getEmployeeName(salon.responsibleEmployeeId);
                
                html += `
                    <div onclick="showSalonDetail(${salon.id})" style="
                        display: flex; 
                        justify-content: space-between; 
                        align-items: center; 
                        padding: 10px 12px; 
                        background: rgba(212, 175, 55, 0.1); 
                        border-radius: 5px; 
                        border: 1px solid rgba(212, 175, 55, 0.3);
                        cursor: pointer;
                        transition: all 0.3s ease;
                        hover: background-color: rgba(212, 175, 55, 0.2);
                    " 
                    onmouseover="this.style.backgroundColor='rgba(212, 175, 55, 0.2)'" 
                    onmouseout="this.style.backgroundColor='rgba(212, 175, 55, 0.1)'">
                        <!-- 左侧：店名 -->
                        <div style="flex: 1; color: var(--gold); font-weight: bold; font-size: 0.9em;">
                            ${salon.name}
                        </div>
                        <!-- 右侧：负责职员 -->
                        <div style="color: #cccccc; font-size: 0.8em;">
                            ${responsibleEmployeeName}
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            salonListContainer.innerHTML = html;
        }
        
        // 显示删除页面的沙龙列表
        function displayDeleteSalonList(page = 1) {
            const listContainer = document.getElementById('delete-salon-list-content');
            
            if (!listContainer) {
                console.error('找不到沙龙列表容器 (delete-salon-list-content)');
                return;
            }
            
            console.log('=== 开始显示删除沙龙列表 ===');
            console.log('当前筛选的沙龙数量:', deleteFilteredSalons.length);
            console.log('请求显示第', page, '页');
            
            const allSalons = getSalons();
            
            // 计算分页
            const totalItems = deleteFilteredSalons.length;
            const totalPages = Math.ceil(totalItems / deleteItemsPerPage) || 1;
            deleteCurrentPage = Math.min(Math.max(1, page), totalPages);
            
            console.log('分页信息 - 总项目数:', totalItems, '总页数:', totalPages, '当前页:', deleteCurrentPage);
            
            // 获取当前页的数据
            const startIndex = (deleteCurrentPage - 1) * deleteItemsPerPage;
            const endIndex = startIndex + deleteItemsPerPage;
            const currentPageSalons = deleteFilteredSalons.slice(startIndex, endIndex);
            
            console.log('当前页显示沙龙数量:', currentPageSalons.length);
            
            // 更新统计信息
            updateDeleteStatistics(allSalons.length, deleteFilteredSalons.length);
            
            // 更新分页信息
            updateDeletePaginationInfo(deleteCurrentPage, totalPages, totalItems);
            
            if (deleteFilteredSalons.length === 0) {
                console.log('没有沙龙数据，显示空状态');
                listContainer.innerHTML = `
                    <div style="text-align: center; color: #cccccc; padding: 40px;">
                        <p data-i18n="no-salons-to-delete">没有可删除的沙龙</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">请检查筛选条件或添加新的沙龙</p>
                    </div>
                `;
                updateTexts();
                return;
            }
            
            // 生成列表HTML
            let html = `<div style="display: flex; flex-direction: column; gap: 8px; padding-bottom: 20px;">`;
            
            currentPageSalons.forEach((salon, index) => {
                const isSelected = deleteSelectedSalonIds.has(salon.id);
                const responsibleEmployeeName = getEmployeeName(salon.responsibleEmployeeId);
                const districtName = getDistrictDisplayText(salon.district);
                
                html += `
                    <div style="
                        display: flex; 
                        align-items: center; 
                        padding: 12px 15px; 
                        background: ${isSelected ? 'rgba(212, 175, 55, 0.3)' : 'rgba(212, 175, 55, 0.1)'}; 
                        border-radius: 6px; 
                        border: 1px solid ${isSelected ? 'var(--gold)' : 'rgba(212, 175, 55, 0.3)'};
                        transition: all 0.3s ease;
                        margin-bottom: 2px;
                    " onmouseover="this.style.background='rgba(212, 175, 55, 0.25)'" 
                       onmouseout="this.style.background='${isSelected ? 'rgba(212, 175, 55, 0.3)' : 'rgba(212, 175, 55, 0.1)'}'">
                        
                        <!-- 选择框 -->
                        <input type="checkbox" 
                               ${isSelected ? 'checked' : ''} 
                               onchange="toggleSalonSelection(${salon.id})"
                               style="margin-right: 15px; width: 18px; height: 18px; cursor: pointer; accent-color: var(--gold);">
                        
                        <!-- 沙龙信息 - 水平并排显示 -->
                        <div style="flex: 1; display: flex; align-items: center; gap: 15px; font-size: 0.85em;">
                            <div style="color: var(--gold); font-weight: bold; min-width: 120px; max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    ${salon.name}
                            </div>
                            <div style="color: #cccccc; min-width: 80px; max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                ${salon.directorName || '未设置'}
                            </div>
                            <div style="color: #cccccc; min-width: 100px; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                ${salon.directorMobile || '无手机号'}
                        </div>
                            <div style="color: #aaa; flex: 1; min-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                ${salon.address || '无地址信息'}
                            </div>
                            <div style="color: #87CEEB; min-width: 60px; max-width: 60px; text-align: center;">
                                ${districtName}
                            </div>
                            <div style="color: #90EE90; font-weight: bold; min-width: 70px; max-width: 70px; text-align: center;">
                                ${responsibleEmployeeName}
                            </div>
                            <div style="color: #aaa; font-size: 0.8em; min-width: 80px; max-width: 80px; text-align: center;">
                                ${salon.addTime ? new Date(salon.addTime).toLocaleDateString() : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            listContainer.innerHTML = html;
            
            console.log('=== 沙龙列表显示完成 ===');
            
            // 更新翻译
            updateTexts();
        }
        
        // 切换单个沙龙的选择状态
        function toggleSalonSelection(salonId) {
            if (deleteSelectedSalonIds.has(salonId)) {
                deleteSelectedSalonIds.delete(salonId);
            } else {
                deleteSelectedSalonIds.add(salonId);
            }
            updateDeleteStatistics();
            displayDeleteSalonList(deleteCurrentPage); // 刷新显示
        }
        
        // 全选筛选结果（智能全选）
        function selectAllFilteredSalons() {
            console.log('正在选择筛选结果中的所有沙龙...');
            console.log('筛选结果总数:', deleteFilteredSalons.length);
            
            // 选择当前筛选结果中的所有沙龙
            deleteFilteredSalons.forEach(salon => {
                deleteSelectedSalonIds.add(salon.id);
            });
            
            console.log('已选择沙龙数量:', deleteSelectedSalonIds.size);
            updateDeleteStatistics();
            displayDeleteSalonList(deleteCurrentPage);
        }
        
        // 全选所有沙龙（不受筛选限制）
        function selectAllSalonsGlobal() {
            console.log('正在选择系统中的所有沙龙...');
            const allSalons = getSalons();
            console.log('系统总沙龙数:', allSalons.length);
            
            // 选择系统中的所有沙龙
            allSalons.forEach(salon => {
                deleteSelectedSalonIds.add(salon.id);
            });
            
            console.log('已选择沙龙数量:', deleteSelectedSalonIds.size);
            updateDeleteStatistics();
            displayDeleteSalonList(deleteCurrentPage);
        }
        
        // 取消全选
        function deselectAllSalonsForDelete() {
            console.log('正在取消所有选择...');
            deleteSelectedSalonIds.clear();
            updateDeleteStatistics();
            displayDeleteSalonList(deleteCurrentPage);
        }
        
        // 清空筛选条件
        function clearDeleteFilters() {
            console.log('=== 清空筛选条件 ===');
            
            // 重置输入框
            const searchInput = document.getElementById('deleteSalonSearchInput');
            const responsibleFilter = document.getElementById('deleteResponsibleFilter');
            const districtFilter = document.getElementById('deleteDistrictFilter');
            
            if (searchInput) {
                searchInput.value = '';
                console.log('已清空搜索框');
            }
            if (responsibleFilter) {
                responsibleFilter.selectedIndex = 0;
                console.log('已重置负责人筛选');
            }
            if (districtFilter) {
                districtFilter.selectedIndex = 0;
                console.log('已重置区域筛选');
            }
            
            // 重新获取所有沙龙并显示
            const allSalons = getSalons();
            deleteFilteredSalons = [...allSalons];
            deleteCurrentPage = 1;
            
            console.log('重新加载所有沙龙，共', deleteFilteredSalons.length, '个');
            
            // 清空选择状态
            deleteSelectedSalonIds.clear();
            
            // 显示列表
            displayDeleteSalonList(1);
            
            console.log('筛选条件已清空，显示', deleteFilteredSalons.length, '个沙龙');
        }
        
        // 更新删除页面统计信息
        function updateDeleteStatistics(totalSalons = null, filteredCount = null) {
            const allSalons = getSalons();
            const total = totalSalons !== null ? totalSalons : allSalons.length;
            const filtered = filteredCount !== null ? filteredCount : deleteFilteredSalons.length;
            const selected = deleteSelectedSalonIds.size;
            
            // 更新各个统计元素
            const totalElement = document.getElementById('delete-total-salons');
            const filteredElement = document.getElementById('delete-filtered-salons');
            const selectedElement = document.getElementById('delete-selected-salons');
            const selectedCountElement = document.getElementById('delete-selected-count');
            const statisticsElement = document.getElementById('delete-salon-statistics');
            
            if (totalElement) {
                totalElement.textContent = `총 살롱 수: ${total}`;
            }
            
            if (filteredElement) {
                filteredElement.textContent = `필터 결과: ${filtered}`;
            }
            
            if (selectedElement) {
                selectedElement.textContent = `선택됨: ${selected}`;
            }
            
            if (selectedCountElement) {
                selectedCountElement.textContent = `${selected} 개 살롱 선택됨`;
            }
            
            if (statisticsElement) {
                statisticsElement.textContent = `필터 결과: ${filtered} 개 살롱 표시`;
            }
        }
        
        // 更新删除页面分页信息
        function updateDeletePaginationInfo(currentPage, totalPages, totalItems) {
            const pageInfo = document.getElementById('delete-page-info');
            const firstPageBtn = document.getElementById('delete-first-page');
            const prevPageBtn = document.getElementById('delete-prev-page');
            const nextPageBtn = document.getElementById('delete-next-page');
            const lastPageBtn = document.getElementById('delete-last-page');
            const jumpInput = document.getElementById('delete-page-jump-input');
            
            if (pageInfo) {
                pageInfo.textContent = `${currentPage} 페이지 / 총 ${totalPages} 페이지 (${totalItems} 개 항목)`;
            }
            
            if (jumpInput) {
                jumpInput.max = totalPages;
                jumpInput.placeholder = totalPages > 0 ? `1-${totalPages}` : '1';
            }
            
            // 更新按钮状态
            const updateButtonState = (btn, disabled) => {
                if (btn) {
                    btn.disabled = disabled;
                    btn.style.opacity = disabled ? '0.5' : '1';
                    btn.style.cursor = disabled ? 'not-allowed' : 'pointer';
                }
            };
            
            updateButtonState(firstPageBtn, currentPage === 1);
            updateButtonState(prevPageBtn, currentPage === 1);
            updateButtonState(nextPageBtn, currentPage === totalPages);
            updateButtonState(lastPageBtn, currentPage === totalPages);
        }
        
        // 删除页面分页函数
        function goToDeletePage(page) {
            displayDeleteSalonList(page);
        }
        
        function goToPrevDeletePage() {
            if (deleteCurrentPage > 1) {
                displayDeleteSalonList(deleteCurrentPage - 1);
            }
        }
        
        function goToNextDeletePage() {
            const totalPages = Math.ceil(deleteFilteredSalons.length / deleteItemsPerPage);
            if (deleteCurrentPage < totalPages) {
                displayDeleteSalonList(deleteCurrentPage + 1);
            }
        }
        
        function goToLastDeletePage() {
            const totalPages = Math.ceil(deleteFilteredSalons.length / deleteItemsPerPage);
            displayDeleteSalonList(totalPages);
        }
        
        function changeDeleteItemsPerPage() {
            const select = document.getElementById('delete-items-per-page');
            deleteItemsPerPage = parseInt(select.value);
            displayDeleteSalonList(1); // 重置到第一页
        }
        
        function jumpToDeletePage() {
            const input = document.getElementById('delete-page-jump-input');
            const pageNumber = parseInt(input.value);
            
            if (!pageNumber || pageNumber < 1) {
                alert('유효한 페이지 번호를 입력하세요');
                return;
            }
            
            const totalPages = Math.ceil(deleteFilteredSalons.length / deleteItemsPerPage);
            
            if (pageNumber > totalPages) {
                alert(`페이지 번호는 총 페이지 수 ${totalPages}를 초과할 수 없습니다`);
                return;
            }
            
            displayDeleteSalonList(pageNumber);
            input.value = ''; // 清空输入框
        }
        
        function handleDeletePageJumpKeypress(event) {
            if (event.key === 'Enter') {
                jumpToDeletePage();
            }
        }
        
        // 删除选中的沙龙（高级版本）
        function deleteSelectedSalonsAdvanced() {
            if (deleteSelectedSalonIds.size === 0) {
                alert('삭제할 살롱을 선택하세요');
                return;
            }
            
            const selectedCount = deleteSelectedSalonIds.size;
            const confirmMessage = `${selectedCount} 개의 선택된 살롱을 삭제하시겠습니까? 이 작업은 취소할 수 없습니다!`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const salons = getSalons();
            const updatedSalons = salons.filter(salon => !deleteSelectedSalonIds.has(salon.id));
            
            saveSalons(updatedSalons);
            
            // 清空选择
            deleteSelectedSalonIds.clear();
            
            // 刷新筛选和显示
            filterSalonsForDelete();
            
            alert(`${selectedCount} 개의 살롱이 성공적으로 삭제되었습니다`);
        }
        
        // 删除所有筛选结果
        function deleteAllFilteredSalons() {
            if (deleteFilteredSalons.length === 0) {
                alert('삭제할 필터 결과가 없습니다');
                return;
            }
            
            const filteredCount = deleteFilteredSalons.length;
            const confirmMessage = `현재 필터링된 ${filteredCount} 개의 살롱을 모두 삭제하시겠습니까? 이 작업은 취소할 수 없습니다!`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const salons = getSalons();
            const filteredIds = new Set(deleteFilteredSalons.map(salon => salon.id));
            const updatedSalons = salons.filter(salon => !filteredIds.has(salon.id));
            
            saveSalons(updatedSalons);
            
            // 清空选择和筛选
            deleteSelectedSalonIds.clear();
            clearDeleteFilters();
            
            alert(`${filteredCount} 개의 살롱이 성공적으로 삭제되었습니다`);
        }
        
        // 删除全部沙龙（危险操作）
        function deleteAllSalonsConfirm() {
            const allSalons = getSalons();
            const totalCount = allSalons.length;
            
            if (totalCount === 0) {
                alert('삭제할 살롱이 없습니다');
                return;
            }
            
            const firstConfirm = confirm(`경고: 이 작업은 시스템에서 모든 ${totalCount} 개의 살롱을 삭제합니다!\n\n계속하시겠습니까?`);
            if (!firstConfirm) return;
            
            const secondConfirm = confirm(`다시 확인: 정말로 모든 ${totalCount} 개의 살롱을 삭제하시겠습니까?\n\n이 작업은 취소할 수 없습니다!`);
            if (!secondConfirm) return;
            
            saveSalons([]);
            
            // 清空选择和筛选
            deleteSelectedSalonIds.clear();
            clearDeleteFilters();
            
            alert(`모든 ${totalCount} 개의 살롱이 삭제되었습니다`);
        }
        
        // 添加调试日志以便排查问题
        console.log('删除沙龙页面功能已重新设计完成');
        
        // ========================================
        // 产品管理相关功能
        // ========================================
        
        // 产品数据存储和管理
        let productsData = [];
        let productCategoriesData = [];
        
        // 初始化产品数据
        function initializeProductData() {
            // 加载产品分类数据
            const savedCategories = localStorage.getItem('productCategories');
            if (savedCategories) {
                productCategoriesData = JSON.parse(savedCategories);
            } else {
                // 创建默认分类
                productCategoriesData = [
                    {
                        id: 1,
                        nameCN: '未分类',
                        nameKO: '미분류',
                        code: 'uncategorized',
                        description: '未分类的产品',
                        parentId: null,
                        sortOrder: 0,
                        active: true,
                        createdAt: new Date().toISOString()
                    }
                ];
                saveProductCategories();
            }
            
            // 加载产品数据
            const savedProducts = localStorage.getItem('products');
            if (savedProducts) {
                productsData = JSON.parse(savedProducts);
            } else {
                productsData = [];
            }
            
            console.log('产品管理系统初始化完成：', productsData.length, '个产品，', productCategoriesData.length, '个分类');
        }
        
        // 保存产品数据
        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(productsData));
        }
        
        // 保存产品分类数据
        function saveProductCategories() {
            localStorage.setItem('productCategories', JSON.stringify(productCategoriesData));
        }
        
        // 加载产品分类到下拉选择框
        function loadProductCategories() {
            const categorySelect = document.getElementById('productCategory');
            if (!categorySelect) return;
            
            categorySelect.innerHTML = '<option value="" data-i18n="please-select-category">请选择产品分类...</option>';
            
            const categories = productCategoriesData.filter(cat => cat.active);
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.code;
                option.textContent = category.nameCN;
                categorySelect.appendChild(option);
            });
            
            updateTexts();
        }
        
        // 更新单位示例
        function updateUnitExample() {
            const unitType = document.getElementById('unitType').value;
            const perBoxUnit = document.getElementById('perBoxUnit');
            if (perBoxUnit) {
                perBoxUnit.textContent = unitType;
            }
            calculateTotalWeight();
        }
        
        // 计算总重量
        function calculateTotalWeight() {
            const weightVolume = parseFloat(document.getElementById('weightVolume').value) || 0;
            const weightUnit = document.getElementById('weightUnit').value;
            const perBoxCount = parseInt(document.getElementById('perBoxCount').value) || 1;
            const perCaseCount = parseInt(document.getElementById('perCaseCount').value) || 1;
            const unitType = document.getElementById('unitType').value;
            
            const totalUnitsPerCase = perBoxCount * perCaseCount;
            const totalWeightPerCase = weightVolume * totalUnitsPerCase;
            
            let displayUnit = weightUnit;
            let displayWeight = totalWeightPerCase;
            
            // 单位转换
            if (weightUnit === 'g' && totalWeightPerCase >= 1000) {
                displayWeight = totalWeightPerCase / 1000;
                displayUnit = 'kg';
            } else if (weightUnit === 'ml' && totalWeightPerCase >= 1000) {
                displayWeight = totalWeightPerCase / 1000;
                displayUnit = 'L';
            }
            
            const summaryElement = document.getElementById('specificationSummary');
            if (summaryElement) {
                const currentLanguage = localStorage.getItem('language') || 'zh';
                if (currentLanguage === 'ko') {
                    summaryElement.textContent = `${unitType}당 ${weightVolume}${weightUnit}, 박스당 ${perBoxCount}${unitType}, 케이스당 ${perCaseCount}박스, 케이스 총 중량 ${displayWeight.toFixed(1)}${displayUnit}`;
                } else {
                    summaryElement.textContent = `每${unitType} ${weightVolume}${weightUnit}，每盒 ${perBoxCount}${unitType}，每箱 ${perCaseCount}盒，每箱总重量 ${displayWeight.toFixed(1)}${displayUnit}`;
                }
            }
        }
        
        // 格式化韩元价格
        function formatKoreanPrice(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString('ko-KR');
            }
            input.value = value;
        }
        
        // 重置产品表单
        function resetProductForm() {
            const form = document.getElementById('addProductForm');
            if (form) {
                form.reset();
                setTimeout(calculateTotalWeight, 100);
            }
        }
        
        // 显示产品列表（左右分栏布局）
        function displayProductList() {
            console.log('正在显示产品列表...');
            
            // 确保产品数据已初始化
            if (!productCategoriesData || productCategoriesData.length === 0) {
                initializeProductData();
            }
            
            const container = document.getElementById('product-list-content');
            
            if (!container) {
                console.error('产品列表容器未找到');
                return;
            }
            
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            console.log('加载的产品数量:', products.length);
            
            // 更新产品计数
            const countElement = document.getElementById('product-count-text');
            if (countElement) {
                const currentLanguage = localStorage.getItem('language') || 'zh';
                if (currentLanguage === 'ko') {
                    countElement.textContent = `총 ${products.length}개 제품`;
                } else {
                    countElement.textContent = `总计 ${products.length} 个产品`;
                }
            }
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #cccccc; padding: 40px;">
                        <p data-i18n="no-products">暂无产品数据</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">
                            <span data-i18n="add-product-tip">点击</span>
                            <a href="#" onclick="showContent('add-product')" style="color: var(--gold); text-decoration: underline;">新增产品</a>
                            <span data-i18n="add-first-product">来添加第一个产品</span>
                        </p>
                    </div>
                `;
                updateTexts();
                return;
            }
            
            // 生成左侧产品列表
            let leftHtml = '';
            products.forEach(product => {
                const currentLanguage = localStorage.getItem('language') || 'zh';
                const statusText = product.isOnSale ? 
                    (currentLanguage === 'ko' ? '판매중' : '在售') : 
                    (currentLanguage === 'ko' ? '단종' : '停产');
                
                leftHtml += `
                    <div onclick="showProductDetail(${product.id})" style="
                        display: flex; 
                        justify-content: space-between; 
                        align-items: center; 
                        padding: 12px 15px; 
                        background: rgba(212, 175, 55, 0.1); 
                        border-radius: 5px; 
                        border: 1px solid rgba(212, 175, 55, 0.3);
                        cursor: pointer;
                        transition: all 0.3s ease;
                        margin-bottom: 6px;
                    " 
                    onmouseover="this.style.backgroundColor='rgba(212, 175, 55, 0.2)'" 
                    onmouseout="this.style.backgroundColor='rgba(212, 175, 55, 0.1)'">
                        <!-- 左侧：产品名 -->
                        <div style="flex: 1; color: var(--gold); font-weight: bold; font-size: 0.9em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 10px;">
                            ${product.name || '未命名产品'}
                        </div>
                        <!-- 右侧：状态 -->
                        <div style="color: ${product.isOnSale ? '#4CAF50' : '#f44336'}; font-size: 0.8em; font-weight: bold;">
                            ${statusText}
                        </div>
                    </div>
                `;
            });
            
            // 构建完整的HTML结构
            container.innerHTML = leftHtml;
            updateTexts();
        }
        
        // 显示产品详情
        function showProductDetail(productId) {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                console.error('Product not found:', productId);
                return;
            }
            
            const productDetailRight = document.getElementById('product-detail-right');
            const productDetailContent = document.getElementById('product-detail-content');
            
            if (!productDetailRight || !productDetailContent) {
                console.error('Product detail elements not found');
                return;
            }
            
            // 显示右侧详情面板
            productDetailRight.style.display = 'flex';
            
            // 获取当前语言
            const currentLanguage = localStorage.getItem('language') || 'zh';
            
            // 获取产品分类名称
            let categoryName = '';
            if (product.category) {
                const categories = JSON.parse(localStorage.getItem('productCategories') || '[]');
                const category = categories.find(c => c.code === product.category);
                if (category) {
                    categoryName = currentLanguage === 'ko' ? category.nameKO : category.nameCN;
                }
            }
            
            // 格式化价格
            const formatPrice = (price) => {
                if (!price) return '0 ₩';
                const numPrice = parseInt(price.toString().replace(/[^\d]/g, ''));
                return numPrice.toLocaleString('ko-KR') + ' ₩';
            };
            
            // 状态文本
            const statusText = product.isOnSale ? 
                (currentLanguage === 'ko' ? '판매중' : '在售') : 
                (currentLanguage === 'ko' ? '단종' : '停产');
            const statusColor = product.isOnSale ? '#4CAF50' : '#f44336';
            
            // 生成详情内容
            const detailHtml = `
                <div style="width: 100%; line-height: 1.6;">
                    <!-- 基本信息 -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="basic-info">基本信息</h4>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="product-name">产品名称：</span>
                                <span style="color: var(--text-light); font-weight: bold; font-size: 1em; line-height: 1.4;">${product.name || '未命名产品'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="brand-name">品牌名称：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.brandName || '-'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="product-model">型号：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.model || '-'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="product-sku">货号：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.sku || '-'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="product-category">产品分类：</span>
                                <span style="color: var(--gold); line-height: 1.4;">${categoryName || (currentLanguage === 'ko' ? '미분류' : '未分类')}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="status">状态：</span>
                                <span style="color: ${statusColor}; font-weight: bold; line-height: 1.4;">${statusText}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 规格信息 -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="product-specifications">规格信息</h4>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="unit-type">数量单位：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.unitType || '-'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="weight-volume">重量/体积：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.weightVolume || 0}${product.weightUnit || 'g'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="per-box-count">每盒数量：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.perBoxCount || 1}${product.unitType || '个'}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="per-case-count">箱规：</span>
                                <span style="color: var(--text-light); line-height: 1.4;">${product.perCaseCount || 1}盒</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 价格信息 -->
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="price-info">价格信息</h4>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="purchase-price">进货价：</span>
                                <span style="color: var(--gold); font-weight: bold; line-height: 1.4;">${formatPrice(product.purchasePrice)}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="wholesale-price">批发价：</span>
                                <span style="color: var(--gold); font-weight: bold; line-height: 1.4;">${formatPrice(product.wholesalePrice)}</span>
                            </div>
                            <div style="display: flex; align-items: flex-start; padding: 4px 0;">
                                <span style="color: #cccccc; width: 100px; font-size: 0.9em; line-height: 1.4; flex-shrink: 0;" data-i18n="retail-price">零售价：</span>
                                <span style="color: var(--gold); font-weight: bold; line-height: 1.4;">${formatPrice(product.retailPrice)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 备注信息 -->
                    ${product.notes ? `
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: var(--gold); margin-bottom: 15px; border-bottom: 1px solid rgba(212, 175, 55, 0.3); padding-bottom: 8px; font-size: 1.1em;" data-i18n="notes">备注</h4>
                            <div style="background: rgba(24,24,24,0.3); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 5px; padding: 12px; color: var(--text-light); font-size: 0.9em; line-height: 1.4;">
                                ${product.notes}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            productDetailContent.innerHTML = detailHtml;
            
            // 在标题行添加编辑和删除按钮
            const actionButtons = document.getElementById('product-action-buttons');
            if (actionButtons) {
                actionButtons.innerHTML = `
                    <button onclick="editProduct(${product.id})" style="background: var(--gold); color: var(--black); border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em; margin-right: 10px;" data-i18n="edit-btn">编辑</button>
                    <button onclick="deleteProduct(${product.id})" style="background: #f44336; color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 0.9em;" data-i18n="delete">删除</button>
                `;
            }
            
            // 更新翻译文本
            updateTexts();
        }
        
        // 显示产品分类
        function displayProductCategories() {
            console.log('正在加载产品分类列表...');
            loadProductCategoriesList();
        }
        
        console.log('产品管理基础功能模块加载完成');
        
        // ========================================
        // 产品分类页面弹窗控制函数
        // ========================================
        
        // 打开新建分类弹窗
        function openCreateCategoryModal() {
            const modal = document.getElementById('createCategoryModal');
            if (modal) {
                modal.style.display = 'flex';
                // 清空表单
                const form = document.getElementById('createCategoryForm');
                if (form) {
                    form.reset();
                }
            }
        }
        
        // 关闭新建分类弹窗
        function closeCreateCategoryModal() {
            const modal = document.getElementById('createCategoryModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // 提交新建分类
        function submitCreateCategory() {
            const categoryNameCN = document.getElementById('categoryNameCN').value.trim();
            const categoryNameKO = document.getElementById('categoryNameKO').value.trim();
            const categoryDescription = document.getElementById('categoryDescription').value.trim();
            
            if (!categoryNameCN || !categoryNameKO) {
                const currentLanguage = localStorage.getItem('language') || 'zh';
                const message = currentLanguage === 'ko' ? '모든 필수 필드를 입력하세요' : '请填写所有必填字段';
                alert(message);
                return;
            }
            
            // 自动生成分类代码
            function generateCategoryCode() {
                const timestamp = Date.now().toString(36);
                const random = Math.random().toString(36).substr(2, 5);
                return `cat_${timestamp}_${random}`;
            }
            
            const categoryCode = generateCategoryCode();
            
            // 创建新分类
            const newCategory = {
                id: Date.now(),
                nameCN: categoryNameCN,
                nameKO: categoryNameKO,
                code: categoryCode,
                description: categoryDescription,
                parentId: null,
                sortOrder: productCategoriesData.length,
                active: true,
                createdAt: new Date().toISOString()
            };
            
            productCategoriesData.push(newCategory);
            saveProductCategories();
            
            // 刷新分类列表显示
            loadProductCategoriesList();
            
            // 关闭弹窗
            closeCreateCategoryModal();
            
            const currentLanguage = localStorage.getItem('language') || 'zh';
            const successMessage = currentLanguage === 'ko' ? '분류가 성공적으로 생성되었습니다!' : '分类创建成功！';
            alert(successMessage);
        }
        
        // 加载产品分类列表
        function loadProductCategoriesList() {
            const container = document.getElementById('categoryList');
            if (!container) {
                console.error('产品分类容器未找到 (categoryList)');
                return;
            }
            
            // 直接从localStorage读取分类数据，确保数据是最新的
            const categories = JSON.parse(localStorage.getItem('productCategories') || '[]');
            console.log('正在加载产品分类列表，分类数量:', categories.length);
            
            if (categories.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #cccccc; padding: 40px;">
                        <p data-i18n="no-categories">暂无产品分类</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">
                            <span data-i18n="add-category-tip">点击</span>
                            <span style="color: var(--gold);">"创建产品分类"</span>
                            <span data-i18n="add-first-category">按钮来添加第一个分类</span>
                        </p>
                    </div>
                `;
                updateTexts();
                return;
            }
            
            const currentLanguage = localStorage.getItem('language') || 'zh';
            let html = '';
            categories.forEach(category => {
                // 根据语言显示分类名称
                const categoryName = currentLanguage === 'ko' ? 
                    (category.nameKO || '이름 없는 분류') :
                    (category.nameCN || '未命名分类');
                
                // 根据语言显示创建时间标签
                const createdTimeLabel = currentLanguage === 'ko' ? '생성 시간' : '创建时间';
                
                // 根据语言显示描述标签
                const descriptionLabel = currentLanguage === 'ko' ? '설명' : '描述';
                
                html += `
                    <div style="
                        padding: 15px;
                        margin-bottom: 15px;
                        background: rgba(212, 175, 55, 0.1);
                        border: 1px solid rgba(212, 175, 55, 0.3);
                        border-radius: 8px;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.background='rgba(212, 175, 55, 0.15)'" onmouseout="this.style.background='rgba(212, 175, 55, 0.1)'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: ${category.description ? '15px' : '0'};">
                            <div style="flex: 1;">
                                <h3 style="color: var(--gold); margin: 0; font-size: 1.1em;">${categoryName}</h3>
                                <p style="color: #cccccc; margin: 5px 0 0 0; font-size: 0.9em;"><strong>${createdTimeLabel}：</strong>${category.createdAt ? new Date(category.createdAt).toLocaleDateString() : '-'}</p>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button onclick="editProductCategory(${category.id})" style="background: var(--gold); color: var(--black); border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em;" data-i18n="edit-btn">编辑</button>
                                <button onclick="deleteProductCategory(${category.id}, '${categoryName}')" style="background: #f44336; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em;" data-i18n="delete">删除</button>
                            </div>
                        </div>
                        ${category.description ? `
                            <div style="padding-top: 10px; border-top: 1px solid rgba(212, 175, 55, 0.2);">
                                <strong style="color: #FFB6C1;">${descriptionLabel}：</strong>
                                <span style="color: #cccccc; font-size: 0.9em;">${category.description}</span>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updateTexts();
        }
        
        console.log('产品分类弹窗控制函数加载完成');
        
        // ========================================
        // 缺失的产品管理函数
        // ========================================
        
        // 编辑产品函数
        function editProduct(productId) {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                alert('产品不存在');
                return;
            }
            
            // 这里可以实现产品编辑的逻辑
            alert(`编辑产品功能正在开发中\n产品ID: ${productId}\n产品名称: ${product.name}`);
        }
        
        // 删除产品函数
        function deleteProduct(productId) {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const product = products.find(p => p.id === productId);
            
            if (!product) {
                alert('产品不存在');
                return;
            }
            
            const currentLanguage = localStorage.getItem('language') || 'zh';
            const confirmMessage = currentLanguage === 'ko' ? 
                `제품 "${product.name}"을(를) 삭제하시겠습니까? 이 작업은 취소할 수 없습니다!` :
                `确定要删除产品 "${product.name}" 吗？此操作不可撤销！`;
            
            if (confirm(confirmMessage)) {
                const updatedProducts = products.filter(p => p.id !== productId);
                localStorage.setItem('products', JSON.stringify(updatedProducts));
                
                // 隐藏右侧详情面板
                const productDetailRight = document.getElementById('product-detail-right');
                if (productDetailRight) {
                    productDetailRight.style.display = 'none';
                }
                
                // 重新加载产品列表
                displayProductList();
                
                const successMessage = currentLanguage === 'ko' ? '제품이 성공적으로 삭제되었습니다.' : '产品删除成功！';
                alert(successMessage);
            }
        }
        
        // 编辑产品分类函数
        function editProductCategory(categoryId) {
            const categories = JSON.parse(localStorage.getItem('productCategories') || '[]');
            const category = categories.find(c => c.id === categoryId);
            
            if (!category) {
                alert('分类不存在');
                return;
            }
            
            // 这里可以实现分类编辑的逻辑
            alert(`编辑分类功能正在开发中\n分类ID: ${categoryId}\n分类名称: ${category.nameCN}`);
        }
        
        // 删除产品分类函数
        function deleteProductCategory(categoryId, categoryName) {
            const categories = JSON.parse(localStorage.getItem('productCategories') || '[]');
            const category = categories.find(c => c.id === categoryId);
            
            if (!category) {
                alert('分类不存在');
                return;
            }
            
            // 检查是否有产品使用了这个分类
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const productsUsingCategory = products.filter(p => p.category === category.code);
            
            if (productsUsingCategory.length > 0) {
                const currentLanguage = localStorage.getItem('language') || 'zh';
                const message = currentLanguage === 'ko' ? 
                    `이 분류를 사용하는 ${productsUsingCategory.length}개의 제품이 있습니다. 분류를 삭제할 수 없습니다.` :
                    `还有 ${productsUsingCategory.length} 个产品正在使用此分类，无法删除！`;
                alert(message);
                return;
            }
            
            const currentLanguage = localStorage.getItem('language') || 'zh';
            const confirmMessage = currentLanguage === 'ko' ? 
                `분류 "${categoryName}"을(를) 삭제하시겠습니까? 이 작업은 취소할 수 없습니다!` :
                `确定要删除分类 "${categoryName}" 吗？此操作不可撤销！`;
            
            if (confirm(confirmMessage)) {
                const updatedCategories = categories.filter(c => c.id !== categoryId);
                localStorage.setItem('productCategories', JSON.stringify(updatedCategories));
                
                // 重新加载分类列表
                loadProductCategoriesList();
                
                const successMessage = currentLanguage === 'ko' ? '분류가 성공적으로 삭제되었습니다.' : '分类删除成功！';
                alert(successMessage);
            }
        }
        
        // 删除区域
        function deleteDistrict(districtCode, districtName, salonCount) {
            const currentLanguage = localStorage.getItem('language') || 'zh';
            
            let confirmMessage = getText('confirm-delete-district') + '\n' + getText('delete-district-warning');
            if (salonCount > 0) {
                const salonWarning = currentLanguage === 'ko' ? 
                    `\n\n경고: 이 지역에는 ${salonCount}개의 살롱이 있습니다.` :
                    `\n\n警告：此区域下有 ${salonCount} 个沙龙。`;
                confirmMessage += salonWarning;
            }
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const districts = getDistricts();
            const updatedDistricts = districts.filter(d => d.code !== districtCode);
            
            // 更新所有使用该区域的沙龙为"其他地区"
            if (salonCount > 0) {
                const salons = getSalons();
                const updatedSalons = salons.map(salon => {
                    if (salon.district === districtCode) {
                        return { ...salon, district: 'others' };
                    }
                    return salon;
                });
                localStorage.setItem('salons', JSON.stringify(updatedSalons));
            }
            
            saveDistricts(updatedDistricts);
            loadDistrictList();
            
            alert(getText('district-deleted-success'));
        }
        
        // 关闭区域对话框
        function closeDistrictDialog() {
            const dialog = document.getElementById('district-dialog');
            if (dialog) {
                dialog.style.display = 'none';
            }
        }
        
        // 保存区域
        function saveDistrict(event) {
            event.preventDefault();
            
            const code = document.getElementById('districtCode').value.trim();
            const nameCn = document.getElementById('districtNameCn').value.trim();
            const nameKr = document.getElementById('districtNameKr').value.trim();
            const keywordsText = document.getElementById('districtKeywords').value.trim();
            
            if (!code || !nameCn || !nameKr) {
                alert('请填写所有必填字段');
                return;
            }
            
            // 解析关键词
            const keywords = keywordsText ? keywordsText.split(',').map(k => k.trim()).filter(k => k) : [];
            
            const districts = getDistricts();
            const isEditing = document.getElementById('districtCode').hasAttribute('readonly');
            
            // 检查代码是否已存在（新增时）
            if (!isEditing && districts.find(d => d.code === code)) {
                alert(getText('district-code-exists'));
                return;
            }
            
            const newDistrict = {
                code: code,
                nameCn: nameCn,
                nameKr: nameKr,
                keywords: keywords
            };
            
            let updatedDistricts;
            if (isEditing) {
                // 编辑模式
                updatedDistricts = districts.map(d => d.code === code ? newDistrict : d);
                alert(getText('district-updated-success'));
            } else {
                // 新增模式
                updatedDistricts = [...districts, newDistrict];
                alert(getText('district-added-success'));
            }
            
            saveDistricts(updatedDistricts);
            loadDistrictList();
            closeDistrictDialog();
        }
        
        // 重置为默认区域
        function resetToDefaultDistricts() {
            const currentLanguage = localStorage.getItem('language') || 'zh';
            const confirmMessage = currentLanguage === 'ko' ? 
                '모든 사용자 정의 지역을 삭제하고 기본 지역으로 재설정하시겠습니까?' :
                '确定要删除所有自定义区域并重置为默认区域吗？';
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            localStorage.removeItem('customDistricts');
            getDistricts(); // 这会重新保存默认区域
            loadDistrictList();
            
            const successMessage = currentLanguage === 'ko' ? 
                '기본 지역으로 성공적으로 재설정되었습니다.' :
                '已成功重置为默认区域';
            alert(successMessage);
        }
        
        // 导出区域配置
        function exportDistrictConfig() {
            const districts = getDistricts();
            const configData = {
                version: '1.0',
                exportTime: new Date().toISOString(),
                districts: districts
            };
            
            const dataStr = JSON.stringify(configData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `district-config-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
        }
        
        // 导入区域配置
        function importDistrictConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const configData = JSON.parse(e.target.result);
                        
                        if (!configData.districts || !Array.isArray(configData.districts)) {
                            throw new Error('Invalid configuration format');
                        }
                        
                        // 验证每个区域的数据结构
                        for (const district of configData.districts) {
                            if (!district.code || !district.nameCn || !district.nameKr) {
                                throw new Error('Missing required fields in district data');
                            }
                        }
                        
                        const currentLanguage = localStorage.getItem('language') || 'zh';
                        const confirmMessage = currentLanguage === 'ko' ? 
                            `${configData.districts.length}개의 지역을 가져오시겠습니까? 기존 지역이 대체됩니다.` :
                            `确定要导入 ${configData.districts.length} 个区域吗？这将替换现有区域。`;
                        
                        if (confirm(confirmMessage)) {
                            saveDistricts(configData.districts);
                            loadDistrictList();
                            alert(getText('config-imported-success'));
                        }
                        
                    } catch (error) {
                        console.error('导入配置失败:', error);
                        alert(getText('invalid-district-config'));
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ==================== 移动端优化功能 ====================
        
        // 移动端优化初始化
        function initMobileOptimization() {
            // 检测是否为移动设备
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                console.log('检测到移动设备，启用移动端优化');
                
                // 禁用双击缩放
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(event) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
                
                // 处理软键盘弹出时的界面调整
                let originalViewportHeight = window.innerHeight;
                
                window.addEventListener('resize', function() {
                    const currentViewportHeight = window.innerHeight;
                    const sidebar = document.querySelector('.sidebar');
                    const mainContent = document.querySelector('.main-content');
                    
                    if (currentViewportHeight < originalViewportHeight * 0.75) {
                        // 软键盘弹出时
                        if (sidebar && sidebar.classList.contains('active')) {
                            toggleMobileMenu(); // 关闭侧边栏
                        }
                    }
                });
                
                // 处理输入框焦点，防止页面跳动
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.addEventListener('focus', function() {
                        setTimeout(() => {
                            this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 300);
                    });
                    
                    // 移动端输入框失焦时收起键盘
                    input.addEventListener('blur', function() {
                        setTimeout(() => {
                            window.scrollTo(0, 0);
                        }, 100);
                    });
                });
                
                // 优化触摸反馈
                document.addEventListener('touchstart', function() {}, { passive: true });
                
                // 处理屏幕旋转
                window.addEventListener('orientationchange', function() {
                    setTimeout(() => {
                        originalViewportHeight = window.innerHeight;
                        
                        // 如果侧边栏是打开的，重新调整
                        const sidebar = document.querySelector('.sidebar');
                        if (sidebar && sidebar.classList.contains('active')) {
                            sidebar.style.height = window.innerHeight + 'px';
                        }
                        
                        // 重新初始化粒子效果（如果存在）
                        if (window.tsParticles) {
                            window.tsParticles.load('tsparticles', {
                                particles: {
                                    number: { value: window.innerWidth < 768 ? 50 : 100 },
                                    color: { value: '#D4AF37' },
                                    shape: { type: 'circle' },
                                    opacity: { value: window.innerWidth < 768 ? 0.3 : 0.5 },
                                    size: { value: { min: 1, max: 3 } },
                                    move: {
                                        enable: true,
                                        speed: 1,
                                        direction: 'none',
                                        random: true,
                                        straight: false,
                                        out_mode: 'out',
                                        bounce: false,
                                    }
                                },
                                interactivity: {
                                    detect_on: 'canvas',
                                    events: {
                                        onhover: { enable: !isMobile, mode: 'repulse' },
                                        onclick: { enable: true, mode: 'push' },
                                        resize: true
                                    },
                                    modes: {
                                        repulse: { distance: 100, duration: 0.4 },
                                        push: { particles_nb: 4 }
                                    }
                                },
                                retina_detect: true
                            });
                        }
                    }, 500);
                });
                
                // 优化侧边栏在移动端的行为
                const sidebar = document.querySelector('.sidebar');
                if (sidebar) {
                    // 添加遮罩层
                    const overlay = document.createElement('div');
                    overlay.className = 'mobile-overlay';
                    overlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.5);
                        z-index: 999;
                        display: none;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    `;
                    
                    overlay.addEventListener('click', function() {
                        toggleMobileMenu();
                    });
                    
                    document.body.appendChild(overlay);
                    
                    // 修改toggleMobileMenu函数以支持遮罩层
                    const originalToggleMobileMenu = window.toggleMobileMenu;
                    window.toggleMobileMenu = function() {
                        const sidebar = document.querySelector('.sidebar');
                        const overlay = document.querySelector('.mobile-overlay');
                        
                        if (sidebar) {
                            const isActive = sidebar.classList.contains('active');
                            
                            if (isActive) {
                                // 关闭侧边栏
                                sidebar.classList.remove('active');
                                if (overlay) {
                                    overlay.style.opacity = '0';
                                    setTimeout(() => {
                                        overlay.style.display = 'none';
                                    }, 300);
                                }
                            } else {
                                // 打开侧边栏
                                sidebar.classList.add('active');
                                if (overlay) {
                                    overlay.style.display = 'block';
                                    setTimeout(() => {
                                        overlay.style.opacity = '1';
                                    }, 10);
                                }
                            }
                        }
                    };
                }
                
                // 移动端表格优化
                const tables = document.querySelectorAll('table');
                tables.forEach(table => {
                    const wrapper = document.createElement('div');
                    wrapper.style.cssText = `
                        overflow-x: auto;
                        -webkit-overflow-scrolling: touch;
                        border-radius: 8px;
                        border: 1px solid rgba(212,175,55,0.2);
                    `;
                    
                    table.parentNode.insertBefore(wrapper, table);
                    wrapper.appendChild(table);
                });
                
                // 移动端性能优化
                document.addEventListener('scroll', function() {
                    // 节流滚动事件
                    clearTimeout(window.scrollTimeout);
                    window.scrollTimeout = setTimeout(() => {
                        // 滚动时隐藏/显示语言切换器
                        const languageSwitcher = document.querySelector('.language-switcher');
                        if (languageSwitcher) {
                            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                            if (scrollTop > 100) {
                                languageSwitcher.style.opacity = '0.7';
                            } else {
                                languageSwitcher.style.opacity = '1';
                            }
                        }
                    }, 100);
                }, { passive: true });
                
                // 移动端手势支持
                let startX, startY, distX, distY;
                
                document.addEventListener('touchstart', function(e) {
                    const touch = e.touches[0];
                    startX = touch.clientX;
                    startY = touch.clientY;
                }, { passive: true });
                
                document.addEventListener('touchmove', function(e) {
                    if (!startX || !startY) return;
                    
                    const touch = e.touches[0];
                    distX = touch.clientX - startX;
                    distY = touch.clientY - startY;
                }, { passive: true });
                
                document.addEventListener('touchend', function(e) {
                    if (!startX || !startY) return;
                    
                    // 右滑手势打开侧边栏
                    if (distX > 50 && Math.abs(distY) < 100 && startX < 50) {
                        const sidebar = document.querySelector('.sidebar');
                        if (sidebar && !sidebar.classList.contains('active')) {
                            toggleMobileMenu();
                        }
                    }
                    
                    // 左滑手势关闭侧边栏
                    if (distX < -50 && Math.abs(distY) < 100) {
                        const sidebar = document.querySelector('.sidebar');
                        if (sidebar && sidebar.classList.contains('active')) {
                            toggleMobileMenu();
                        }
                    }
                    
                    // 重置变量
                    startX = startY = distX = distY = null;
                }, { passive: true });
            }
        }
        
        // 添加移动端特定的样式处理
        function addMobileStyles() {
            const style = document.createElement('style');
            style.textContent = `
                /* 移动端特定样式补充 */
                @media screen and (max-width: 768px) {
                    /* 优化粒子效果性能 */
                    #tsparticles {
                        opacity: 0.3;
                    }
                    
                    /* 优化动画性能 */
                    * {
                        -webkit-transform: translateZ(0);
                        transform: translateZ(0);
                    }
                    
                    /* 移动端遮罩层 */
                    .mobile-overlay {
                        backdrop-filter: blur(2px);
                        -webkit-backdrop-filter: blur(2px);
                    }
                }
                
                @media screen and (max-width: 480px) {
                    /* 进一步优化小屏幕 */
                    #tsparticles {
                        opacity: 0.2;
                    }
                    
                    /* 优化表格显示 */
                    .employee-table, .salon-table, .product-table {
                        min-width: 100%;
                        white-space: nowrap;
                    }
                }
            `;
            document.head.appendChild(style);
        }
        
        // 检查是否需要重新初始化移动端优化
        function reinitializeMobileFeatures() {
            // 重新绑定动态添加的元素的触摸事件
            const newButtons = document.querySelectorAll('button:not([data-mobile-optimized])');
            newButtons.forEach(button => {
                button.setAttribute('data-mobile-optimized', 'true');
                button.addEventListener('touchstart', function() {}, { passive: true });
            });
            
            // 重新绑定新输入框的事件
            const newInputs = document.querySelectorAll('input:not([data-mobile-optimized]), select:not([data-mobile-optimized]), textarea:not([data-mobile-optimized])');
            newInputs.forEach(input => {
                input.setAttribute('data-mobile-optimized', 'true');
                input.addEventListener('focus', function() {
                    setTimeout(() => {
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            });
        }
        
        // 页面加载完成后执行移动端优化
        document.addEventListener('DOMContentLoaded', function() {
            initMobileOptimization();
            addMobileStyles();
        });
        
        // 如果DOM已经加载完成，立即执行
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initMobileOptimization();
                addMobileStyles();
            });
        } else {
            initMobileOptimization();
            addMobileStyles();
        }
        
        // 监听内容变化，重新初始化移动端特性
        const observer = new MutationObserver(function(mutations) {
            let shouldReinitialize = false;
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                    shouldReinitialize = true;
                }
            });
            
            if (shouldReinitialize) {
                setTimeout(reinitializeMobileFeatures, 100);
            }
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
    </script>
</body>
</html> 