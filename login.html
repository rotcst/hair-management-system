<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MAKE IT HAIR Professional - ç™»å½•</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <!-- Firebaseé…ç½® -->
    <script src="firebase-config.js"></script>
    <!-- Firebaseæ•°æ®ç®¡ç†å™¨ -->
    <script src="firebase-data-manager.js"></script>
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #FFD700;
            --black: #000000;
            --dark-gray: #1a1a1a;
            --text-light: #ffffff;
        }
        
        /* æµ…è‰²æ¨¡å¼å˜é‡ */
        [data-theme="light"] {
            --gold: #B8860B;
            --gold-light: #DAA520;
            --black: #ffffff;
            --dark-gray: #f5f5f5;
            --text-light: #333333;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: var(--black);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ - ä¸é¦–é¡µä¿æŒä¸€è‡´ */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--dark-gray);
            border-bottom: 1px solid var(--gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            box-sizing: border-box;
        }
        
        .store-info {
            color: var(--gold);
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* è¯­è¨€åˆ‡æ¢æ ·å¼ - ä¸é¦–é¡µä¿æŒä¸€è‡´ */
        .language-switcher {
            display: flex;
            gap: 5px;
            background: var(--dark-gray);
            padding: 8px 15px;
            border-radius: 8px;
            height: 40px;
            align-items: center;
            box-sizing: border-box;
        }
        
        .language-btn {
            background: transparent;
            color: var(--text-light);
            border: 1px solid var(--gold);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .language-btn:hover {
            background: var(--gold);
            color: var(--black);
        }
        
        .language-btn.active {
            background: var(--gold);
            color: var(--black);
            font-weight: bold;
        }

        /* ä¸»é¢˜åˆ‡æ¢æ ·å¼ - ä¸é¦–é¡µä¿æŒä¸€è‡´ */
        .theme-switcher {
            display: flex;
            gap: 5px;
            background: var(--dark-gray);
            padding: 8px 15px;
            border-radius: 8px;
            height: 40px;
            align-items: center;
            box-sizing: border-box;
        }
        
        .theme-btn {
            background: transparent;
            color: var(--text-light);
            border: 1px solid var(--gold);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            min-width: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-btn:hover {
            background: var(--gold);
            color: var(--black);
            transform: scale(1.1);
        }
        
        .theme-btn.active {
            background: var(--gold);
            color: var(--black);
            font-weight: bold;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.4);
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 60px;
        }
        
        .login-container {
            background: var(--dark-gray);
            padding: 40px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            width: 320px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease;
        }
        
        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 3em;
            color: var(--gold);
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .brand-name {
            color: var(--gold-light);
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--gold);
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gold);
            background: transparent;
            color: var(--text-light);
            border-radius: 5px;
            outline: none;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            border-color: var(--gold-light);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }
        
        .login-button {
            width: 100%;
            padding: 12px;
            background: var(--gold);
            color: var(--black);
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .login-button:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
        }
        
        .remember-me {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .remember-me input {
            margin-right: 8px;
        }
        
        .forgot-password {
            text-align: center;
            margin-top: 15px;
        }
        
        .forgot-password a {
            color: var(--gold-light);
            text-decoration: none;
            font-size: 0.9em;
        }
        
        .forgot-password a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            color: #ff4444;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
    </style>
  </head>
  <body>
      <!-- é¡¶éƒ¨å¯¼èˆªæ  - ä¸é¦–é¡µä¿æŒä¸€è‡´ -->
      <div class="top-nav">
          <!-- ä»£ç†åº—åç§°æ˜¾ç¤ºï¼ˆå·¦ä¾§ï¼‰ -->
          <div class="store-info">
              <span data-i18n="store-name">ë©”ì‹œì•„ì„œë¶€ì§€ì ê´€ë¦¬ì‹œìŠ¤í…œ</span>
          </div>
          
          <!-- å³ä¾§ä¿¡æ¯ç»„ -->
          <div class="nav-right">
              <!-- ä¸»é¢˜åˆ‡æ¢å™¨ -->
              <div class="theme-switcher">
                  <button class="theme-btn" onclick="switchTheme('light')" id="btn-light" title="ç™½å¤©æ¨¡å¼">â˜€ï¸</button>
                  <button class="theme-btn" onclick="switchTheme('dark')" id="btn-dark" title="é»‘å¤œæ¨¡å¼">ğŸŒ™</button>
                  <button class="theme-btn active" onclick="switchTheme('auto')" id="btn-auto" title="è‡ªåŠ¨æ¨¡å¼">ğŸ”„</button>
              </div>
              
              <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
              <div class="language-switcher">
                  <button class="language-btn active" onclick="switchLanguage('zh')" id="btn-zh">ä¸­æ–‡</button>
                  <button class="language-btn" onclick="switchLanguage('ko')" id="btn-ko">í•œêµ­ì–´</button>
              </div>
          </div>
      </div>
      
      <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
      <div class="main-content">
          <div class="login-container">
            <div class="logo-section">
                <div class="logo">M</div>
                <div class="brand-name">MAKE IT HAIR Professional</div>
            </div>
                      <form id="loginForm">
                  <div class="input-group">
                      <label for="username" data-i18n="username-label">ç”¨æˆ·å</label>
                      <input type="text" id="username" name="username" required>
                  </div>
                  <div class="input-group">
                      <label for="password" data-i18n="password-label">å¯†ç </label>
                      <input type="password" id="password" name="password" required>
                  </div>
                  <div class="remember-me">
                      <input type="checkbox" id="remember" name="remember">
                      <label for="remember" data-i18n="remember-me">è®°ä½æˆ‘</label>
                  </div>
                  <button type="submit" class="login-button" data-i18n="login-button">ç™»å½•</button>
                  <div class="error-message" id="errorMessage" data-i18n="login-error">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</div>
                  <div class="forgot-password">
                      <a href="#" data-i18n="forgot-password">å¿˜è®°å¯†ç ï¼Ÿ</a>
                  </div>
              </form>
        </div>
      </div>
          <script>
          // å½“å‰è¯­è¨€è®¾ç½®
          let currentLanguage = 'zh';
          // å½“å‰ä¸»é¢˜è®¾ç½®
          let currentTheme = 'auto';
          
          // å¤šè¯­è¨€ç¿»è¯‘å­—å…¸
          const translations = {
              zh: {
                  'username-label': 'ç”¨æˆ·å',
                  'password-label': 'å¯†ç ',
                  'remember-me': 'è®°ä½æˆ‘',
                  'login-button': 'ç™»å½•',
                  'login-error': 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯',
                  'forgot-password': 'å¿˜è®°å¯†ç ï¼Ÿ',
                  'store-name': 'MAKE IT HAIR Professional - ç™»å½•ç³»ç»Ÿ'
              },
              ko: {
                  'username-label': 'ì‚¬ìš©ìëª…',
                  'password-label': 'ë¹„ë°€ë²ˆí˜¸',
                  'remember-me': 'ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€',
                  'login-button': 'ë¡œê·¸ì¸',
                  'login-error': 'ì‚¬ìš©ìëª… ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤',
                  'forgot-password': 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”ï¼Ÿ',
                  'store-name': 'MAKE IT HAIR Professional - ë¡œê·¸ì¸ ì‹œìŠ¤í…œ'
              }
          };
          
          // è·å–ç¿»è¯‘æ–‡æœ¬
          function getText(key) {
              return translations[currentLanguage] && translations[currentLanguage][key] 
                  ? translations[currentLanguage][key] 
                  : key;
          }
          
          // æ›´æ–°æ‰€æœ‰æ–‡æœ¬
          function updateTexts() {
              document.querySelectorAll('[data-i18n]').forEach(element => {
                  const key = element.getAttribute('data-i18n');
                  if (translations[currentLanguage] && translations[currentLanguage][key]) {
                      element.textContent = translations[currentLanguage][key];
                  }
              });
              
              // æ›´æ–°é¡µé¢æ ‡é¢˜
              if (currentLanguage === 'ko') {
                  document.title = 'MAKE IT HAIR Professional - ë¡œê·¸ì¸';
              } else {
                  document.title = 'MAKE IT HAIR Professional - ç™»å½•';
              }
          }
          
          // è¯­è¨€åˆ‡æ¢å‡½æ•°
          function switchLanguage(lang) {
              currentLanguage = lang;
              localStorage.setItem('language', lang); // åŒæ­¥åˆ°ä¸»ç³»ç»Ÿ
              
              // æ›´æ–°æŒ‰é’®çŠ¶æ€
              document.querySelectorAll('.language-switcher .language-btn').forEach(btn => {
                  btn.classList.remove('active');
              });
              document.getElementById('btn-' + lang).classList.add('active');
              
              // æ›´æ–°æ–‡æœ¬
              updateTexts();
          }
          
          // ä¸»é¢˜åˆ‡æ¢å‡½æ•°
          function switchTheme(theme) {
              currentTheme = theme;
              localStorage.setItem('theme', theme); // åŒæ­¥åˆ°ä¸»ç³»ç»Ÿ
              
              // æ›´æ–°æŒ‰é’®çŠ¶æ€
              document.querySelectorAll('.theme-switcher .theme-btn').forEach(btn => {
                  btn.classList.remove('active');
              });
              document.getElementById('btn-' + theme).classList.add('active');
              
              // åº”ç”¨ä¸»é¢˜
              applyTheme();
          }
          
          // åº”ç”¨ä¸»é¢˜
          function applyTheme() {
              const body = document.body;
              
              if (currentTheme === 'light') {
                  body.setAttribute('data-theme', 'light');
              } else if (currentTheme === 'dark') {
                  body.removeAttribute('data-theme');
              } else {
                  // è‡ªåŠ¨æ¨¡å¼ï¼šæ ¹æ®ç³»ç»Ÿæ—¶é—´åˆ¤æ–­
                  const hour = new Date().getHours();
                  if (hour >= 6 && hour < 18) {
                      body.setAttribute('data-theme', 'light');
                  } else {
                      body.removeAttribute('data-theme');
                  }
              }
          }
          
                  // è·å–å‘˜å·¥æ•°æ®
        async function getEmployees() {
            try {
                if (window.dataManager && window.dataManager.db) {
                    return await dataManager.getEmployees();
                } else {
                    const employees = localStorage.getItem('employees');
                    return employees ? JSON.parse(employees) : [];
                }
            } catch (error) {
                console.error('è·å–å‘˜å·¥æ•°æ®å¤±è´¥:', error);
                const employees = localStorage.getItem('employees');
                return employees ? JSON.parse(employees) : [];
            }
        }
        
        // è®¾ç½®å½“å‰ç”¨æˆ·
        function setCurrentUser(user) {
            localStorage.setItem('currentUser', JSON.stringify(user));
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
        function checkLoginStatus() {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                // å·²ç»ç™»å½•ï¼Œè·³è½¬åˆ°ä¸»é¡µé¢
                window.location.href = 'index.html';
                return true;
            }
            return false;
        }
        
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            try {
                // åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
                if (window.dataManager && !window.dataManager.db) {
                    await dataManager.initialize();
                }
                
                const employees = await getEmployees();
                
                // å¦‚æœæ²¡æœ‰å‘˜å·¥æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤ç®¡ç†å‘˜
                if (employees.length === 0) {
                    const defaultAdmin = {
                        id: Date.now(),
                        name: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
                        position: 'admin',
                        username: 'admin',
                        password: 'admin',
                        mobile: '010-0000-0000',
                        createTime: new Date().toLocaleString('zh-CN')
                    };
                    
                    if (window.dataManager && window.dataManager.db) {
                        await dataManager.saveEmployee(defaultAdmin);
                    } else {
                        employees.push(defaultAdmin);
                        localStorage.setItem('employees', JSON.stringify(employees));
                    }
                }
                
                // æŸ¥æ‰¾åŒ¹é…çš„ç”¨æˆ·
                const user = employees.find(emp => emp.username === username && emp.password === password);
                
                if (user) {
                    // ç™»å½•æˆåŠŸï¼Œè®¾ç½®å½“å‰ç”¨æˆ·
                    setCurrentUser(user);
                    
                    // è®°å½•ç™»å½•æ“ä½œå†å²
                    const operation = {
                        id: Date.now(),
                        type: 'login',
                        category: 'system',
                        targetId: user.id,
                        targetName: 'ç³»ç»Ÿç™»å½•',
                        description: `ç”¨æˆ· ${user.name} (${user.position}) ç™»å½•ç³»ç»Ÿ`,
                        operatorId: user.id,
                        operatorName: user.name,
                        timestamp: new Date().toISOString(),
                        beforeData: null,
                        afterData: null
                    };
                    
                    if (window.dataManager && window.dataManager.db) {
                        await dataManager.saveOperation(operation);
                    } else {
                        const operations = JSON.parse(localStorage.getItem('operations')) || [];
                        operations.push(operation);
                        localStorage.setItem('operations', JSON.stringify(operations));
                    }
                    
                    // è·³è½¬åˆ°ä¸»é¡µé¢
                    window.location.href = 'index.html';
                } else {
                    // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                    document.getElementById('errorMessage').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('errorMessage').style.display = 'none';
                    }, 3000); // 3ç§’åè‡ªåŠ¨éšè—é”™è¯¯æ¶ˆæ¯
                }
            } catch (error) {
                console.error('ç™»å½•å¤„ç†å¤±è´¥:', error);
                document.getElementById('errorMessage').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 3000);
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
            if (checkLoginStatus()) {
                return; // å·²ç»ç™»å½•ï¼Œä¼šè·³è½¬åˆ°ä¸»é¡µé¢
            }
            
            // éšè—é”™è¯¯æ¶ˆæ¯
            document.getElementById('errorMessage').style.display = 'none';
            
            // åˆå§‹åŒ–è¯­è¨€è®¾ç½®ï¼Œä¸ä¸»ç³»ç»Ÿä¿æŒä¸€è‡´
            const savedLanguage = localStorage.getItem('language') || 'zh';
            if (savedLanguage !== 'zh') {
                switchLanguage(savedLanguage);
            } else {
                updateTexts();
            }
            
            // åˆå§‹åŒ–ä¸»é¢˜è®¾ç½®ï¼Œä¸ä¸»ç³»ç»Ÿä¿æŒä¸€è‡´
            const savedTheme = localStorage.getItem('theme') || 'auto';
            currentTheme = savedTheme;
            
            // æ›´æ–°ä¸»é¢˜æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.theme-switcher .theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btn-' + savedTheme).classList.add('active');
            
            // åº”ç”¨ä¸»é¢˜
            applyTheme();
            
            // å¦‚æœæ˜¯è‡ªåŠ¨æ¨¡å¼ï¼Œæ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ—¶é—´
            if (savedTheme === 'auto') {
                setInterval(applyTheme, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
            }
        });
    </script>
</body>
</html> 