<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“æ·»åŠ åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #d4af37;
            border-radius: 10px;
        }
        button {
            background: #d4af37;
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #b8941f;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #d4af37;
            padding: 8px;
            text-align: center;
        }
        th {
            background: rgba(212, 175, 55, 0.2);
        }
        input {
            background: transparent;
            border: 1px solid #d4af37;
            color: white;
            padding: 5px;
            border-radius: 3px;
            width: 90%;
        }
        .log {
            background: #2a2a2a;
            border: 1px solid #555;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª äº§å“æ·»åŠ åŠŸèƒ½æµ‹è¯•</h1>
        
        <div>
            <button onclick="testAddProductRow()">â• æµ‹è¯•æ·»åŠ äº§å“è¡Œ</button>
            <button onclick="testConsole()">ğŸ“ æµ‹è¯•æ§åˆ¶å°</button>
            <button onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>äº§å“åç§°</th>
                    <th>å•ä»·</th>
                    <th>æ•°é‡</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                <!-- äº§å“è¡Œå°†åœ¨è¿™é‡Œæ·»åŠ  -->
            </tbody>
        </table>
        
        <div class="log" id="testLog">
            <div>ğŸš€ æµ‹è¯•æ—¥å¿—:</div>
        </div>
    </div>

    <script>
        // ç®€å•çš„ç¿»è¯‘ç³»ç»Ÿ
        const testTranslations = {
            'product-table-not-found-error': 'ç³»ç»Ÿé”™è¯¯ï¼šæœªæ‰¾åˆ°äº§å“è¡¨æ ¼ã€‚è¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚',
            'add-product-row-failed': 'æ·»åŠ äº§å“è¡Œå¤±è´¥'
        };
        
        function getText(key) {
            return testTranslations[key] || key;
        }
        
        // æ¨¡æ‹Ÿå¿…è¦çš„å…¨å±€å˜é‡
        let productRowCounter = 0;
        let currentSalonId = 'test-salon-1';
        
        // æ¨¡æ‹Ÿå¿…è¦çš„å‡½æ•°
        function getSalons() {
            return [{
                id: 'test-salon-1',
                name: 'æµ‹è¯•ç¾å‘åº—',
                transactions: [{
                    id: 1,
                    date: new Date('2024-01-01'),
                    products: [{
                        name: 'æ´—å‘æ°´',
                        unitPrice: 15000,
                        quantity: 2,
                        giftQuantity: 0
                    }]
                }]
            }];
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function updateTexts() {
            // æ¨¡æ‹Ÿç¿»è¯‘æ›´æ–°
            log('ç¿»è¯‘æ›´æ–°å®Œæˆ');
        }
        
        function calculateTotalAmount() {
            log('è®¡ç®—æ€»é‡‘é¢');
        }
        
        function calculateRowTotal(rowId) {
            log(`è®¡ç®—è¡Œæ€»é¢: ${rowId}`);
        }
        
        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('testLog').innerHTML = '<div>ğŸš€ æµ‹è¯•æ—¥å¿—:</div>';
        }
        
        function testConsole() {
            console.log('æµ‹è¯•æ§åˆ¶å°è¾“å‡º');
            log('å·²å‘é€æµ‹è¯•æ¶ˆæ¯åˆ°æ§åˆ¶å°');
        }
        
        // äº§å“å†å²è®°å½•æ£€æŸ¥å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function checkProductHistory(input, rowId) {
            try {
                const productName = input.value.trim();
                const historyDiv = document.getElementById(`productHistory_${rowId}`);
                
                if (!historyDiv) {
                    log(`è­¦å‘Š: å†å²è®°å½•æ˜¾ç¤ºåŒºåŸŸæœªæ‰¾åˆ°: productHistory_${rowId}`);
                    return;
                }
                
                if (productName.length < 2) {
                    historyDiv.style.display = 'none';
                    return;
                }
                
                if (!currentSalonId) {
                    historyDiv.innerHTML = `<span style="color: #cccccc;">è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç¾å‘åº—</span>`;
                    historyDiv.style.display = 'block';
                    return;
                }
                
                log(`æ£€æŸ¥äº§å“å†å²: ${productName}`);
                historyDiv.innerHTML = `<div style="color: #87CEEB;">ğŸ” æœç´¢å†å²è®°å½•ä¸­...</div>`;
                historyDiv.style.display = 'block';
                
                // æ¨¡æ‹Ÿå¼‚æ­¥æœç´¢
                setTimeout(() => {
                    if (productName.includes('æ´—å‘æ°´')) {
                        historyDiv.innerHTML = `
                            <div style="color: #87CEEB;">
                                ğŸ“¦ <strong>æ´—å‘æ°´</strong><br>
                                ğŸ•’ ä¸Šæ¬¡è´­ä¹°ï¼š2024å¹´1æœˆ1æ—¥ (${Math.floor((new Date() - new Date('2024-01-01')) / (1000*60*60*24))}å¤©å‰)<br>
                                ğŸ“Š æ•°é‡ï¼š2ä¸ª<br>
                                ğŸ’° å•ä»·ï¼šâ‚©15,000<br>
                                <span style="color: #FF6666;">ğŸ”´ é•¿æœŸæœªè´­ä¹°æ­¤äº§å“</span>
                            </div>
                        `;
                    } else {
                        historyDiv.innerHTML = `<span style="color: #cccccc;">ğŸ†• æ–°äº§å“ - è¯¥ç¾å‘åº—æœªè´­ä¹°è¿‡æ­¤äº§å“</span>`;
                    }
                }, 500);
                
            } catch (error) {
                log(`é”™è¯¯: äº§å“å†å²è®°å½•æ£€æŸ¥å¤±è´¥ - ${error.message}`);
            }
        }
        
        // ä¸»è¦æµ‹è¯•å‡½æ•°ï¼šæ·»åŠ äº§å“è¡Œ
        function addProductRow() {
            try {
                log(`å¼€å§‹æ·»åŠ äº§å“è¡Œ: ${productRowCounter + 1}`);
                productRowCounter++;
                const tbody = document.getElementById('productTableBody');
                
                if (!tbody) {
                    log('é”™è¯¯: æœªæ‰¾åˆ°äº§å“è¡¨æ ¼tbodyå…ƒç´ ');
                    alert(getText('product-table-not-found-error'));
                    return;
                }
                
                const row = document.createElement('tr');
                row.id = `productRow_${productRowCounter}`;
                row.innerHTML = `
                    <td style="position: relative;">
                        <input type="text" placeholder="äº§å“åç§°" id="productName_${productRowCounter}">
                        <div id="productHistory_${productRowCounter}" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: rgba(0, 0, 0, 0.9); border: 1px solid #d4af37; border-top: none; border-radius: 0 0 3px 3px; padding: 8px; z-index: 100; font-size: 0.8em; color: #87CEEB; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>
                    </td>
                    <td>
                        <input type="text" placeholder="1,000">
                    </td>
                    <td>
                        <input type="number" placeholder="1" min="0" max="99">
                    </td>
                    <td>
                        <button onclick="removeProductRow(${productRowCounter})" style="background: #ff6666; color: white; padding: 3px 8px;">åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
                
                // ä¸ºäº§å“åç§°è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const productNameInput = document.getElementById(`productName_${productRowCounter}`);
                if (productNameInput) {
                    productNameInput.addEventListener('input', function() {
                        checkProductHistory(this, productRowCounter);
                    });
                    productNameInput.addEventListener('blur', function() {
                        setTimeout(() => {
                            const historyDiv = document.getElementById(`productHistory_${productRowCounter}`);
                            if (historyDiv) {
                                historyDiv.style.display = 'none';
                            }
                        }, 200);
                    });
                    log(`äº‹ä»¶ç›‘å¬å™¨å·²æ·»åŠ åˆ°äº§å“åç§°è¾“å…¥æ¡†: productName_${productRowCounter}`);
                }
                
                updateTexts();
                calculateTotalAmount();
                log(`âœ… äº§å“è¡Œæ·»åŠ æˆåŠŸ: productRow_${productRowCounter}`);
                
            } catch (error) {
                log(`âŒ æ·»åŠ äº§å“è¡Œå¤±è´¥: ${error.message}`);
                console.error('æ·»åŠ äº§å“è¡Œå‡ºé”™:', error);
                alert(getText('add-product-row-failed') + 'ï¼š' + error.message);
            }
        }
        
        function removeProductRow(rowId) {
            try {
                const row = document.getElementById(`productRow_${rowId}`);
                if (row) {
                    row.remove();
                    log(`âœ… äº§å“è¡Œåˆ é™¤æˆåŠŸ: productRow_${rowId}`);
                } else {
                    log(`âš ï¸ æœªæ‰¾åˆ°è¦åˆ é™¤çš„äº§å“è¡Œ: productRow_${rowId}`);
                }
            } catch (error) {
                log(`âŒ åˆ é™¤äº§å“è¡Œå¤±è´¥: ${error.message}`);
            }
        }
        
        function testAddProductRow() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•æ·»åŠ äº§å“è¡ŒåŠŸèƒ½...');
            addProductRow();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ·»åŠ ä¸€è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            log('ğŸ”§ è‡ªåŠ¨æ·»åŠ ç¬¬ä¸€è¡Œäº§å“...');
            addProductRow();
        });
    </script>
</body>
</html> 